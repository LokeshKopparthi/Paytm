/*! For license information please see catalogContainer.c60aaef62564dbdf3600.js.LICENSE.txt */
(self.webpackChunk_fluidx_catalog_container=self.webpackChunk_fluidx_catalog_container||[]).push([[49732],{10957:(e,t,s)=>{"use strict";var r;s.d(t,{A:()=>r}),function(e){let t=!1;e.getLoggerEnabledStatus=function(){return t},e.setLoggerEnabledStatus=function(e){t=e}}(r||(r={}))},92617:(e,t,s)=>{"use strict";s.d(t,{$x:()=>i,D5:()=>n,TP:()=>a,uv:()=>r});const r="https://substrate.office.com/search/SubstrateSearch-Internal.ReadWrite",i="MessageExtensionApp",n="UnfurlConfigV2";var a;!function(e){e.UnfurlConfigV2Enabled="cardLoop.unfurlConfigV2Enabled"}(a||(a={}))},51922:(e,t,s)=>{"use strict";var r;s.d(t,{AF:()=>a,Ey:()=>o,TP:()=>r,Xf:()=>n,mJ:()=>i}),function(e){e.ComponentEnabled="cardLoop.componentEnabled",e.LoggingEnabled="cardLoop.loggingEnabled",e.RenderNonAdaptiveCards="cardLoop.renderNonAdaptiveCards"}(r||(r={})),r.ComponentEnabled,r.LoggingEnabled;const i=216e5,n="CardLoopStore-",a="@1js/card-loop",o="@1js/card-loop"},88490:(e,t,s)=>{"use strict";s.d(t,{P:()=>i});var r=s(59939);const i=(e,t)=>(0,r.__awaiter)(void 0,void 0,void 0,(function*(){const{TokenProvider:i,CardChannelProvider:n,SettingsProvider:a}=e;if(!i||!a)return[void 0,void 0];if(n)return[n,"Host"];const o=yield function(e,t,i){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const{SubstrateSearchCardChannelProvider:r}=yield Promise.all([s.e(5684),s.e(53096),s.e(74688),s.e(93362)]).then(s.bind(s,35725));return new r(e,t,i)}))}(i,a,t);return[o,"Default"]}))},17201:(e,t,s)=>{"use strict";s.d(t,{C:()=>a});var r=s(10957),i=s(47667),n=s(51922);const a=e=>{const t=(0,i.L5)(n.TP.LoggingEnabled,!1,e);r.A.setLoggerEnabledStatus(t)}},28803:(e,t,s)=>{"use strict";s.d(t,{J:()=>o});var r=s(59939),i=s(92617);function n(e){const t=e.split("/")[0].split(".");if(t.length<2)return!1;const s=t[t.length-1],r=t[t.length-2];return!s.includes("*")&&!r.includes("*")}class a{constructor(){this._regexList=[],this._appsMetadata=new Map,this._registryData=new Map}static getInstance(){return this.INSTANCE||(this.INSTANCE=new a),this.INSTANCE}get regexList(){return this._regexList}canHandleUrl(e,t,s){return(0,r.__awaiter)(this,void 0,void 0,(function*(){if(!t)return Promise.resolve(!1);for(const[r,i]of this._appsMetadata)if(i.Patterns.some((t=>t.test(e.hostname)))){const e=yield t.getAppInstalledStatus(i.SourceMetadata.MetaOsAppId);return s.logEvent({eventType:"info",eventName:"Installed"===e?"AppInstalled":"AppAvailableButNotInstalled"}),s.setAppDetails(i.SourceMetadata.MetaOsAppId,i.SourceMetadata.MsaAppId),Promise.resolve("Installed"===e)}return Promise.resolve(!1)}))}populateStore(e){return(0,r.__awaiter)(this,void 0,void 0,(function*(){if(e){this._appsMetadata.clear(),this._registryData.clear(),this._regexList.splice(0);for(const[t,s]of e){const e=(this.isSubstrateData(s)?s.Patterns:s.urlRegex).filter((e=>n(e))).map((e=>(e=`^${e=e.replace(/\*\./g,"[a-zA-Z0-9-]+?\\.")}$`,new RegExp(e,"i"))));this._regexList.push(...e);const r=this.isSubstrateData(s)?Object.assign(Object.assign({},s),{Patterns:e}):{ContentSource:t,SourceType:i.$x,SourceMetadata:{MetaOsAppId:t,MsaAppId:s.botId},Patterns:e};this._appsMetadata.set(t,r)}}}))}getAppIdFromUrl(e){for(const[t,s]of this._appsMetadata)for(const r of s.Patterns)if(r.test(e.hostname))return t}getAppRegistryData(e,t,s,i){var n,a,o;return(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=this.getMetaOSAppId(e,t);if(!r)return Promise.resolve(void 0);if(this._registryData.has(r))return this._registryData.get(r);const c=yield s;if(!c)return Promise.resolve(void 0);try{const e=yield c.getAppDefinition(r),t=null!==(o=null===(a=null===(n=e.inputExtensions)||void 0===n?void 0:n[0])||void 0===a?void 0:a.botId)&&void 0!==o?o:void 0,s={displayName:e.name,icon:e.largeImageUrl,botId:t};return this._registryData.set(r,s),i.setAppDetails(r,t),Promise.resolve(s)}catch(e){return Promise.resolve(void 0)}}))}getMetaOSAppId(e,t){if(!e)return;const s=this._appsMetadata.get(e);return s?null!=t?t:s.SourceMetadata.MetaOsAppId:null!=t?t:e}isSubstrateData(e){return void 0!==e.ContentSource}}const o=a.getInstance()},29364:e=>{e.exports=function(e){function t(t){for(var s,i,n=t[0],a=t[1],o=0,u=[];o<n.length;o++)i=n[o],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s]);for(c&&c(t);u.length;)u.shift()()}var s={},r={main:0};function i(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],s=r[e];if(0!==s)if(s)t.push(s[2]);else{var n=new Promise((function(t,i){s=r[e]=[t,i]}));t.push(s[2]=n);var a,o=document.createElement("script");o.charset="utf-8",o.timeout=120,i.nc&&o.setAttribute("nonce",i.nc),o.src=function(e){return i.p+"graphloop_"+({chunk:"chunk","graph-loop-prefetch":"graph-loop-prefetch",strings:"strings","vendors~graph-loop":"vendors~graph-loop","graph-loop":"graph-loop"}[e]||e)+"_"+{chunk:"3554762d12ea60d3409f","graph-loop-prefetch":"640e66724ed448b87c52",strings:"3c8b1fafc3e239387e76","vendors~graph-loop":"15e31d702d4ed6e18848","graph-loop":"a8517242ef6229bb0142"}[e]+".js"}(e);var c=new Error;a=function(t){o.onerror=o.onload=null,clearTimeout(u);var s=r[e];if(0!==s){if(s){var i=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+i+": "+n+")",c.name="ChunkLoadError",c.type=i,c.request=n,s[1](c)}r[e]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:o})}),12e4);o.onerror=o.onload=a,document.head.appendChild(o)}return Promise.all(t)},i.m=e,i.c=s,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://res-1.cdn.office.net/midgard/versionless/",i.oe=function(e){throw console.error(e),e};var n=window.msfast_graphloop_jsonp=window.msfast_graphloop_jsonp||[],a=n.push.bind(n);n.push=t,n=n.slice();for(var o=0;o<n.length;o++)t(n[o]);var c=a;return i(i.s="lrx/")}({"lrx/":function(e,t,s){"use strict";function r(e,t){void 0===t&&(t=window);var s="";if(t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t.location.search);s=r&&t.decodeURIComponent(r[1].replace(/\+/g," "))||""}return s}s.r(t),s.d(t,"loadGraph",(function(){return p})),s.d(t,"loadGraphPrefetch",(function(){return g})),s.d(t,"loadGraphStrings",(function(){return f})),s.d(t,"overrideGraph",(function(){return v})),s.d(t,"overrideGraphPrefetch",(function(){return b})),s.d(t,"overrideGraphStrings",(function(){return S})),s.d(t,"checkVersionOverride",(function(){return w}));const i=new RegExp("https?://localhost(:|/|$)"),n=s.p,a=["https://res.cdn.office.net","https://res-1.cdn.office.net","https://res-2.cdn.office.net","https://res-1.cdn.partner.office365.cn","https://outlook-1-cdn.azureedge.eaglex.ic.gov","https://outlook-1-cdn.azureedge.microsoft.scloud"];function o(e,t){const s=new URL("https://midgardbranches.blob.core.windows.net/lpc/refs/heads/"),r=t?new URL(t):void 0,{origin:n}=new URL(e,document.baseURI);if(n===s.origin||r&&n===r.origin||function(e){return a.includes(e)}(n)||i.test(n))return e;throw new Error(`TrustedType policy does not allow loading scripts from ${n}, only from ${s.origin}, ${null==r?void 0:r.origin} and localhost.`)}let c;function u(e,t){var r;void 0===t&&(t={});var i=function(t){return"Error loading script at ".concat(e," (").concat(t,")")},a=document.head||document.getElementsByTagName("head")[0];if(!a)return Promise.reject(i("no head element"));var u=null===(r=function(){if(void 0===c&&(c=null,self.trustedTypes))try{c=self.trustedTypes.createPolicy("@1js/midgard-trusted-types",{createHTML:e=>e,createScript:e=>e,createScriptURL:(e,t=n)=>o(e,t)})}catch(e){}return c}())||void 0===r?void 0:r.createScriptURL(e,s.p);if(!u)return Promise.reject(i("Not valid Script Url"));var l=document.createElement("script");l.src=u,l.crossOrigin="anonymous",l.async=!0,l.charset="utf-8",t.ref&&t.ref(l);var h=new Promise((function(e,s){return window.setTimeout((function(){return s(i("timeout"))}),t.timeout||12e4)})),d=new Promise((function(e,t){l.onload=function(){return e()},l.onerror=function(e,s,r,n,a){var o="string"==typeof e?e:e.type,c=a?JSON.stringify(a):"none",u="Event: ".concat(o,", source: ").concat(s,", line: ").concat(r,", col: ").concat(n,", error: ").concat(c);t(i(u))}}));return a.appendChild(l),Promise.race([d,h])}var l=!1;function h(e,t,s){var r,i;return d((r=s,u(i=t+s+"resourcecatalog.js").then((function(){var e="undefined"!=typeof ms_resource_catalogs&&ms_resource_catalogs,t=e&&e[r];if(t)return t;throw new Error("Resource catalog ".concat(r," not found in ").concat(i))}))).then((function(t){return function(r){var i=t.resources[r+"_"+s];return i?e+i:""}})),e)}function d(e,t){s.p=t;var r=s.e;return s.e=function(e,t){var s={};return function(r,i){var n=s[r];if(n)return n[0];var a=(n=s[r]=function(){var e,t;return[new Promise((function(s,r){e=s,t=r})),e,t]}())[0],o=n[1],c=n[2];return t.then((function(t){var s=t(r);s?u(s).then(o,c):e(r,i).then(o,c)}),c),a}}(r,e),l=!0}function m(e,t){void 0===t&&(t="Midgard");var s=t+e;return r(s)||function(e){try{return sessionStorage.getItem(e)||""}catch(e){return""}}(s)}const p=()=>Promise.all([s.e("vendors~graph-loop"),s.e("graph-loop")]).then(s.t.bind(null,"ovXq",7)),g=()=>s.e("graph-loop-prefetch").then(s.t.bind(null,"I/fs",7)),f=()=>s.e("strings").then(s.t.bind(null,"ggYx",7)),y=()=>s.e("chunk").then(s.t.bind(null,"1dRC",7)),v=()=>y().then((e=>e.graph)),b=()=>y().then((e=>e.graphPrefetch)),S=()=>y().then((e=>e.graphStrings));let C;const w=()=>(void 0!==C||(C=function(e,t){if(void 0===t&&(t="Midgard"),l)return l;var i=r(t+"OnlyOverrideCatalog");if(i&&i!==e)return!1;var n,a,o,c=(a="versionless/",(o=(n=s.p||"").indexOf(a))>=0&&o+a.length===n.length?n.substr(0,o):"https://res.cdn.office.net/midgard/"),u=c+"versionless/",p=m("Version",t);if(p)return h(u,c+p+"/",e);var g=m("Branch",t);if(g){var f="https://midgardbranches.blob.core.windows.net/lpc/refs/heads/"+g+"/";return h(f,f,e)}var y=m("Local",t);if(y){var v="https://localhost:"+(parseInt(y,10)||9e3)+"/";return d(Promise.resolve((function(e){return v+e+".js"})),v)}return l}("graphloop")),C)}})},83487:(e,t,s)=>{"use strict";var r;s.d(t,{T:()=>r}),function(e){e.ComponentEnabled="graphLoop.componentEnabled",e.SubstrateResourceIframeEnabled="graphLoop.substrateResourceIframeEnabled",e.ACAutoRefreshEnabled="graphLoop.acAutoRefreshEnabled",e.AllowedContentSources="graphLoop.allowedContentSources"}(r||(r={}))},47667:(e,t,s)=>{"use strict";let r,i;s.d(t,{L5:()=>c});try{r=localStorage}catch(e){}r||(r=void 0);try{i=sessionStorage}catch(e){}i||(i=void 0);const n=new URLSearchParams("undefined"!=typeof location?location.search:""),a=new Map;function o(e){if(null!=e){let t;try{t=JSON.parse(e)}catch(e){}const s=void 0!==t?t:e;return"on"===s||"off"===s?"on"===s:s}}function c(e,t,s){return s?s.getSetting(e,t,"FluidExperiences"):function(e,t){const s=function(e,t){const s=a.get(e);if(void 0!==s)return s;let i,c,u;return u=void 0!==(i=function(e){return o(n.get(e))}(e))?i:void 0!==(c=function(e){var t;return o(null===(t=r)||void 0===t?void 0:t.getItem(e))}(e))?c:t,a.set(e,u),u}(e,t);return s}(e,t)}},82298:(e,t,s)=>{"use strict";s.d(t,{en:()=>r});const r="URL"},73228:(e,t,s)=>{"use strict";s.d(t,{L:()=>c});var r=s(25910),i=s(97743),n=s(57549),a=s(46421),o=s(73);class c extends o.y{constructor(){super(...arguments),this.rootDirectoryId="root"}async request(e){const t=n.R.create(e);if("bigBlobs"===t.pathParts[0]){const e=this.root.get(t.pathParts.join("/"));return void 0===e?(0,a.I4)(t):{mimeType:"fluid/object",status:200,value:e}}return super.request(t)}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(e){e?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===i.c.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=r.u.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(e)}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}}},73:(e,t,s)=>{"use strict";s.d(t,{y:()=>u});var r=s(42019);class i extends r.L{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==e){const t=t=>this.unforwardEvent(e,t),s=t=>this.forwardEvent(e,t);this.on(i.removeListenerEvent,t),this.on(i.newListenerEvent,s)}}static isEmitterEvent(e){return e===i.newListenerEvent||e===i.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const e of this.forwardingEvents.values())for(const t of e.values())try{t()}catch(e){}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const s of t)if(void 0!==e&&void 0!==s&&!i.isEmitterEvent(s)){let t=this.forwardingEvents.get(s);if(void 0===t&&(t=new Map,this.forwardingEvents.set(s,t)),!t.has(e)){const r=(...e)=>this.emit(s,...e);t.set(e,(()=>e.off(s,r))),e.on(s,r)}}}unforwardEvent(e,...t){for(const s of t)if(void 0!==s&&!i.isEmitterEvent(s)){const t=this.forwardingEvents.get(s);if((null==t?void 0:t.has(e))&&0===this.listenerCount(s)){const r=t.get(e);void 0!==r&&r(),t.delete(e),0===t.size&&this.forwardingEvents.delete(s)}}}}i.newListenerEvent="newListener",i.removeListenerEvent="removeListener";var n=s(44098),a=s(99139);class o{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){(0,n.h)(!1,202)}async get(){const e=await this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(200===e.status&&"fluid/object"===e.mimeType)return e.value;throw new Error(`Failed to resolve container path ${this.absolutePath}`)}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}var c=s(46421);class u extends i{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,(0,n.h)(void 0===this.runtime._dataObject,189),this.runtime._dataObject=this,this.innerHandle=new a.B(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",(()=>{this._disposed=!0,this.dispose()}))}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static async getDataObject(e){const t=e._dataObject;return(0,n.h)(void 0!==t,188),await t.finishInitialization(!0),t}async request(e){return this,""===(t=e).url||"/"===t.url||t.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:this}:(0,c.I4)(t);var t}async finishInitialization(e){return void 0!==this.initializeP||(this.initializeP=this.initializeInternal(e)),this.initializeP}async initializeInternal(e){var t;await this.preInitialize(),e?((0,n.h)(void 0===this.initProps,190),await this.initializingFromExisting()):await this.initializingFirstTime(null!==(t=this.context.createProps)&&void 0!==t?t:this.initProps),await this.hasInitialized()}async getFluidObjectFromDirectory(e,t,s){const r=s?s(e,t):t.get(e),i=null==r?void 0:r.IFluidHandle;if(i)return i.get()}async getService(e){return(t=`/_services/${e}`,s=this.context.containerRuntime,new o(t,s)).get();var t,s}async preInitialize(){}async initializingFirstTime(e){}async initializingFromExisting(){}async hasInitialized(){}dispose(){super.dispose()}}},44098:(e,t,s)=>{"use strict";function r(e,t){if(!e)throw new Error("number"==typeof t?`0x${t.toString(16).padStart(3,"0")}`:t)}s.d(t,{h:()=>r})},19048:(e,t,s)=>{"use strict";s.d(t,{IN:()=>n,k8:()=>a,pv:()=>u,zT:()=>o});var r=s(17086),i=s(44098);function n(e,t){switch(t){case"base64":return r.JQ(e);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(e);default:throw new Error("invalid/unsupported encoding")}}const a=(e,t)=>u.from(e,t).buffer,o=(e,t)=>u.from(e).toString(t);function c(e){const t=e;return e instanceof ArrayBuffer||"object"==typeof t&&null!==t&&"number"==typeof t.byteLength&&"function"==typeof t.slice&&void 0===t.byteOffset&&void 0===t.buffer}class u extends Uint8Array{toString(e){return n(this,e)}static from(e,t,s){if("string"==typeof e)return u.fromString(e,t);if(null!==e&&"object"==typeof e&&c(e.buffer))return(0,i.h)(0===e.byteOffset,0),(0,i.h)(e.byteLength===e.buffer.byteLength,1),u.fromArrayBuffer(e.buffer,t,s);if(c(e))return u.fromArrayBuffer(e,t,s);throw new TypeError}static fromArrayBuffer(e,t,s){const r=null!=t?t:0,i=null!=s?s:e.byteLength-r;if(r<0||r>e.byteLength||i<0||i+r>e.byteLength)throw new RangeError;return new u(e,r,i)}static fromString(e,t){switch(t){case"base64":{const t=this.sanitizeBase64(e),s=r.b$(t);return new u(s.buffer)}case"utf8":case"utf-8":case void 0:{const t=(new TextEncoder).encode(e);return new u(t.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}},7593:(e,t,s)=>{"use strict";s.d(t,{o:()=>r});class r{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}},72570:(e,t,s)=>{"use strict";s.d(t,{S:()=>r});const r=window.performance},40544:(e,t,s)=>{"use strict";s.d(t,{B:()=>r,d:()=>i});class r{constructor(){this.completed=!1,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}class i{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}async then(e,t){return this.getPromise().then(...arguments)}async catch(e){return this.getPromise().catch(...arguments)}async finally(e){return this.getPromise().finally(...arguments)}async getPromise(){return void 0===this.result&&(this.result=this.execute()),this.result}}},42019:(e,t,s)=>{"use strict";s.d(t,{L:()=>i});var r=s(67725);class i extends r.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}},1362:(e,t,s)=>{"use strict";function r(e,t="Unreachable Case"){throw new Error(t)}s.d(t,{U:()=>r})},95336:(e,t,s)=>{"use strict";var r,i;s.d(t,{mB:()=>r,xU:()=>i}),function(e){e.Detached="Detached",e.Attaching="Attaching",e.Attached="Attached"}(r||(r={})),function(e){e.NotBound="NotBound",e.Binding="Binding",e.Bound="Bound"}(i||(i={}))},38756:(e,t,s)=>{"use strict";var r;s.d(t,{kE:()=>It,lf:()=>Et}),function(e){e.cache="fluid-cache",e.clientDetails="fluid-client-details",e.loadMode="loadMode",e.reconnect="fluid-reconnect",e.sequenceNumber="fluid-sequence-number",e.version="version"}(r||(r={}));var i=s(95336),n=s(72570);class a{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=n.S.now();return new a(e)}trace(){const e=n.S.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}var o,c=s(44098),u=s(42019),l=s(1362),h=s(90682),d=s(18977),m=s(58196);!function(e){e.summarizingClient="fluid-client-summarizer",e.createNew="createNew"}(o||(o={}));var p,g=s(71062);function f(e){return!!Object.values(p).includes(e.type)}!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(p||(p={}));var y=s(52578),v=s(67008),b=s(53039),S=s(92992),C=s(40544);function w(e){const t={};for(const[s,r]of Object.entries(e.gcNodes))t[s]=Array.from(r);return{gcNodes:t}}var T=s(88628);const N="_baseSummary";class P{constructor(e){this.path=e}static create(e){return new P(encodeURIComponent(e))}static createAndConcat(e){var t;let s=P.create(null!==(t=e[0])&&void 0!==t?t:"");for(let t=1;t<e.length;t++)s=s.concat(P.create(e[t]));return s}toString(){return this.path}concat(e){return new P(`${this.path}/${e.path}`)}}class E{constructor(e){this.summary=e}static createForRoot(e){return new E({referenceSequenceNumber:e,basePath:void 0,localPath:P.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return null!==(t=null===(e=this.basePath)||void 0===e?void 0:e.concat(this.localPath))&&void 0!==t?t:this.localPath}get fullPathForChildren(){return void 0!==this.additionalPath?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new E({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:P.create(e)})}}function D(e,t){let s=e;const r=[],i=[];for(let e=0;;e++){e>100&&t.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:100});const n=s.blobs._outstandingOps,a=s.trees._baseSummary;if(void 0===n&&void 0===a)return{baseSummary:s,pathParts:r,async getOutstandingOps(e){let s=[];for(const r of i){const i=await e(r);if(s.length>0&&i.length>0){const e=s[s.length-1].sequenceNumber,r=i[0].sequenceNumber;if(r<=e)for(t.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${r} <= ${e}`});i.length>0&&i[0].sequenceNumber<=e;)i.shift()}s=s.concat(i)}return s}};(0,c.h)(!!n,431),(0,c.h)(void 0!==a,432),s=a,r.push(N),i.unshift(n)}}function O(e){const t=e.trees[S.channelsTreeName];return void 0!==t?{childrenTree:t,childrenPathPart:S.channelsTreeName}:{childrenTree:e,childrenPathPart:void 0}}class k{constructor(e,t,s,r,i,n,a){var o;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=r,this._latestSummary=i,this.initialSummary=n,this.wipSummaryLogger=a,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=null===(o=s.canReuseHandle)||void 0===o||o,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return null!==(t=null===(e=this._latestSummary)||void 0===e?void 0:e.referenceSequenceNumber)&&void 0!==t?t:0}startSummary(e,t){(0,c.h)(void 0===this.wipSummaryLogger,415),(0,c.h)(void 0===this.wipReferenceSequenceNumber,416),this.wipSummaryLogger=t;for(const t of this.children.values())t.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}async summarize(e,t=!0,s){if((0,c.h)(this.isTrackingInProgress(),417),(0,c.h)(void 0!==this.wipSummaryLogger,418),this.canReuseHandle&&!e&&!this.hasChanged()){const e=this._latestSummary;if(void 0!==e){this.wipLocalPaths={localPath:e.localPath,additionalPath:e.additionalPath},this.wipSkipRecursion=!0;const t=(0,T.Jz)();return t.handleNodeCount++,{summary:{type:b.J.Handle,handle:e.fullPath.path,handleType:b.J.Tree},stats:t}}}try{const t=await this.summarizeInternalFn(e,!0,s);return this.wipLocalPaths={localPath:P.create(t.id)},void 0!==t.pathPartsForChildren&&(this.wipLocalPaths.additionalPath=P.createAndConcat(t.pathPartsForChildren)),{summary:t.summary,stats:t.stats}}catch(e){if(this.throwOnError||this.trackingSequenceNumber<this._changeSequenceNumber)throw e;const t=this._latestSummary,s=this.initialSummary;let r,i;if(void 0!==t)r={fromSummary:!0,summaryNode:t},i=t.localPath;else{if(void 0===(null==s?void 0:s.summary))throw e;r={fromSummary:!1,initialSummary:s.summary},i=P.create(s.id)}this.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},e);const n=function(e,t){let s=P.create(N);const r=new T.x1;if(r.addBlob("_outstandingOps",JSON.stringify(t)),e.fromSummary){const t=e.summaryNode;void 0!==t.additionalPath&&(s=s.concat(t.additionalPath)),r.addHandle(N,b.J.Tree,t.fullPath.path)}else r.addWithStats(N,e.initialSummary);const i=r.getSummaryTree();return Object.assign(Object.assign({},i),{additionalPath:s})}(r,this.outstandingOps);return this.wipLocalPaths={localPath:i,additionalPath:n.additionalPath},this.wipSkipRecursion=!0,{summary:n.summary,stats:n.stats}}}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,s){(0,c.h)(void 0!==this.wipSummaryLogger,419),(0,c.h)(void 0!==this.wipReferenceSequenceNumber,420);let r=this.wipLocalPaths;if(s){const e=this._latestSummary;if(void 0===e)return void this.clearSummary();r={localPath:e.localPath,additionalPath:e.additionalPath}}(0,c.h)(!!r,421);const i=new E(Object.assign(Object.assign({},r),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),n=i.fullPathForChildren;for(const t of this.children.values())t.completeSummaryCore(e,n,this.wipSkipRecursion||s);this.pendingSummaries.set(e,i),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const e of this.children.values())e.clearSummary()}async refreshLatestSummary(e,t,s,r,i){if(void 0!==e){const t=this.pendingSummaries.get(e);if(void 0!==t)return this.refreshLatestSummaryFromPending(e,t.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(this.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};const n=await s();return await this.refreshLatestSummaryFromSnapshot(t,n,void 0,P.create(""),i,r),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:n}}refreshLatestSummaryFromPending(e,t){const s=this.pendingSummaries.get(e);if(void 0!==s){(0,c.h)(t===s.referenceSequenceNumber,423),this.pendingSummaries.delete(e),this.refreshLatestSummaryCore(t),this._latestSummary=s;for(const s of this.children.values())s.refreshLatestSummaryFromPending(e,t)}else(0,c.h)(void 0===this._latestSummary,422)}async refreshLatestSummaryFromSnapshot(e,t,s,r,i,n){if(this.referenceSequenceNumber>=e)return;this.refreshLatestSummaryCore(e);const{baseSummary:a,pathParts:o}=D(t,i);this._latestSummary=new E({referenceSequenceNumber:e,basePath:s,localPath:r});const{childrenTree:c,childrenPathPart:u}=O(a);void 0!==u&&o.push(u),o.length>0&&(this._latestSummary.additionalPath=P.createAndConcat(o));const l=this._latestSummary.fullPathForChildren;await Promise.all(Array.from(this.children).filter((([e])=>void 0!==c.trees[e])).map((async([t,s])=>s.refreshLatestSummaryFromSnapshot(e,c.trees[t],l,P.create(t),i,n))))}refreshLatestSummaryCore(e){for(const[t,s]of this.pendingSummaries)s.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){const{childrenPathPart:t}=O(e);void 0!==t&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=P.create(t))}async loadBaseSummary(e,t){const s=D(e,this.defaultLogger),r=await s.getOutstandingOps(t),{childrenPathPart:i}=O(s.baseSummary);if(void 0!==i&&s.pathParts.push(i),s.pathParts.length>0&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=P.createAndConcat(s.pathParts)),r.length>0){const e=r[r.length-1].sequenceNumber;(0,c.h)(e<=this.trackingSequenceNumber,425)}return{baseSummary:s.baseSummary,outstandingOps:r}}recordChange(e){const t=this.outstandingOps[this.outstandingOps.length-1];void 0!==t&&(0,c.h)(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,s,r={}){(0,c.h)(!this.children.has(t),427);const i=this.getCreateDetailsForChild(t,s),n=new k(this.defaultLogger,e,r,i.changeSequenceNumber,i.latestSummary,i.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(n),this.children.set(t,n),n}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var s;let r,i,n;const a=this._latestSummary;switch(t.type){case S.CreateSummarizerNodeSource.FromAttach:if(void 0!==a&&t.sequenceNumber<=a.referenceSequenceNumber)i=a.createForChild(e);else{const s=(0,T.j9)(t.snapshot);r={sequenceNumber:t.sequenceNumber,id:e,summary:s}}n=t.sequenceNumber;break;case S.CreateSummarizerNodeSource.FromSummary:void 0===this.initialSummary&&(0,c.h)(!!a,428);case S.CreateSummarizerNodeSource.Local:{const o=this.initialSummary;if(void 0!==o){let s,i;if(void 0!==o.summary){const{childrenTree:t}=function(e){const t=e.tree[S.channelsTreeName];return void 0!==t?{childrenTree:t,childrenPathPart:S.channelsTreeName}:{childrenTree:e,childrenPathPart:void 0}}(o.summary.summary);(0,c.h)(t.type===b.J.Tree,470),s=t.tree[e]}t.type===S.CreateSummarizerNodeSource.FromSummary&&(0,c.h)(!!s,429),void 0!==s&&((0,c.h)(s.type===b.J.Tree,430),i={summary:s,stats:(0,T.i6)(s)}),r={sequenceNumber:o.sequenceNumber,id:e,summary:i}}i=null==a?void 0:a.createForChild(e),n=null!==(s=null==a?void 0:a.referenceSequenceNumber)&&void 0!==s?s:-1;break}default:{const e=t.type;(0,l.U)(t,`Unexpected CreateSummarizerNodeSource: ${e}`)}}return{initialSummary:r,latestSummary:i,changeSequenceNumber:n}}maybeUpdateChildState(e){this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber)}isTrackingInProgress(){return void 0!==this.wipReferenceSequenceNumber}}class _ extends E{constructor(e,t){super(t),this.serializedUsedRoutes=e}}class A extends k{constructor(e,t,s,r,i,n,a,o,c){super(e,(async(e,s,r)=>t(e,!0,r)),s,r,i,n,a),this.summarizeFn=t,this.getGCDataFn=o,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=!0===s.gcDisabled,this.baseGCDetailsP=new C.d((async()=>{var e;return null!==(e=await(null==c?void 0:c()))&&void 0!==e?e:{usedRoutes:[]}}))}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}async loadBaseGCDetails(){var e;const t=await this.baseGCDetailsP;this.baseGCDetailsLoaded||(this.baseGCDetailsLoaded=!0,void 0!==t.gcData&&(this.gcData=w(t.gcData)),this.referenceUsedRoutes=null===(e=t.usedRoutes)||void 0===e?void 0:e.sort(),this.unreferencedTimestampMs=t.unrefTimestamp)}async summarize(e,t=!0,s){return!this.gcDisabled&&this.isTrackingInProgress()&&(0,c.h)(void 0!==this.wipSerializedUsedRoutes,433),t?super.summarize(e,!0,s):this.summarizeFn(e,t,s)}async getGCData(e=!1){if((0,c.h)(!this.gcDisabled,434),(0,c.h)(void 0!==this.getGCDataFn,435),await this.loadBaseGCDetails(),!e&&!this.hasDataChanged()&&void 0!==this.gcData)return w(this.gcData);const t=await this.getGCDataFn(e);return this.gcData=w(t),t}startSummary(e,t){this.gcDisabled||(0,c.h)(void 0===this.wipSerializedUsedRoutes,436),super.startSummary(e,t)}completeSummaryCore(e,t,s){let r;if(this.gcDisabled||(r=this.wipSerializedUsedRoutes,(0,c.h)(void 0!==r,437)),super.completeSummaryCore(e,t,s),!this.gcDisabled){const t=this.pendingSummaries.get(e);if(void 0!==t){const s=new _(r,t);this.pendingSummaries.set(e,s)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){const t=this.pendingSummaries.get(e);void 0!==t&&(this.referenceUsedRoutes=JSON.parse(t.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}async refreshLatestSummaryFromSnapshot(e,t,s,r,i,n){if(!this.gcDisabled){const s=t.blobs[S.gcBlobKey];if(void 0!==s){const t=await n(s);if(this.referenceSequenceNumber>=e)return;this.referenceUsedRoutes=t.usedRoutes}}return super.refreshLatestSummaryFromSnapshot(e,t,s,r,i,n)}createChild(e,t,s,r={},i,n){var a;(0,c.h)(!this.children.has(t),438);const o=this.getCreateDetailsForChild(t,s),u=new A(this.defaultLogger,e,Object.assign(Object.assign({},r),{gcDisabled:null!==(a=r.gcDisabled)&&void 0!==a?a:this.gcDisabled}),o.changeSequenceNumber,o.latestSummary,o.initialSummary,this.wipSummaryLogger,i,n);return this.maybeUpdateChildState(u),this.children.set(t,u),u}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()?this.unreferencedTimestampMs=void 0:void 0===this.unreferencedTimestampMs&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return!this.gcDisabled&&(void 0===this.referenceUsedRoutes||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes))}}var I=s(57549),M=s(46421);function R(e){const t={};for(const[s,r]of Object.entries(e.gcNodes))t[s]=Array.from(r);return{gcNodes:t}}function F(e,t){var s;const r={};for(const[t,s]of Object.entries(e.gcNodes))r[t]={outboundRoutes:Array.from(s.outboundRoutes),unreferencedTimestampMs:s.unreferencedTimestampMs};for(const[e,i]of Object.entries(t.gcNodes)){let t=r[e];void 0===t?t={outboundRoutes:Array.from(i.outboundRoutes),unreferencedTimestampMs:i.unreferencedTimestampMs}:(void 0!==i.unreferencedTimestampMs&&void 0!==t.unreferencedTimestampMs&&(0,c.h)(i.unreferencedTimestampMs===t.unreferencedTimestampMs,690),t={outboundRoutes:[...new Set([...i.outboundRoutes,...t.outboundRoutes])],unreferencedTimestampMs:null!==(s=i.unreferencedTimestampMs)&&void 0!==s?s:t.unreferencedTimestampMs}),r[e]=t}return{gcNodes:r}}class x{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,s]of Object.entries(this.gcNodesSet))e[t]=[...s];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[s,r]of Object.entries(t)){let t=s.replace(/^\/+/g,"");t=`/${e}/${t}`,t=t.replace(/\/+$/g,""),this.gcNodesSet[t]=new Set(r)}}addNodes(e){for(const[t,s]of Object.entries(e))this.gcNodesSet[t]=new Set(s)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}var L=s(50084),z=s(97495);class j{constructor(e,t,s){this.path=e,this.runtime=t,this.routeContext=s,this.absolutePath=(0,z.H)(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==i.mB.Detached}async resolveHandle(e){return this.runtime.resolveHandle(e)}}var B,q,G=s(62044),U=s(67725);(q=B||(B={})).genericError="genericError",q.genericNetworkError="genericNetworkError",q.authorizationError="authorizationError",q.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",q.throttlingError="throttlingError",q.offlineError="offlineError",q.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",q.writeError="writeError",q.fetchFailure="fetchFailure",q.incorrectServerResponse="incorrectServerResponse",q.fileOverwrittenInStorage="fileOverwrittenInStorage",q.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",q.locationRedirection="locationRedirection";var V=s(57921),H=s(90783);const X="summarizer";class $ extends u.L{constructor(e,t,s,r,i){super(),this.logger=e,this.summaryCollection=t,this.clientElection=s,this.maxOpsSinceLastSummary=r,this.electionEnabled=i,this.lastReportedSeq=0,this.summaryCollection.on("default",(({sequenceNumber:e})=>{var t,s,i;const n=this.electedClientId;if(void 0===n)return void(this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(e));let a=this.clientElection.electionSequenceNumber;if(e-(null!==(t=this.lastSummaryAckSeqForClient)&&void 0!==t?t:a)>this.maxOpsSinceLastSummary){const t=e-this.lastReportedSeq;if(t>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:n,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:a,nextElectedClientId:null===(s=this.clientElection.peekNextElectedClient())||void 0===s?void 0:s.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=e),this.electionEnabled){const s=this.electedParentId;this.clientElection.incrementElectedClient(e),a=this.clientElection.electionSequenceNumber,e>(null!==(i=this.lastSummaryAckSeqForClient)&&void 0!==i?i:a)&&t>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:a,sequenceNumber:e,previousClientId:n,previousParentId:s,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:t,maxOpsSinceLastSummary:r})}}})),this.summaryCollection.on(g.C.SummaryAck,(e=>{this.lastSummaryAckSeqForClient=e.sequenceNumber})),this.clientElection.on("election",((e,t)=>{this.lastSummaryAckSeqForClient=void 0,void 0===e&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(t),this.emit("electedSummarizerChanged")}))}get electedClientId(){var e;return null===(e=this.clientElection.electedClient)||void 0===e?void 0:e.clientId}get electedParentId(){var e;return null===(e=this.clientElection.electedParent)||void 0===e?void 0:e.clientId}serialize(){var e;const{electedClientId:t,electedParentId:s,electionSequenceNumber:r}=this.clientElection.serialize();return{electedClientId:t,electedParentId:s,electionSequenceNumber:null!==(e=this.lastSummaryAckSeqForClient)&&void 0!==e?e:r}}static isClientEligible(e){const t=e.client.details;return void 0===t||$.clientDetailsPermitElection(t)}}$.clientDetailsPermitElection=e=>e.capabilities.interactive||e.type===X;var W=s(99139);class J extends W.B{async get(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")}attach(){}bind(e){}}class K{constructor(e,t,s=(()=>Date.now())){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=s}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var s,r;if(this.runningState){const i=null!=e?e:this.runningState.intendedDuration,n=null!==(r=null!=t?t:null===(s=this.runningState.restart)||void 0===s?void 0:s.handler)&&void 0!==r?r:this.runningState.handler,a=this.calculateRemainingTime(this.runningState);i<a?this.start(i,n):i===a?(this.runningState.handler=n,this.runningState.restart=void 0,this.runningState.intendedDuration=i):this.runningState.restart={startTick:this.getCurrentTick(),duration:i,handler:n}}else this.start(e,t)}startCore(e,t,s){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:s,handler:t,timeout:setTimeout((()=>this.handler()),e)}}handler(){(0,c.h)(!!this.runningState,10);const e=this.runningState.restart;if(void 0!==e){const t=this.calculateRemainingTime(e);this.startCore(t,(()=>e.handler()),e.duration)}else{const e=this.runningState.handler;this.clear(),e()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class Q{constructor(e,t){this.timer=new K(e,(()=>this.wrapHandler(t)))}get hasTimer(){return this.timer.hasTimer}async start(e,t){return this.clear(),this.deferred=new C.B,this.timer.start(e,t?()=>this.wrapHandler(t):void 0),this.deferred.promise}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),(0,c.h)(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}const Z=async e=>new Promise((t=>setTimeout((()=>t()),e)));class Y{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:null!=e?e:this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}class ee{constructor(e,t,s,r){this.heuristicData=e,this.configuration=t,this.trySummarize=s,this.logger=r,this.idleTimer=new K(this.configuration.idleTime,(()=>this.trySummarize("idle"))),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){const e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){const e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}}var te,se;!function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online",e[e.Unknown=2]="Unknown"}(se||(se={}));class re extends V.j4{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=re.errorType,this.canRetry=!1}}re.errorType=null!==(te=B.deltaStreamConnectionForbidden)&&void 0!==te?te:"deltaStreamConnectionForbidden";const ie=e=>null==e?void 0:e.retryAfterSeconds;async function ne(e,t,s){const r=[e.then((e=>({result:"done",value:e}))),t.then((({timerResult:e})=>({result:e})))];return void 0!==s&&r.push(s.waitCancelled.then((()=>({result:"cancelled"})))),Promise.race(r)}const ae={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"};class oe{constructor(){this.summarySubmitted=new C.B,this.summaryOpBroadcasted=new C.B,this.receivedSummaryAckOrNack=new C.B}fail(e,t,s,r){(0,c.h)(!this.receivedSummaryAckOrNack.isCompleted,606);const i={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:r};this.summarySubmitted.resolve(i),this.summaryOpBroadcasted.resolve(i),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},i),{data:s}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}class ce{constructor(e,t,s,r,i,n,a){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=s,this.raiseSummarizingError=r,this.successfulSummaryCallback=i,this.summaryWatcher=n,this.logger=a,this.summarizeTimer=new K(2e4,(()=>this.summarizeTimerHandler(2e4,1)))}summarize(e,t,s,r=new oe){return this.summarizeCore(e,t,r,s).catch((t=>{const s="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:s},e),t),r.fail(s,t)})),r.build()}async summarizeCore(e,t,s,r){const{refreshLatestAck:i,fullTree:n}=t,a=h.G2.create(this.logger,void 0,{all:e});let o={fullTree:n,timeSinceLastAttempt:Date.now()-this.heuristicData.lastAttempt.summaryTime,timeSinceLastSummary:Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime};const u=h.Xr.start(a,Object.assign({eventName:"Summarize",refreshLatestAck:i},o)),l=(e,t,i,n)=>{this.raiseSummarizingError(ae[e]);const a=ie(t),o=r.cancelled||(null==t?void 0:t.errorType)===B.offlineError?"generic":"error";u.cancel(Object.assign(Object.assign({},i),{reason:e,category:o,retryAfterSeconds:a}),t),s.fail((e=>`${e}: ${ae[e]}`)(e),t,n,a)};let d;this.summarizeTimer.start();try{d=await this.submitSummaryCallback({fullTree:n,refreshLatestAck:i,summaryLogger:a,cancellationToken:r});const e=d.referenceSequenceNumber,t=e-this.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(o=Object.assign(Object.assign({},o),{referenceSequenceNumber:e,minimumSequenceNumber:d.minimumSequenceNumber,opsSinceLastAttempt:e-this.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:t}),"base"!==d.stage&&(o=Object.assign(Object.assign(Object.assign({},o),d.summaryStats),{generateDuration:d.generateDuration}),"generate"!==d.stage&&(o=Object.assign(Object.assign({},o),{handle:d.handle,uploadDuration:d.uploadDuration}),"upload"!==d.stage&&(o=Object.assign(Object.assign({},o),{clientSequenceNumber:d.clientSequenceNumber})))),"submit"!==d.stage)return l("submitSummaryFailure",d.error,o);if(!n&&!d.forcedFullTree){const{summarizedDataStoreCount:e,gcStateUpdatedDataStoreCount:s=0}=d.summaryStats;e>s+t&&a.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:e,gcStateUpdatedDataStoreCount:s,opsSinceLastSummary:t})}u.reportEvent("generate",Object.assign({},o)),s.summarySubmitted.resolve({success:!0,data:d})}catch(e){return l("submitSummaryFailure",e)}finally{this.heuristicData.recordAttempt(null==d?void 0:d.referenceSequenceNumber),this.summarizeTimer.clear()}try{const e=this.pendingAckTimer.start(),t=this.summaryWatcher.watchSummary(d.clientSequenceNumber),i=await ne(t.waitBroadcast(),e,r);if("cancelled"===i.result)return l("disconnect");if("done"!==i.result)return l("summaryOpWaitTimeout");const n=i.value,h=Date.now()-this.heuristicData.lastAttempt.summaryTime;s.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:n,broadcastDuration:h}}),this.heuristicData.lastAttempt.summarySequenceNumber=n.sequenceNumber,a.sendTelemetryEvent({eventName:"Summarize_Op",duration:h,referenceSequenceNumber:n.referenceSequenceNumber,summarySequenceNumber:n.sequenceNumber,handle:n.contents.handle});const m=await ne(t.waitAckNack(),e,r);if("cancelled"===m.result)return l("disconnect");if("done"!==m.result)return l("summaryAckWaitTimeout");const p=m.value;this.pendingAckTimer.clear();const f=Date.now()-this.heuristicData.lastAttempt.summaryTime;if(o=Object.assign({ackWaitDuration:f,ackNackSequenceNumber:p.sequenceNumber,summarySequenceNumber:p.contents.summaryProposal.summarySequenceNumber},o),p.type!==g.C.SummaryAck){(0,c.h)(p.type===g.C.SummaryNack,628);const e=p.contents,t=null==e?void 0:e.message,s=null==e?void 0:e.retryAfter,r=new V.j4(`Received summaryNack: ${t}`,{retryAfterSeconds:s});return(0,c.h)(ie(r)===s,607),l("summaryNack",r,Object.assign(Object.assign({},o),{nackRetryAfter:s}),{summaryNackOp:p,ackNackDuration:f})}this.heuristicData.markLastAttemptAsSuccessful(),this.successfulSummaryCallback(),u.end(Object.assign(Object.assign({},o),{handle:p.contents.handle})),s.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:p,ackNackDuration:f}})}finally{this.pendingAckTimer.clear()}}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<5){const s=2*e;this.summarizeTimer.start(s,(()=>this.summarizeTimerHandler(s,t+1)))}}dispose(){this.summarizeTimer.clear()}}var ue,le=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};class he{constructor(e,t,s,r,i,n,a,o,u){this.summaryWatcher=t,this.configuration=s,this.submitSummaryCallback=r,this.heuristicData=i,this.raiseSummarizingError=n,this.summaryCollection=a,this.cancellationToken=o,this.stopSummarizerCallback=u,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=e=>this.heuristicData.lastAttempt.refSequenceNumber===e?this.logger:void 0;const l={summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts};this.logger=h.G2.create(e,"Running",{all:l}),"disableHeuristics"!==s.state&&((0,c.h)("enabled"===this.configuration.state,746),this.heuristicRunner=new ee(i,this.configuration,(e=>this.trySummarize(e)),this.logger)),(0,c.h)("disabled"!==this.configuration.state,747);const d=Math.min(this.configuration.maxAckWaitTime,6e5);this.pendingAckTimer=new Q(d,(()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:d,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})})),a.setPendingAckTimerTimeoutCallback(d,(()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())})),this.generator=new ce(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,(()=>{this.totalSuccessfulAttempts++}),this.summaryWatcher,this.logger)}static async start(e,t,s,r,i,n,a,o,c){var u;const l=new he(e,t,s,r,i,n,a,o,c);return await l.waitStart(),null===(u=l.heuristicRunner)||void 0===u||u.run(),l}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),null===(e=this.heuristicRunner)||void 0===e||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case g.C.ClientLeave:case g.C.ClientJoin:case g.C.Propose:return void this.handleOp(void 0,e);default:return}}handleOp(e,{sequenceNumber:t,type:s,clientId:r,contents:i}){var n;void 0===e&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||null===(n=this.heuristicRunner)||void 0===n||n.run())}async waitStop(e){var t;this.stopping||(this.stopping=!0,this.disposeEnqueuedSummary(),e&&(null===(t=this.heuristicRunner)||void 0===t?void 0:t.shouldRunLastSummary())&&void 0===this.summarizingLock&&this.trySummarizeOnce({reason:"lastSummary"},{}),await this.summarizingLock)}async waitStart(){const e=await ne(this.summaryWatcher.waitFlushed(),this.pendingAckTimer.start());this.pendingAckTimer.clear(),this.summaryCollection.unsetPendingAckTimerTimeoutCallback(),"done"===e.result&&void 0!==e.value&&this.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:e.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:e.value.summaryOp.sequenceNumber})}async lockedRefreshSummaryAckAction(e){(0,c.h)(void 0===this.refreshSummaryAckLock,"Refresh Summary Ack - Caller is responsible for checking lock");const t=new C.B;return this.refreshSummaryAckLock=t.promise,e().finally((()=>{t.resolve(),this.refreshSummaryAckLock=void 0}))}async lockedSummaryAction(e){(0,c.h)(void 0===this.summarizingLock,603);const t=new C.B;return this.summarizingLock=t.promise,this.summarizeCount++,await this.refreshSummaryAckLock,e().finally((()=>{var e;t.resolve(),this.summarizingLock=void 0;const s=this.tryWhileSummarizing;this.tryWhileSummarizing=!1,this.stopping||this.tryRunEnqueuedSummary()||!s||null===(e=this.heuristicRunner)||void 0===e||e.run()}))}trySummarizeOnce(e,t,s=this.cancellationToken,r=new oe){return this.lockedSummaryAction((async()=>this.generator.summarize(e,t,s,r).receivedSummaryAckOrNack)).catch((e=>{})),r.build()}trySummarize(e,t=this.cancellationToken){void 0===this.summarizingLock?this.lockedSummaryAction((async()=>{const s=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}];let r,i,n=0,a=0;for(let o=0;o<s.length;){if(this.cancellationToken.cancelled)return;if(++n>1&&"lastSummary"===e)return;a++;const c=s[o],{delaySeconds:u=0}=c,l=le(c,["delaySeconds"]),h=null!=r?r:u,d=Object.assign({reason:e,summaryAttempts:n,summaryAttemptsPerPhase:a,summaryAttemptPhase:o+1},l);h>0&&(this.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:h,summaryNackDelay:void 0!==r},d)),await Z(1e3*h)),await this.refreshSummaryAckLock;const m=this.generator.summarize(d,l,t),p=await m.receivedSummaryAckOrNack;if(p.success)return;r=p.retryAfterSeconds,(void 0===r||a>1)&&(o++,a=0),i=p}this.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:null==i?void 0:i.message},null==i?void 0:i.error),this.stopSummarizerCallback("failToSummarize")})).catch((e=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},e)})):this.tryWhileSummarizing=!0}summarizeOnDemand(e=new oe,t){var{reason:s}=t,r=le(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(void 0!==this.summarizingLock)throw new v.Oi("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${s}`},r,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:s=0,override:r=!1}=e,i=le(e,["reason","afterSequenceNumber","override"]);const n=`enqueue;${t}`;let a=!1;if(void 0!==this.enqueuedSummary){if(!r)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,a=!0}this.enqueuedSummary={reason:n,afterSequenceNumber:s,options:i,resultsBuilder:new oe};const o=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),a?Object.assign(Object.assign({},o),{alreadyEnqueued:!0,overridden:!0}):o}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(void 0===this.enqueuedSummary||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||void 0!==this.summarizingLock)return!1;const{reason:e,resultsBuilder:t,options:s}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},s,this.cancellationToken,t),!0}disposeEnqueuedSummary(){void 0!==this.enqueuedSummary&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}class de extends V.j4{constructor(e,t=!1){super(e),this.logged=t,this.errorType="summarizingError",this.canRetry=!0}static wrap(e,t=!1,s){return(0,V.bO)(e,(e=>new de(e,t)),s)}}class me extends U.EventEmitter{constructor(e,t,s,r,i,n,a){super(),this.runtime=t,this.configurationGetter=s,this.internalsProvider=r,this.summaryCollection=n,this.runCoordinatorCreateFn=a,this._disposed=!1,this.starting=!1,this.stopDeferred=new C.B,this.summarizeOnDemand=(...e)=>{var t;try{if(this._disposed||(null===(t=this.runningSummarizer)||void 0===t?void 0:t.disposed))throw new v.Oi("Summarizer is already disposed.");if(void 0!==this.runtime.summarizerClientId&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new v.Oi("On-demand summary attempted while an elected summarizer is present");const s=new oe;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(s,...e):(this.runCoordinatorCreateFn(this.runtime).then((t=>{this.start(this.runtime.clientId,t).then((async r=>{r.summarizeOnDemand(s,...e);const i=await Promise.race([this.stopDeferred.promise,t.waitCancelled]);await r.waitStop(!1),t.stop(i),this.close()})).catch((e=>{s.fail("Failed to start summarizer",e)}))})).catch((e=>{s.fail("Failed to create cancellation token",e)})),s.build())}catch(e){throw de.wrap(e,!1,this.logger)}},this.enqueueSummarize=(...e)=>{if(this._disposed||void 0===this.runningSummarizer||this.runningSummarizer.disposed)throw new v.Oi("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(...e)},this.logger=h.G2.create(this.runtime.logger,"Summarizer"),this.innerHandle=new J(this,e,i)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static async create(e,t){const s={headers:{[r.cache]:!1,[r.clientDetails]:{capabilities:{interactive:!1},type:X},[o.summarizingClient]:!0,[r.reconnect]:!1},url:t},i=await e.resolve(s),n=await(0,M.bb)(i,{url:"_summarizer"});if(void 0===n.ISummarizer)throw new v.Oi("Fluid object does not implement ISummarizer");return n.ISummarizer}async run(e){try{return await this.runCore(e)}catch(e){throw this.stop("summarizerException"),de.wrap(e,!1,this.logger)}finally{this.close()}}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}async runCore(e){const t=await this.runCoordinatorCreateFn(this.runtime),s=Promise.race([t.waitCancelled,this.stopDeferred.promise]);if(s.then((t=>{this.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:t})})),t.cancelled)return t.waitCancelled;const r=await this.start(e,t),i=await s;return await r.waitStop(!t.cancelled&&me.stopReasonCanRunLastSummary(i)),t.stop(i),i}static stopReasonCanRunLastSummary(e){return"parentNotConnected"===e}async start(e,t){if(this.runningSummarizer){if(this.runningSummarizer.disposed)throw new v.Oi("Starting a disposed summarizer");return this.runningSummarizer}if(this.starting)throw new v.Oi("Attempting to start a summarizer that is already starting");this.starting=!0,this.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:this.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(this.configurationGetter())});const s=this.runtime.clientId;if(void 0===s)throw new v.Oi("clientId should be defined if connected.");const r=await he.start(this.logger,this.summaryCollection.createWatcher(s),this.configurationGetter(),(async(...e)=>this.internalsProvider.submitSummary(...e)),new Y(this.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:this.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),(e=>{this._disposed||this.logger.sendErrorEvent({eventName:"summarizingError"},((e,t)=>new de(e,!0))(e))}),this.summaryCollection,t,(e=>t.stop(e)));return this.runningSummarizer=r,this.starting=!1,this.handleSummaryAcks().catch((e=>{this.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},e)})),this.systemOpListener=e=>r.handleSystemOp(e),this.runtime.deltaManager.inbound.on("op",this.systemOpListener),this.opListener=(e,t)=>r.handleOp(e,t),this.runtime.on("batchEnd",this.opListener),r}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}async handleSummaryAcks(){var e,t,s,r,i;let n,a=this.runtime.deltaManager.initialSequenceNumber;for(;this.runningSummarizer;){const o=null!==(e=this.runningSummarizer.tryGetCorrelatedLogger(a))&&void 0!==e?e:this.logger;try{n=void 0,n=await this.summaryCollection.waitSummaryAck(a),a=n.summaryOp.referenceSequenceNumber;const e=n.summaryOp.contents.handle,t=n.summaryAck.contents.handle;await this.runningSummarizer.lockedRefreshSummaryAckAction((async()=>this.internalsProvider.refreshLatestSummaryAck(e,t,a,o).catch((async s=>{if(!(0,H.IR)(s)||s.errorType!==B.fileNotFoundOrAccessDeniedError)throw s;o.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:a,proposalHandle:e,ackHandle:t},s)}))))}catch(e){o.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:a,handle:null===(s=null===(t=null==n?void 0:n.summaryOp)||void 0===t?void 0:t.contents)||void 0===s?void 0:s.handle,ackHandle:null===(i=null===(r=null==n?void 0:n.summaryAck)||void 0===r?void 0:r.contents)||void 0===i?void 0:i.handle},e)}a++}}}!function(e){e[e.Off=0]="Off",e[e.Starting=1]="Starting",e[e.Running=2]="Running",e[e.Stopping=3]="Stopping"}(ue||(ue={}));class pe{constructor(e,t,s,r,i,n,{initialDelayMs:a=5e3,opsToBypassInitialDelay:o=4e3}={},c){this.clientElection=e,this.connectedState=t,this.summaryCollection=s,this.requestSummarizerFn=i,this.startThrottler=n,this.disableHeuristics=c,this.state=ue.Off,this._disposed=!1,this.handleConnected=e=>{this.latestClientId=e,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const e=this.getShouldSummarizeState();switch(this.state){case ue.Off:return void(e.shouldSummarize&&this.startSummarization());case ue.Starting:return;case ue.Running:return void(!1===e.shouldSummarize&&this.stop(e.stopReason));case ue.Stopping:default:return}},this.summarizeOnDemand=(...e)=>{if(void 0===this.summarizer)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...e)},this.enqueueSummarize=(...e)=>{if(void 0===this.summarizer)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...e)},this.logger=h.G2.create(r,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=o,this.initialDelayMs=a}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){return this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==ue.Running&&this.connectedState.clientId!==this.clientElection.electedClientId?{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"}:this.connectedState.connected?this.disposed?void(0,c.h)(!1,608):{shouldSummarize:!0}:{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){(0,c.h)(this.state===ue.Off,609),this.state=ue.Starting,(0,c.h)(void 0===this.summarizer,610),this.delayBeforeCreatingSummarizer().then((async e=>{if(e&&!1===this.getShouldSummarizeState().shouldSummarize)return"early exit";(0,c.h)(this.state===ue.Starting,611),this.state=ue.Running;const t=await this.requestSummarizerFn();this.summarizer=t;const s=this.getShouldSummarizeState();if(!1===s.shouldSummarize)return this.state=ue.Starting,t.stop(s.stopReason),"early exit after starting summarizer";const r=this.latestClientId;return h.Xr.timedExecAsync(this.logger,{eventName:"RunningSummarizer",attempt:this.startThrottler.numAttempts},(async()=>t.run(r,this.disableHeuristics)))})).then((e=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:e})})).catch((e=>{if(this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},e),this.getShouldSummarizeState().shouldSummarize||void 0!==this.summarizer){const t=(null==e?void 0:e.errorType)===B.offlineError?"generic":"error";this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:t},e)}})).finally((()=>{var e;(0,c.h)(this.state!==ue.Off,612),this.state=ue.Off,null===(e=this.summarizer)||void 0===e||e.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()}))}stop(e){var t;pe.isStartingOrRunning(this.state)&&(this.state=ue.Stopping,null===(t=this.summarizer)||void 0===t||t.stop(e))}async delayBeforeCreatingSummarizer(){let e=this.startThrottler.getDelay();this.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:e,initialDelay:this.initialDelayMs,startThrottlerMaxDelayMs:this.startThrottler.maxDelayMs,opsSinceLastAck:this.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:this.opsToBypassInitialDelay});let t=!1;if(this.summaryCollection.opsSinceLastAck<this.opsToBypassInitialDelay&&(t=!0,e=Math.max(e,this.initialDelayMs)),e>0){let t,s;const r=()=>{this.summaryCollection.opsSinceLastAck>=this.opsToBypassInitialDelay&&(clearTimeout(t),s())},i=new Promise((s=>{t=setTimeout((()=>s()),e)})),n=new Promise((e=>{s=e}));this.summaryCollection.addOpListener(r),await Promise.race([i,n]),this.summaryCollection.removeOpListener(r)}return t}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}pe.isStartingOrRunning=e=>e===ue.Starting||e===ue.Running;class ge{constructor(e,t){this.logger=t,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=ge.processingTime,this.schedulingCount=0,this.deltaManager=e,this.deltaManager.inbound.on("idle",(()=>{this.inboundQueueIdle()}))}batchBegin(e){this.processingStartTime||(this.processingStartTime=n.S.now()),void 0===this.schedulingLog&&this.schedulingCount%500==0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:e.sequenceNumber,lastSequenceNumber:e.sequenceNumber,startTime:n.S.now()})}batchEnd(e){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=e.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const e=n.S.now(),t=e-this.processingStartTime;t>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=t),setTimeout((()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:h.hy.formatTick(t),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:h.hy.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:h.hy.formatTick(n.S.now()-e)}),this.deltaManager.inbound.resume()})),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){const e=n.S.now();this.schedulingLog.totalProcessingTime+=e-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:h.hy.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:h.hy.formatTick(e-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=ge.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}ge.processingTime=50;class fe{constructor(e,t,s){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=n.S.now(),this.connectionStartTime=0,this.gap=0,this.logger=h.G2.create(s,"OpPerf"),this.deltaManager.on("pong",(e=>this.recordPingTime(e))),this.deltaManager.on("submitOp",(e=>this.beforeOpSubmit(e))),this.deltaManager.on("op",(e=>this.afterProcessingOp(e))),this.deltaManager.on("connect",((e,t)=>{this.clientId=e.clientId,void 0!==t&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=t,this.connectionStartTime=n.S.now(),this.gap<=0&&this.reportGettingUpToDate())})),this.deltaManager.on("disconnect",(()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0})),this.deltaManager.outbound.on("push",(e=>{for(const t of e)t.type===g.C.Operation&&this.clientSequenceNumberForLatencyStatistics===t.clientSequenceNumber&&((0,c.h)(void 0===this.opProcessingTimes.outboundPushEventTime,712),(0,c.h)(void 0===this.opPerfData.durationNetwork,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),(0,c.h)(void 0===this.opPerfData.durationOutboundBatching,714),(0,c.h)(void 0!==this.opProcessingTimes.submitOpEventTime,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)})),this.deltaManager.inbound.on("push",(e=>{this.clientId===e.clientId&&e.type===g.C.Operation&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber&&void 0!==this.opProcessingTimes.outboundPushEventTime&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)})),this.deltaManager.inbound.on("idle",((e,t)=>{"number"==typeof e&&e>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:e,duration:t})}))}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:n.S.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?h.hy.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100==0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){void 0===this.clientSequenceNumberForLatencyStatistics&&e.clientSequenceNumber%500==1&&((0,c.h)(void 0===this.opProcessingTimes.outboundPushEventTime,716),(0,c.h)(void 0===this.opPerfData.durationNetwork,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){const t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),void 0===this.sequenceNumberForMsnTracking&&t%1e3==0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),void 0!==this.sequenceNumberForMsnTracking&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&((0,c.h)(void 0!==this.msnTrackingTimestamp,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){(0,c.h)(void 0!==this.opProcessingTimes.submitOpEventTime,288);const s=Date.now();void 0!==this.opProcessingTimes.inboundPushEventTime&&(this.opPerfData.durationInboundToProcessing=s-this.opProcessingTimes.inboundPushEventTime);const r=s-this.opProcessingTimes.submitOpEventTime,i=r>5e3?"error":"performance";this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:r,category:i,pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}var ye=s(7593),ve=s(50442),be=s.n(ve);class Se{constructor(e,t,s){var r;this.stateHandler=e,this.pendingStates=new(be()),this.disposeOnce=new ye.o((()=>{this.initialStates.clear(),this.pendingStates.clear()})),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new(be())(null!==(r=null==s?void 0:s.pendingStates)&&void 0!==r?r:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return 0!==this._pendingMessagesCount||!this.initialStates.isEmpty()}getLocalState(){if((0,c.h)(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map((e=>"message"===e.type?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e))}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,s,r,i,n){const a={type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:s,content:r,localOpMetadata:i,opMetadata:n};this.pendingStates.push(a),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){if(this.stateHandler.flushMode()===S.FlushMode.Immediate)return;const e=this.pendingStates.peekBack();"message"===(null==e?void 0:e.type)&&this.pendingStates.push({type:"flush"})}async applyStashedOpsAt(e){for(;!this.initialStates.isEmpty();){const t=this.initialStates.peekFront();if("message"===t.type){if(void 0!==e){if(t.referenceSequenceNumber>e)break;if(t.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}const s=await this.stateHandler.applyStashedOp(t.messageType,t.content);t.localOpMetadata=s}this.pendingStates.push(this.initialStates.shift())}}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);const t=this.peekNextPendingState();if((0,c.h)("message"===t.type,361),this.pendingStates.shift(),t.clientSequenceNumber===e.clientSequenceNumber)return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata;{const s=v.Hi.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(s)}}maybeProcessBatchBegin(e){let t,s=!1,r=this.peekNextPendingState();for(;"message"!==r.type;)"flushMode"===r.type&&(t=r.flushMode),"flush"===r.type&&(s=!0),this.pendingStates.shift(),r=this.peekNextPendingState();void 0!==t&&(this.flushModeForNextMessage=t),t!==S.FlushMode.Immediate&&(t===S.FlushMode.TurnBased||s)&&((0,c.h)(!this.isProcessingBatch&&void 0===this.pendingBatchBeginMessage,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,s;if(!this.isProcessingBatch)return;const r=this.peekNextPendingState();if("message"===r.type)return;(0,c.h)("flushMode"!==r.type,701),(0,c.h)(void 0!==this.pendingBatchBeginMessage,365);const i=null===(t=this.pendingBatchBeginMessage.metadata)||void 0===t?void 0:t.batch;if(this.pendingBatchBeginMessage===e)(0,c.h)(void 0===i,366);else{const t=null===(s=e.metadata)||void 0===s?void 0:s.batch;(0,c.h)(!0===i,367),(0,c.h)(!1===t,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){const e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(e){const t=(0,V.Jn)(e,(e=>v.Hi.create(`RollbackError: ${e}`,"checkpointRollback",void 0)));throw this.stateHandler.close(t),t}}}}peekNextPendingState(){const e=this.pendingStates.peekFront();return(0,c.h)(!!e,369),e}rollbackNextPendingState(){if(0===this.pendingStates.length)return;this._pendingMessagesCount--;const e=this.pendingStates.pop();if("message"!==e.type)throw new Error(`Can't rollback state ${e.type}`);this.stateHandler.rollback(e.messageType,e.content,e.localOpMetadata)}replayPendingStates(){(0,c.h)(this.stateHandler.connected(),370),(0,c.h)(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),(0,c.h)(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(0===e)return;this._pendingMessagesCount=0;const t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){const t=this.pendingStates.shift();switch(t.type){case"message":this.stateHandler.reSubmit(t.messageType,t.content,t.localOpMetadata,t.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(t.flushMode);break;case"flush":this.stateHandler.flush()}e--}this.stateHandler.setFlushMode(t)}}const Ce="1.2.5";class we{constructor(e,t,s){this.path=e,this.routeContext=t,this.get=s,this.attached=!1,this.absolutePath=(0,z.H)(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}}class Te{constructor(e,t,s,r,i,n,a){this.routeContext=e,this.getStorage=s,this.attachBlobCallback=r,this.gcNodeUpdated=i,this.runtime=n,this.logger=a,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",(()=>{for(const e of this.pendingBlobIds.values())e.reject(new Error("runtime disposed while blobAttach op in flight"))})),this.load(t)}hasBlob(e){return this.blobIds.has(e)||this.detachedBlobIds.has(e)}getBlobGCNodePath(e){return`/${Te.basePath}/${e}`}async getBlob(e){var t,s;const r=null!==(s=null===(t=this.redirectTable)||void 0===t?void 0:t.get(e))&&void 0!==s?s:e;return(0,c.h)(this.hasBlob(r),287),this.gcNodeUpdated(this.getBlobGCNodePath(e)),new we(`${Te.basePath}/${r}`,this.routeContext,(async()=>h.Xr.timedExecAsync(this.logger,{eventName:"AttachmentReadBlob",id:r},(async()=>this.getStorage().readBlob(r)),{end:!0,cancel:"error"})))}async createBlob(e){var t,s;this.runtime.attachState===i.mB.Attaching&&(this.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),await new Promise((e=>this.runtime.once("attached",e)))),this.runtime.connected||this.runtime.attachState!==i.mB.Attached||await new Promise((e=>this.runtime.once("connected",e)));const r=await h.Xr.timedExecAsync(this.logger,{eventName:"createBlob"},(async()=>this.getStorage().createBlob(e)),{end:!0,cancel:"error"}),n=new we(`${Te.basePath}/${r.id}`,this.routeContext,(async()=>this.getBlob(r.id).then((async e=>e.get()))));return this.runtime.attachState===i.mB.Detached?(this.detachedBlobIds.add(r.id),n):(this.pendingBlobIds.has(r.id)?await(null===(t=this.pendingBlobIds.get(r.id))||void 0===t?void 0:t.promise):this.blobIds.has(r.id)||(this.pendingBlobIds.set(r.id,new C.B),this.attachBlobCallback(r.id),await(null===(s=this.pendingBlobIds.get(r.id))||void 0===s?void 0:s.promise)),n)}processBlobAttachOp(e,t){if(t){const t=this.pendingBlobIds.get(e);(0,c.h)(void 0!==t,504),t.resolve(),this.pendingBlobIds.delete(e)}this.blobIds.add(e)}static async load(e,t){if(!e)return{};let s;const r=e.blobs[this.redirectTableBlobName];return r&&(s=await t(r)),{ids:Object.entries(e.blobs).filter((([e,t])=>e!==this.redirectTableBlobName)).map((([e,t])=>t)),redirectTable:s}}load(e){var t,s,r;if(e.ids){const t=this.runtime.attachState===i.mB.Detached;e.ids.map((e=>t?this.detachedBlobIds.add(e):this.blobIds.add(e)))}e.redirectTable&&(this.redirectTable=new Map(e.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:null!==(s=null===(t=e.ids)||void 0===t?void 0:t.length)&&void 0!==s?s:0,redirectTable:null===(r=e.redirectTable)||void 0===r?void 0:r.length})}getGCData(e=!1){const t={gcNodes:{}};if(this.blobIds.forEach((e=>{t.gcNodes[this.getBlobGCNodePath(e)]=[]})),void 0!==this.redirectTable)for(const[e,s]of this.redirectTable)t.gcNodes[this.getBlobGCNodePath(e)]=[this.getBlobGCNodePath(s)];return t}deleteUnusedRoutes(e){var t;for(const s of e){const e=s.split("/");(0,c.h)(3===e.length&&e[1]===Te.basePath,725);const r=e[2];(null===(t=this.redirectTable)||void 0===t?void 0:t.has(r))?this.redirectTable.delete(r):this.blobIds.delete(r)}}summarize(e){const t=this.redirectTable||this.runtime.attachState!==i.mB.Detached?this.blobIds:this.detachedBlobIds,s=new T.x1;return t.forEach((e=>{s.addAttachment(e)})),this.redirectTable&&this.redirectTable.size>0&&s.addBlob(Te.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),s.getSummaryTree()}setRedirectTable(e){(0,c.h)(this.runtime.attachState===i.mB.Detached,594),(0,c.h)(!this.redirectTable,595);for(const[t,s]of e)(0,c.h)(this.detachedBlobIds.delete(t),596),this.blobIds.add(s);(0,c.h)(0===this.detachedBlobIds.size,597),this.redirectTable=e}}Te.basePath="_blobs",Te.redirectTableBlobName=".redirectTable";var Ne=s(34628);class Pe extends class{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return null!==(e=this._policies)&&void 0!==e?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.internalStorageService.getSnapshotTree(e,t)}async getVersions(e,t,s){return this.internalStorageService.getVersions(e,t,s)}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.internalStorageService.downloadSummary(e)}async createBlob(e){return this.internalStorageService.createBlob(e)}async readBlob(e){return this.internalStorageService.readBlob(e)}}{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}async readBlob(e){const t=this.blobs.get(e);return void 0!==t?t:this.internalStorageService.readBlob(e)}}class Ee{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new ye.o((()=>{for(const[e,t]of this.deferredContexts)t.promise.then((e=>{e.dispose()})).catch((t=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:e},t)}))})),this.dispose=()=>this.disposeOnce.value,this._logger=h.G2.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(void 0!==this._contexts.get(e)&&this.notBoundContexts.has(e))return this._contexts.get(e)}addUnbound(e){const t=e.id;(0,c.h)(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}async getBoundOrRemoted(e,t){const s=this.ensureDeferred(e);if(t||s.isCompleted)return s.promise}ensureDeferred(e){const t=this.deferredContexts.get(e);if(t)return t;const s=new C.B;return this.deferredContexts.set(e,s),s}bind(e){const t=this.notBoundContexts.delete(e);(0,c.h)(t,345),this.resolveDeferred(e)}resolveDeferred(e){const t=this._contexts.get(e);(0,c.h)(!!t,346),(0,c.h)(!this.notBoundContexts.has(e),347);const s=this.deferredContexts.get(e);(0,c.h)(!!s,348),s.resolve(t)}addBoundOrRemoted(e){const t=e.id;(0,c.h)(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}var De=s(72378),Oe=s(65760);function ke(e,t){const s=new Set,r=[...t];for(const t of r){if(s.has(t))continue;s.add(t);const i=e[t];void 0!==i&&r.push(...i)}const i=[],n=[];for(const t of Object.keys(e))s.has(t)?i.push(t):n.push(t);return{referencedNodeIds:i,deletedNodeIds:n}}var _e=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};const Ae="DataStore",Ie="SubDataStore",Me="Blob",Re="Active",Fe="Inactive",xe="SweepReady";class Le{constructor(e,t,s,r){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=s,this._state=Re,void 0!==r&&this.updateTracking(r)}get state(){return this._state}updateTracking(e){const t=e-this.unreferencedTimestampMs;if(void 0!==this.sweepTimeoutMs&&t>=this.sweepTimeoutMs)return this._state=xe,void this.clearTimers();if(t>=this.inactiveTimeoutMs)return this._state=Fe,this.clearTimers(),void(void 0!==this.sweepTimeoutMs&&qe(this.sweepTimeoutMs-t,(()=>{this._state=xe}),(e=>{this.sweepTimer=e})));const s=this.inactiveTimeoutMs-t;if(void 0===this.inactiveTimer){const e=()=>{this._state=Fe,void 0!==this.sweepTimeoutMs&&qe(this.sweepTimeoutMs-this.inactiveTimeoutMs,(()=>{this._state=xe}),(e=>{this.sweepTimer=e}))};this.inactiveTimer=new K(s,(()=>e()))}this.inactiveTimer.restart(s)}clearTimers(){var e;null===(e=this.inactiveTimer)||void 0===e||e.clear(),void 0!==this.sweepTimer&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state=Re}}class ze{constructor(e){var t,s,r,i,n,a,o;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=1,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;const u=e.baseSnapshot,l=e.metadata,m=e.readAndParseBlob;let p;if(this.mc=(0,d.rZ)(h.G2.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}})),e.existing)p=Je(l),this.gcEnabled=p>0,this.sweepEnabled=null!==(t=null==l?void 0:l.sweepEnabled)&&void 0!==t&&t,this.sessionExpiryTimeoutMs=null==l?void 0:l.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&!1===this.gcOptions.gcAllowed)throw new v.Oi("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=!1!==this.gcOptions.gcAllowed,this.sweepEnabled=!0===this.gcOptions.sweepAllowed,this.mc.config.getBoolean("Fluid.GarbageCollection.RunSessionExpiry")&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=2592e6)}if(void 0!==this.sessionExpiryTimeoutMs&&!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSessionExpiry")){const t=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs"),s=null!=t?t:this.sessionExpiryTimeoutMs;qe(s,(()=>{this.runtime.closeFn(new v.Lf("Client session expired.",s))}),(e=>{this.sessionExpiryTimer=e})),void 0!==e.snapshotCacheExpiryMs&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+864e5)}if(this.latestSummaryGCVersion=null!=p?p:this.currentGCVersion,this.shouldRunGC=null!==(s=this.mc.config.getBoolean("Fluid.GarbageCollection.RunGC"))&&void 0!==s?s:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&void 0!==this.sweepTimeoutMs&&(null!==(r=this.mc.config.getBoolean("Fluid.GarbageCollection.RunSweep"))&&void 0!==r?r:this.sweepEnabled),this.trackGCState=!0===this.mc.config.getBoolean("Fluid.GarbageCollection.TrackGCState"),this.inactiveTimeoutMs=null!==(n=null!==(i=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))&&void 0!==i?i:this.gcOptions.inactiveTimeoutMs)&&void 0!==n?n:6048e5,void 0!==this.sweepTimeoutMs&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new v.Oi("inactive timeout should not be greated than the sweep timeout");if(this.testMode=null!==(a=this.mc.config.getBoolean("Fluid.GarbageCollection.GCTestMode"))&&void 0!==a?a:!0===this.gcOptions.runGCInTestMode,this._writeDataAtRoot=null===(o=this.mc.config.getBoolean("Fluid.GarbageCollection.WriteDataAtRoot"))||void 0===o||o,this._writeDataAtRoot){const e=void 0!==(null==u?void 0:u.trees.gc);this.initialStateNeedsReset=e!==this.shouldRunGC}const g=new C.d((async()=>{var e;if(void 0===u)return;const t=u.trees.gc;if(void 0!==t){this._writeDataAtRoot=!0;const e=await je(t,m);return this.trackGCState&&(this.latestSerializedSummaryState=JSON.stringify(Be(e))),e}const s={gcNodes:{"/":{outboundRoutes:[]}}},r=dt(u,l);(0,c.h)(void 0!==r,680);for(const[t,i]of Object.entries(r.trees)){const r=i.blobs[S.gcBlobKey];if(void 0===r)continue;const n=await m(r);if(void 0===(null===(e=n.gcData)||void 0===e?void 0:e.gcNodes))continue;const a=`/${t}`;(await m(i.blobs[Qe])).isRootDataStore&&s.gcNodes["/"].outboundRoutes.push(a);for(const[e,t]of Object.entries(n.gcData.gcNodes)){const r="/"===e?a:`${a}${e}`;s.gcNodes[r]={outboundRoutes:Array.from(t)}}(0,c.h)(void 0!==s.gcNodes[a],681),s.gcNodes[a].unreferencedTimestampMs=n.unrefTimestamp}return 1===Object.keys(s.gcNodes).length?void 0:s}));this.initializeBaseStateP=new C.d((async()=>{const e=this.runtime.getCurrentReferenceTimestampMs(),t=await g;if(void 0===t)return;const s={};for(const[r,i]of Object.entries(t.gcNodes))void 0!==i.unreferencedTimestampMs&&this.unreferencedNodesState.set(r,new Le(i.unreferencedTimestampMs,this.inactiveTimeoutMs,this.sweepTimeoutMs,e)),s[r]=Array.from(i.outboundRoutes);this.previousGCDataFromLastRun={gcNodes:s}})),this.baseGCDetailsP=new C.d((async()=>{const e=await g;if(void 0===e)return new Map;const t={};for(const[s,r]of Object.entries(e.gcNodes))t[s]=Array.from(r.outboundRoutes);const s=function(e){const t=new Map;if(void 0===e.gcData)return t;const s=e.gcData.gcNodes;delete s["/"];for(const[e,r]of Object.entries(s)){(0,c.h)(e.startsWith("/"),686);const s=e.split("/")[1];let i=e.slice(s.length+1);""===i&&(i="/");let n=t.get(s);void 0===n&&(n={gcData:{gcNodes:{}},usedRoutes:[]}),(0,c.h)(void 0!==n.gcData,687),n.gcData.gcNodes[i]=[...new Set(r)],t.set(s,n)}if(void 0===e.usedRoutes)return t;const r=e.usedRoutes.filter((e=>""!==e&&"/"!==e));for(const e of r){(0,c.h)(e.startsWith("/"),688);const s=e.split("/")[1],r=e.slice(s.length+1),i=t.get(s);(0,c.h)(void 0!==(null==i?void 0:i.usedRoutes),689),i.usedRoutes.push(r),t.set(s,i)}return t}({gcData:{gcNodes:t},usedRoutes:ke(t,["/"]).referencedNodeIds});for(const[t,r]of Object.entries(e.gcNodes))if(void 0!==r.unreferencedTimestampMs){const e=s.get(t.slice(1));void 0!==e&&(e.unrefTimestamp=r.unreferencedTimestampMs)}return s}));const f=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:f}),this.shouldRunGC&&this.initializeBaseStateP.catch((e=>{const t=v.Hi.wrapIfUnrecognized(e,"FailedToInitializeGC");throw t.addTelemetryProperties({gcConfigs:f}),t}))}static create(e){return new ze(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}async collectGarbage(e){const{fullGC:t=!0===this.gcOptions.runFullGC||this.summaryStateNeedsReset}=e,s=e.logger?h.G2.create(e.logger,void 0,{all:{completedGCRuns:()=>this.completedRuns}}):this.mc.logger;return h.Xr.timedExecAsync(s,{eventName:"GarbageCollection"},(async e=>{await this.runPreGCSteps();const r=await this.runtime.getGCData(t),i=ke(r.gcNodes,["/"]),n=await this.runPostGCSteps(r,i,s);return e.end(Object.assign({},n)),this.completedRuns++,n}),{end:!0,cancel:"error"})}async runPreGCSteps(){await this.initializeBaseStateP,await this.runtime.updateStateBeforeGC()}async runPostGCSteps(e,t,s){const r=this.generateStats(t);this.updateStateSinceLastRun(e,s);const i=this.runtime.getCurrentReferenceTimestampMs();return this.updateCurrentState(e,t,i),this.runtime.updateUsedRoutes(t.referencedNodeIds,i),this.logSweepEvents(s,i),this.testMode&&this.runtime.deleteUnusedRoutes(t.deletedNodeIds),await this.logUnreferencedEvents(s),r}summarize(e,t,s){var r;if(!this.shouldRunGC||void 0===this.previousGCDataFromLastRun)return;const i={gcNodes:{}};for(const[e,t]of Object.entries(this.previousGCDataFromLastRun.gcNodes))i.gcNodes[e]={outboundRoutes:t,unreferencedTimestampMs:null===(r=this.unreferencedNodesState.get(e))||void 0===r?void 0:r.unreferencedTimestampMs};const n=JSON.stringify(Be(i));if(this.trackGCState&&(this.pendingSerializedSummaryState=n,void 0!==this.latestSerializedSummaryState&&this.latestSerializedSummaryState===n&&!e&&t)){const e=(0,T.Jz)();return e.handleNodeCount++,{summary:{type:b.J.Handle,handle:"/gc",handleType:b.J.Tree},stats:e}}const a=new T.x1;return a.addBlob("__gc_root",n),a.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}async getBaseGCDetails(){return this.baseGCDetailsP}async latestSummaryStateRefreshed(e,t){if(!this.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked)return this.latestSummaryGCVersion=this.currentGCVersion,this.initialStateNeedsReset=!1,void(this.trackGCState&&(this.latestSerializedSummaryState=this.pendingSerializedSummaryState,this.pendingSerializedSummaryState=void 0));const s=e.snapshot,r=s.blobs[He];if(r){const e=await t(r);this.latestSummaryGCVersion=Je(e)}const i=s.trees.gc;if(void 0!==i&&this.trackGCState){const e=await je(i,t);this.latestSerializedSummaryState=JSON.stringify(Be(e))}else this.latestSerializedSummaryState=void 0;this.pendingSerializedSummaryState=void 0}nodeUpdated(e,t,s,r,i){if(!this.shouldRunGC)return;const n=this.unreferencedNodesState.get(e);n&&n.state!==Re&&this.inactiveNodeUsed(t,e,n,void 0,r,s,i)}addedOutboundReference(e,t){var s;if(!this.shouldRunGC)return;const r=null!==(s=this.newReferencesSinceLastRun.get(e))&&void 0!==s?s:[];r.push(t),this.newReferencesSinceLastRun.set(e,r);const i=this.unreferencedNodesState.get(t);i&&i.state!==Re&&this.inactiveNodeUsed("Revived",t,i,e)}dispose(){void 0!==this.sessionExpiryTimer&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,s){this.previousGCDataFromLastRun=R(e),this.newReferencesSinceLastRun.clear();for(const e of t.referencedNodeIds){const t=this.unreferencedNodesState.get(e);void 0!==t&&(t.stopTracking(),this.unreferencedNodesState.delete(e))}if(void 0!==s)for(const e of t.deletedNodeIds){const t=this.unreferencedNodesState.get(e);void 0===t?this.unreferencedNodesState.set(e,new Le(s,this.inactiveTimeoutMs,this.sweepTimeoutMs,s)):t.updateTracking(s)}}updateStateSinceLastRun(e,t){if(void 0===this.previousGCDataFromLastRun)return;const s=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&s.length>0&&s.forEach((e=>{const s={eventName:"gcUnknownOutboundReferences",gcNodeId:e[0],gcRoutes:JSON.stringify(e[1])};t.sendPerformanceEvent(s)})),0===this.newReferencesSinceLastRun.size)return;const r=function(e,t){const s=R(e);for(const[e,r]of Object.entries(t.gcNodes))if(void 0===s.gcNodes[e])s.gcNodes[e]=Array.from(r);else{const t=[...r,...s.gcNodes[e]];s.gcNodes[e]=[...new Set(t)]}return s}(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach(((e,t)=>{void 0===r.gcNodes[t]?r.gcNodes[t]=e:r.gcNodes[t].push(...e)}));const i=ke(r.gcNodes,["/"]);for(const e of i.referencedNodeIds){const t=this.unreferencedNodesState.get(e);void 0!==t&&(t.stopTracking(),this.unreferencedNodesState.delete(e))}}findMissingExplicitReferences(e,t,s){(0,c.h)(void 0!==t,695);const r=Object.entries(e.gcNodes),i=[];return r.forEach((([e,r])=>{var n,a;const o=null!==(n=t.gcNodes[e])&&void 0!==n?n:[],c=null!==(a=s.get(e))&&void 0!==a?a:[],u=[];r.forEach((t=>{const s=this.runtime.getNodeType(t)===Me||this.runtime.getNodeType(t)===Ae,r=!e.startsWith(t);s&&r&&!o.includes(t)&&!c.includes(t)&&u.push(t)})),u.length>0&&i.push([e,u])})),i}generateStats(e){const t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},s=(e,s)=>{t.nodeCount++;const r=void 0===this.previousGCDataFromLastRun||this.unreferencedNodesState.has(e)===s;r&&t.updatedNodeCount++,s||t.unrefNodeCount++,this.runtime.getNodeType(e)===Ae&&(t.dataStoreCount++,r&&t.updatedDataStoreCount++,s||t.unrefDataStoreCount++),this.runtime.getNodeType(e)===Me&&(t.attachmentBlobCount++,r&&t.updatedAttachmentBlobCount++,s||t.unrefAttachmentBlobCount++)};for(const t of e.referencedNodeIds)s(t,!0);for(const t of e.deletedNodeIds)s(t,!1);return t}logSweepEvents(e,t){!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSweepLog")&&void 0!==t&&void 0!==this.sweepTimeoutMs&&this.unreferencedNodesState.forEach(((s,r)=>{if(s.state!==xe)return;const i=this.runtime.getNodeType(r);if(i!==Ae&&i!==Me)return;const n=`Deleted-${r}`;this.loggedUnreferencedEvents.has(n)||(this.loggedUnreferencedEvents.add(n),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:r,type:i,age:t-s.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))}))}inactiveNodeUsed(e,t,s,r,i,n=this.runtime.getCurrentReferenceTimestampMs(),a){if(void 0===n||s.state===Re)return;if(!this.isSummarizerClient&&"Loaded"!==e)return;const o=this.runtime.getNodeType(t);if(o!==Ae&&o!==Me)return;const c=s.state,u=`${c}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(u))return;this.loggedUnreferencedEvents.add(u);const l={id:t,type:o,unrefTime:s.unreferencedTimestampMs,age:n-s.unreferencedTimestampMs,timeout:s.state===Fe?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:null==a?void 0:a[Et.externalRequest],viaHandle:null==a?void 0:a[Et.viaHandle],fromId:r};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},l),{usageType:e,state:c})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},l),{eventName:`${c}Object_${e}`,pkg:i?{value:i.join("/"),tag:h.XI.CodeArtifact}:void 0}))}async logUnreferencedEvents(e){for(const t of this.pendingEventsQueue){const{usageType:s,state:r}=t,i=_e(t,["usageType","state"]),n=this.unreferencedNodesState.get(t.id);if("Revived"===s==(void 0===n||n.state===Re)){const n=await this.getNodePackagePath(t.id),a=t.fromId?await this.getNodePackagePath(t.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},i),{eventName:`${r}Object_${s}`,pkg:n?{value:n.join("/"),tag:h.XI.CodeArtifact}:void 0,fromPkg:a?{value:a.join("/"),tag:h.XI.CodeArtifact}:void 0}))}}this.pendingEventsQueue=[]}}async function je(e,t){let s={gcNodes:{}};for(const r of Object.keys(e.blobs)){if(!r.startsWith("__gc"))continue;const i=e.blobs[r];if(void 0===i)continue;const n=await t(i);(0,c.h)(void 0!==n,685),s=F(s,n)}return s}function Be(e){const t=Object.entries(e.gcNodes);t.sort((([e],[t])=>e.localeCompare(t)));const s={gcNodes:{}};for(const[e,r]of t)r.outboundRoutes.sort(),s.gcNodes[e]=r;return s}function qe(e,t,s){const r=2147483647;let i;if(e>r){const n=e-r;i=setTimeout((()=>qe(n,t,s)),r)}else i=setTimeout((()=>t()),e);s(i)}function Ge(e){return e.summaryFormatVersion?e.summaryFormatVersion:"0.1"===e.snapshotFormatVersion?1:0}function Ue(e){return!!e.summaryFormatVersion&&!e.disableIsolatedChannels}const Ve=".aliases",He=".metadata",Xe=".chunks",$e=".electedSummarizer",We=".blobs";function Je(e){var t;return e&&null!==(t=e.gcFeature)&&void 0!==t?t:0}const Ke=[".protocol",".logTail",".serviceProtocol",We,"gc"],Qe=".component";function Ze(e){e.summary={type:b.J.Tree,tree:{[S.channelsTreeName]:e.summary}},e.stats.treeNodeCount++}function Ye(e,t,s){const r=JSON.stringify(e);return s?{pkg:r,snapshotFormatVersion:"0.1",isRootDataStore:t}:{pkg:r,summaryFormatVersion:2,isRootDataStore:t}}function et(e,t,s){const r=Ye(e,t,s);return new De.Qp(Qe,JSON.stringify(r))}class tt extends u.L{constructor(e,t,s,r,n){super(),this.existing=t,this.bindState=s,this.isLocalDataStore=r,this.makeLocallyVisibleFn=n,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=e.runtime,this.id=e.id,this.storage=e.storage,this.scope=e.scope,this.writeGCDataAtRoot=e.writeGCDataAtRoot,this.disableIsolatedChannels=e.disableIsolatedChannels,this.pkg=e.pkg,(0,c.h)(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==i.mB.Detached&&this.existing?this.containerRuntime.attachState:i.mB.Detached,this.bindToContext=()=>{(0,c.h)(this.bindState===i.xU.NotBound,315),this.bindState=i.xU.Binding,(0,c.h)(void 0!==this.channel,316),this.makeLocallyVisible(),this.bindState=i.xU.Bound},this.summarizerNode=e.createSummarizerNodeFn((async(e,t,s)=>this.summarizeInternal(e,t,s)),(async e=>this.getGCDataInternal(e)),(async()=>this.getBaseGCDetails())),this.subLogger=h.G2.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new Oe.z(tt.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return(0,c.h)(void 0!==this.pkg,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}async isRoot(){return this.isInMemoryRoot()||(await this.getInitialSnapshotDetails()).isRootDataStore}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then((e=>{e.dispose()})).catch((e=>{})))}rejectDeferredRealize(e,t){throw new V.j4(e,{packageName:{value:t,tag:h.XI.PackageData}})}async realize(){return(0,c.h)(!this.detachedRuntimeCreation,317),this.channelDeferred||(this.channelDeferred=new C.B,this.realizeCore(this.existing).catch((e=>{var t;const s=v.Hi.wrapIfUnrecognized(e,"realizeFluidDataStoreContext");s.addTelemetryProperties({fluidDataStoreId:{value:this.id,tag:"PackageData"}}),null===(t=this.channelDeferred)||void 0===t||t.reject(s),this.logger.sendErrorEvent({eventName:"RealizeError"},s)}))),this.channelDeferred.promise}async factoryFromPackagePath(e){let t;(0,c.h)(this.pkg===e,318),void 0===e&&this.rejectDeferredRealize("packages is undefined");let s,r=this._containerRuntime.IFluidDataStoreRegistry;for(const i of e)r||this.rejectDeferredRealize("No registry for package",s),s=i,t=await r.get(i),t||this.rejectDeferredRealize("Registry does not contain entry for the package",i),r=t.IFluidDataStoreRegistry;const i=null==t?void 0:t.IFluidDataStoreFactory;return void 0===i&&this.rejectDeferredRealize("Can't find factory for package",s),{factory:i,registry:r}}async realizeCore(e){const t=await this.getInitialSnapshotDetails();this._baseSnapshot=t.snapshot;const s=t.pkg,{factory:r,registry:i}=await this.factoryFromPackagePath(s);(0,c.h)(void 0===this.registry,319),this.registry=i;const n=await r.instantiateDataStore(this,e);(0,c.h)(void 0!==n,320),this.bindRuntime(n)}setConnectionState(e,t){this.verifyNotClosed(),this.loaded&&((0,c.h)(this.connected===e,321),this.channel.setConnectionState(e,t))}process(e,t,s){var r;this.verifyNotClosed();const i=e.contents,n=Object.assign(Object.assign({},e),{type:i.type,contents:i.content});if(this.summarizerNode.recordChange(n),this.loaded)return null===(r=this.channel)||void 0===r?void 0:r.process(n,t,s);(0,c.h)(!t,322),(0,c.h)(void 0!==this.pending,573),this.pending.push(n),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(e,t){var s;this.verifyNotClosed(),this.loaded&&(null===(s=this.channel)||void 0===s||s.processSignal(e,t))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}async summarize(e=!1,t=!0,s){return this.summarizerNode.summarize(e,t,s)}async summarizeInternal(e,t,s){await this.realize();const r=await this.channel.summarize(e,t,s);let i;this.disableIsolatedChannels||(Ze(r),i=[S.channelsTreeName]);const{pkg:n}=await this.getInitialSnapshotDetails(),a=Ye(n,await this.isRoot(),this.disableIsolatedChannels);return(0,T.Rt)(r,Qe,JSON.stringify(a)),this.writeGCDataAtRoot||(0,T.Rt)(r,S.gcBlobKey,JSON.stringify(this.summarizerNode.getGCSummaryDetails())),this.summarizerNode.isReferenced()||(r.summary.unreferenced=!0,r.stats.unreferencedBlobSize=r.stats.totalBlobSize),Object.assign(Object.assign({},r),{id:this.id,pathPartsForChildren:i})}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return await this.realize(),(0,c.h)(void 0!==this.channel,323),this.channel.getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes(e,t),this.lastUsedState={usedRoutes:e,gcTimestamp:t},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(e,t){this._containerRuntime.addedGCOutboundReference(e,t)}updateChannelUsedRoutes(){if((0,c.h)(this.loaded,324),(0,c.h)(void 0!==this.channel,325),void 0===this.lastUsedState)return;const e=this.lastUsedState.usedRoutes.filter((e=>"/"!==e&&""!==e));this.channel.updateUsedRoutes(e,this.lastUsedState.gcTimestamp)}async request(e){return(await this.realize()).request(e)}submitMessage(e,t,s){this.verifyNotClosed(),(0,c.h)(!!this.channel,326);const r={content:t,type:e};this._containerRuntime.submitDataStoreOp(this.id,r,s)}setChannelDirty(e){this.verifyNotClosed();const t=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(t);const s=this.summarizerNode.getChild(e);s&&s.invalidate(t)}submitSignal(e,t){return this.verifyNotClosed(),(0,c.h)(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,e,t)}makeLocallyVisible(){(0,c.h)(void 0!==this.channel,719),this.makeLocallyVisibleFn()}bindRuntime(e){var t;if(this.channel)throw new Error("Runtime already bound");try{(0,c.h)(!this.detachedRuntimeCreation,328),(0,c.h)(void 0!==this.channelDeferred,329),(0,c.h)(void 0!==this.pkg,330);const t=this.pending;for(const s of t)e.process(s,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",t.length),this.pending=void 0,this.loaded=!0,this.channel=e,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(e){null===(t=this.channelDeferred)||void 0===t||t.reject(e),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},e)}}async getAbsoluteUrl(e){if(this.attachState===i.mB.Attached)return this._containerRuntime.getAbsoluteUrl(e)}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(e,t){(0,c.h)(!!this.channel,331);const s=e;this.channel.reSubmit(s.type,s.content,t)}rollback(e,t){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");const s=e;this.channel.rollback(s.type,s.content,t)}async applyStashedOp(e){this.channel||await this.realize(),(0,c.h)(!!this.channel,332);const t=e;return this.channel.applyStashedOp(t.content)}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(e,t){return(s,r,i)=>this.summarizerNode.createChild(s,e,t,{throwOnFailure:!0},r,i)}async uploadBlob(e){return this.containerRuntime.uploadBlob(e)}}tt.pendingOpsCountThreshold=1e3;class st extends tt{constructor(e){super(e,!0,i.xU.Bound,!1,(()=>{throw new Error("Already attached")})),this.initialSnapshotDetailsP=new C.d((async()=>{var e,t;let s,r=!0;if("string"==typeof this.initSnapshotValue){const t=(await this.storage.getVersions(this.initSnapshotValue,1))[0];s=null!==(e=await this.storage.getSnapshotTree(t))&&void 0!==e?e:void 0}else s=this.initSnapshotValue;const i=async e=>(0,y.g)(this.storage,e);if(s){const e=await this.summarizerNode.loadBaseSummary(s,i);s=e.baseSummary,this.pending=e.outstandingOps.concat(this.pending)}if(s&&void 0!==s.blobs[Qe]){const e=await i(s.blobs[Qe]);let n;n=Ge(e)<1?e.pkg.startsWith('["')&&e.pkg.endsWith('"]')?JSON.parse(e.pkg):[e.pkg]:JSON.parse(e.pkg),this.pkg=n,r=null===(t=e.isRootDataStore)||void 0===t||t,Ue(e)&&(s=s.trees[S.channelsTreeName],(0,c.h)(void 0!==s,510))}return{pkg:this.pkg,isRootDataStore:r,snapshot:s}})),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new C.d((async()=>{var t;return null!==(t=await e.getBaseGCDetails())&&void 0!==t?t:{}}))}async getInitialSnapshotDetails(){return this.initialSnapshotDetailsP}async getInitialGCSummaryDetails(){return this.getBaseGCDetails()}async getBaseGCDetails(){return this.baseGCDetailsP}generateAttachMessage(){throw new Error("Cannot attach remote store")}}class rt extends tt{constructor(e){super(e,void 0!==e.snapshotTree,e.snapshotTree?i.xU.Bound:i.xU.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,!0===e.isRootDataStore&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",(()=>{(0,c.h)(this.attachState===i.mB.Detached,333),this._attachState=i.mB.Attaching})),this.once("attached",(()=>{(0,c.h)(this.attachState===i.mB.Attaching,334),this._attachState=i.mB.Attached}))}generateAttachMessage(){(0,c.h)(void 0!==this.channel,335),(0,c.h)(void 0!==this.pkg,336);const e=this.channel.getAttachSummary();this.disableIsolatedChannels||Ze(e);const t=Ye(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);(0,T.Rt)(e,Qe,JSON.stringify(t));const s=(0,T.H4)(e.summary);return{id:this.id,snapshot:s,type:this.pkg[this.pkg.length-1]}}async getInitialSnapshotDetails(){var e;let t,s=this.snapshotTree,r=!1;return void 0!==s&&(t=await async function(e,t){const s=await(0,y.g)(e,t.blobs[Qe]),r=Ge(s);return(0,c.h)(r>0,469),s}(this.storage,s),Ue(t)&&(s=s.trees[S.channelsTreeName],(0,c.h)(void 0!==s,511)),void 0===this.pkg&&(this.pkg=JSON.parse(t.pkg),(null===(e=t.isRootDataStore)||void 0===e||e)&&(r=!0,this.setInMemoryRoot()))),(0,c.h)(void 0!==this.pkg,338),{pkg:this.pkg,isRootDataStore:r,snapshot:s}}async getInitialGCSummaryDetails(){return{}}async getBaseGCDetails(){return{}}}class it extends rt{constructor(e){super(e)}}class nt extends rt{constructor(e){super(e),this.detachedRuntimeCreation=!0}async attachRuntime(e,t){(0,c.h)(this.detachedRuntimeCreation,340),(0,c.h)(void 0===this.channelDeferred,341);const s=e.IFluidDataStoreFactory,r=await this.factoryFromPackagePath(this.pkg);(0,c.h)(r.factory===s,342),(0,c.h)(void 0===this.registry,343),this.registry=r.registry,this.detachedRuntimeCreation=!1,this.channelDeferred=new C.B,super.bindRuntime(t),await this.isRoot()&&(void 0!==t.makeVisibleAndAttachGraph?t.makeVisibleAndAttachGraph():t.bindToContext())}async getInitialSnapshotDetails(){if(this.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return super.getInitialSnapshotDetails()}}const at=e=>"string"==typeof(null==e?void 0:e.internalId)&&"string"==typeof(null==e?void 0:e.alias),ot=(e,t,s,r,i)=>new lt(e,t,s,r,i);var ct,ut;!function(e){e.Aliased="Aliased",e.Aliasing="Aliasing",e.None="None"}(ct||(ct={}));class lt{constructor(e,t,s,r,i){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=s,this.datastores=r,this.logger=i,this.aliasState=ct.None}async trySetAlias(e){if(e.includes("/"))throw new v.Oi(`The alias cannot contain slashes: '${e}'`);switch(this.aliasState){case ct.Aliasing:return(0,c.h)(void 0!==this.aliasResult,790),await this.aliasResult,this.alias===e?"Success":"AlreadyAliased";case ct.Aliased:return this.alias===e?"Success":"AlreadyAliased";case ct.None:break;default:(0,l.U)(this.aliasState)}return this.aliasState=ct.Aliasing,this.aliasResult=this.trySetAliasInternal(e),this.aliasResult}async trySetAliasInternal(e){const t={internalId:this.internalId,alias:e};if(void 0!==this.fluidDataStoreChannel.makeVisibleAndAttachGraph?this.fluidDataStoreChannel.makeVisibleAndAttachGraph():this.fluidDataStoreChannel.bindToContext(),this.runtime.attachState===i.mB.Detached){const e=this.datastores.processAliasMessageCore(t);return this.aliasState=ct.Aliased,e?"Success":"Conflict"}return await this.ackBasedPromise((e=>{this.runtime.submitDataStoreAliasOp(t,e)})).then((t=>(this.aliasState=ct.Aliased,t&&(this.alias=e),t))).catch((t=>(this.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:h.XI.UserData},internalId:{value:this.internalId,tag:h.XI.PackageData}},t),this.aliasState=ct.None,!1)))?"Success":"Conflict"}async request(e){return this.fluidDataStoreChannel.request(e)}get IFluidRouter(){return this.fluidDataStoreChannel}async ackBasedPromise(e){let t;return new Promise(((s,r)=>{t=()=>r(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed?t():(this.runtime.on("dispose",t),e(s,r))})).finally((()=>{this.runtime.off("dispose",t)}))}}class ht{constructor(e,t,s,r,n,a,o,c,u,l,d=new Ee(a)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=s,this.getCreateChildSummarizerNodeFn=r,this.deleteChildSummarizerNodeFn=n,this.gcNodeUpdated=c,this.aliasMap=u,this.writeGCDataAtRoot=l,this.contexts=d,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new ye.o((()=>this.contexts.dispose())),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=h.G2.create(a),this.containerRuntimeHandle=new W.B(this.runtime,"/",this.runtime.IFluidHandleContext);const m=new C.d((async()=>o())),p=async e=>(await m).get(e),g=new Map;if(e)for(const[t,s]of Object.entries(e.trees))g.set(t,s);let f=0;for(const[e,t]of g){let s;if(t.unreferenced&&f++,this.runtime.attachState!==i.mB.Detached)s=new st({id:e,snapshotTree:t,getBaseGCDetails:async()=>p(e),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(e,{type:S.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if("object"!=typeof t)throw new V.j4("Snapshot should be there to load from!!");const r=t;s=new it({id:e,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(e,{type:S.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(e),snapshotTree:r,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(s)}this.containerLoadStats={containerLoadDataStoreCount:g.size,referencedDataStoreCount:g.size-f}}aliases(){return this.aliasMap}processAttachMessage(e,t){var s,r;const i=e.contents;if(this.dataStoresSinceLastGC.push(i.id),t)return(0,c.h)(this.pendingAttach.has(i.id),350),null===(s=this.contexts.get(i.id))||void 0===s||s.emit("attached"),void this.pendingAttach.delete(i.id);if(this.alreadyProcessed(i.id))throw new v.Jd("Duplicate DataStore created with existing id",Object.assign(Object.assign({},(0,v.HN)(e)),{dataStoreId:{value:i.id,tag:h.XI.PackageData}}));const n=new Map;let a;i.snapshot&&(a=(0,Ne.m)(i.snapshot.entries,n));const o=[i.type],u=new st({id:i.id,snapshotTree:a,getBaseGCDetails:async()=>({}),runtime:this.runtime,storage:new Pe(this.runtime.storage,n),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(i.id,{type:S.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:null!==(r=i.snapshot)&&void 0!==r?r:{entries:[et(o,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:o});this.contexts.addBoundOrRemoted(u)}processAliasMessage(e,t,s){const r=e.contents;if(!at(r))throw new v.Jd("malformedDataStoreAliasMessage",Object.assign({},(0,v.HN)(e)));const i=t,n=this.processAliasMessageCore(r);s&&i(n)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;const t=this.contexts.get(e.internalId);if(void 0===t)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;const s=new W.B(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,s),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return void 0!==this.aliasMap.get(e)||void 0!==this.contexts.get(e)}makeDataStoreLocallyVisible(e){const t=this.contexts.getUnbound(e);if((0,c.h)(!!t,351),this.runtime.attachState!==i.mB.Detached){t.emit("attaching");const s=t.generateAttachMessage();this.pendingAttach.set(e,s),this.submitAttachFn(s),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,s=(0,L.Z)()){(0,c.h)(!s.includes("/"),780);const r=new nt({id:s,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(s,{type:S.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(s),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(r),r}_createFluidDataStoreContext(e,t,s,r){(0,c.h)(!t.includes("/"),781);const i=new it({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:S.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:s,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:r});return this.contexts.addUnbound(i),i}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){const s=e,r=this.contexts.get(s.address);(0,c.h)(!!r,352),r.reSubmit(s.contents,t)}rollbackDataStoreOp(e,t){const s=e,r=this.contexts.get(s.address);(0,c.h)(!!r,744),r.rollback(s.contents,t)}async applyStashedOp(e){const t=e,s=this.contexts.get(t.address);return(0,c.h)(!!s,353),s.applyStashedOp(t.contents)}async applyStashedAttachOp(e){this.pendingAttach.set(e.id,e),this.processAttachMessage({contents:e},!1)}processFluidDataStoreOp(e,t,s){const r=e.contents,i=Object.assign(Object.assign({},e),{contents:r.contents}),n=this.contexts.get(r.address);(0,c.h)(!!n,354),n.process(i,t,s),this.gcNodeUpdated(`/${r.address}`,e.timestamp,n.isLoaded?n.packagePath:void 0)}async getDataStore(e,t){const s=await this.contexts.getBoundOrRemoted(e,t);if(void 0===s){const t={url:e};throw(0,M.fu)((0,M.I4)(t),t)}return s}processSignal(e,t,s){const r=this.contexts.get(e);if(!r)return(0,c.h)(!s,355),void this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:h.XI.PackageData}});r.processSignal(t,s)}setConnectionState(e,t){for(const[s,r]of this.contexts)try{r.setConnectionState(e,t)}catch(e){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:s},e)}}setAttachState(e){let t;t=e===i.mB.Attaching?"attaching":"attached";for(const[,e]of this.contexts)this.contexts.isNotBound(e.id)||e.emit(t)}get size(){return this.contexts.size}async summarize(e,t,s){const r=new T.x1;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>((0,c.h)(t.attachState!==i.mB.Attaching,357),t.attachState===i.mB.Attached))).map((async([i,n])=>{const a=await n.summarize(e,t,s);r.addWithStats(i,a)}))),r.getSummaryTree()}createSummary(e){const t=new T.x1;let s;do{const e=t.summary.tree;s=this.contexts.notBoundLength(),Array.from(this.contexts).filter((([t,s])=>!(this.contexts.isNotBound(t)||e[t]||this.attachOpFiredForDataStore.has(t)))).map((([e,s])=>{let r;if(s.isLoaded){const e=s.generateAttachMessage().snapshot;r=(0,T.j9)(e,!0)}else(0,c.h)(!!this.baseSnapshot,358),r=(0,T.S5)(this.baseSnapshot.trees[e]);t.addWithStats(e,r)}))}while(s!==this.contexts.notBoundLength());return t.getSummaryTree()}async updateStateBeforeGC(){for(const e of this.dataStoresSinceLastGC){const t=this.contexts.get(e);if((0,c.h)(void 0!==t,694),await t.isRoot()){const s=new W.B(t,e,this.runtime.IFluidHandleContext);this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,s)}}this.dataStoresSinceLastGC=[]}async getGCData(e=!1){const t=new x;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>t.attachState===i.mB.Attached)).map((async([s,r])=>{const i=await r.getGCData(e);t.prefixAndAddNodes(s,i.gcNodes)}))),t.addNode("/",await this.getOutboundRoutes()),t.getGCData()}updateUsedRoutes(e,t){var s;const r=function(e){const t=e.filter((e=>""!==e&&"/"!==e)),s=new Map;for(const e of t){(0,c.h)(e.startsWith("/"),408);const t=e.split("/")[1],r=e.slice(t.length+1),i=s.get(t);void 0!==i?i.push(r):s.set(t,[r])}return s}(e);for(const[e]of r)(0,c.h)(this.contexts.has(e),359);for(const[e,i]of this.contexts)i.updateUsedRoutes(null!==(s=r.get(e))&&void 0!==s?s:[],t)}deleteUnusedRoutes(e){for(const t of e){const e=t.split("/");if(e.length>2)continue;const s=e[1];(0,c.h)(this.contexts.has(s),727),this.contexts.delete(s),this.deleteChildSummarizerNodeFn(s)}}async getOutboundRoutes(){const e=[];for(const[t,s]of this.contexts)await s.isRoot()&&e.push(`/${t}`);return e}async getDataStorePackagePath(e){var t;const s=this.contexts.get(e.split("/")[1]);return null===(t=await(null==s?void 0:s.getInitialSnapshotDetails()))||void 0===t?void 0:t.pkg}getGCNodeType(e){const t=e.split("/");if(this.contexts.has(t[1]))return 2===t.length?Ae:Ie}}function dt(e,t){if(e){if(function(e){return!!e&&!e.disableIsolatedChannels}(t)){const t=e.trees[S.channelsTreeName];return(0,c.h)(!!t,360),t}{const t={};for(const[s,r]of Object.entries(e.trees))Ke.includes(s)||(t[s]=r);return Object.assign(Object.assign({},e),{trees:t})}}}!function(e){e[e.Local=0]="Local",e[e.Broadcast=1]="Broadcast",e[e.Acked=2]="Acked",e[e.Nacked=-1]="Nacked"}(ut||(ut={}));class mt{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=ut.Local,this.defSummaryOp=new C.B,this.defSummaryAck=new C.B}static createLocal(e,t){return new mt(e,t)}static createFromOp(e){const t=new mt(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===ut.Acked}broadcast(e){return(0,c.h)(this.state===ut.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=ut.Broadcast,!0}ackNack(e){return(0,c.h)(this.state===ut.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===g.C.SummaryAck?ut.Acked:ut.Nacked,!0}async waitBroadcast(){return await this.defSummaryOp.promise,this._summaryOp}async waitAckNack(){return await this.defSummaryAck.promise,this._summaryAckNack}}class pt{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=mt.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class gt extends u.L{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new C.B,this.deltaManager.on("op",(e=>this.handleOp(e)))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-(null!==(t=null===(e=this.lastAck)||void 0===e?void 0:e.summaryAck.sequenceNumber)&&void 0!==t?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){const t=new pt(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}async waitFlushed(){for(;this.pendingSummaries.size>0;){const e=Array.from(this.pendingSummaries,(([,e])=>e.waitAckNack()));await Promise.all(e)}return this.lastAck}async waitSummaryAck(e){for(;!this.lastAck||this.lastAck.summaryOp.referenceSequenceNumber<e;)await this.refreshWaitNextAck.promise;return this.lastAck}handleOp(e){var t;switch(e.type){case g.C.Summarize:return void this.handleSummaryOp(e);case g.C.SummaryAck:return void this.handleSummaryAck(e);case g.C.SummaryNack:return void this.handleSummaryNack(e);default:{const s=e.timestamp;return void 0!==this.lastSummaryTimestamp&&void 0!==this.maxAckWaitTime&&s-this.lastSummaryTimestamp>=this.maxAckWaitTime&&(null===(t=this.pendingAckTimerTimeoutCallback)||void 0===t||t.call(this)),void this.emit("default",e)}}}handleSummaryOp(e){let t;const s=this.summaryWatchers.get(e.clientId);s&&(t=s.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=mt.createFromOp(e),s&&s.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(g.C.Summarize,e)}handleSummaryAck(e){const t=e.contents.summaryProposal.summarySequenceNumber,s=this.pendingSummaries.get(t);s&&void 0!==s.summaryOp?(s.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:s.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new C.B,this.emit(g.C.SummaryAck,e))):t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber})}handleSummaryNack(e){const t=e.contents.summaryProposal.summarySequenceNumber,s=this.pendingSummaries.get(t);s&&(s.ackNack(e),this.pendingSummaries.delete(t),this.emit(g.C.SummaryNack,e))}}class ft extends u.L{constructor(e,t,s){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=h.G2.create(e,"OrderedClientCollection");const r=s.getMembers();for(const[e,t]of r)this.addClient(e,t);s.on("addMember",((e,s)=>{const r=this.addClient(e,s);this.emit("addClient",r,t.lastSequenceNumber)})),s.on("removeMember",(e=>{const s=t.lastSequenceNumber,r=this.removeClient(e);void 0===r?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:e,sequenceNumber:s}):this.emit("removeClient",r,s)}))}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){(0,c.h)(t.sequenceNumber>-1,502);let s=this._youngestClient;for(;s.sequenceNumber>t.sequenceNumber;)(0,c.h)(void 0!==s.olderClient,503),s=s.olderClient;const r={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:s,youngerClient:s.youngerClient};return r.olderClient.youngerClient=r,void 0===r.youngerClient?this._youngestClient=r:r.youngerClient.olderClient=r,this.clientMap.set(e,r),r}removeClient(e){const t=this.clientMap.get(e);if(void 0!==t)return t.olderClient.youngerClient=t.youngerClient,void 0===t.youngerClient?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){const e=[];let t=this.rootNode;for(;void 0!==t.youngerClient;)e.push(t.youngerClient),t=t.youngerClient;return e}}class yt extends u.L{constructor(e,t,s,r){let i,n;super(),this.orderedClientCollection=t,this.isEligibleFn=r,this._eligibleCount=0;for(const e of t.getAllClients())this.addClient(e,0),"number"!=typeof s&&(e.clientId===s.electedClientId&&(i=e,void 0===s.electedParentId&&e.client.details.type!==X&&(n=e)),e.clientId===s.electedParentId&&(n=e));t.on("addClient",((e,t)=>this.addClient(e,t))),t.on("removeClient",((e,t)=>this.removeClient(e,t))),"number"==typeof s?this._electionSequenceNumber=s:((null==i?void 0:i.clientId)!==s.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:s.electionSequenceNumber,expectedClientId:s.electedClientId,electedClientId:null==i?void 0:i.clientId,clientCount:t.count}):void 0===i||r(i)||(i=n=this.findFirstEligibleParent(n),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:s.electionSequenceNumber,expectedClientId:s.electedClientId,electedClientId:null==i?void 0:i.clientId})),this._electedParent=n,this._electedClient=i,this._electionSequenceNumber=s.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let s=!1;const r=(null==e?void 0:e.client.details.type)===X,i=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,s=!0),this._electedParent===e||r||(this._electedParent=e,s=!0),s&&this.emit("election",e,t,i)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;void 0!==t&&(!this.isEligibleFn(t)||t.client.details.type===X);)t=t.youngerClient;return t}addClient(e,t){var s;if(this.isEligibleFn(e)){this._eligibleCount++;const r=e.client.details.type===X,i=(null===(s=this._electedClient)||void 0===s?void 0:s.client.details.type)===X;void 0===this._electedClient||!i&&r?this.tryElectingClient(e,t):void 0!==this._electedParent||r||this.tryElectingParent(e,t)}}removeClient(e,t){var s,r,i,n,a;if(this.isEligibleFn(e))if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==X)throw new v.Oi("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{const e=null!==(r=this.findFirstEligibleParent(null===(s=this._electedParent)||void 0===s?void 0:s.youngerClient))&&void 0!==r?r:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(e,t)}else if(this._electedParent===e){if((null===(i=this._electedClient)||void 0===i?void 0:i.client.details.type)!==X)throw new v.Oi("Elected client should be a summarizer client 2");const e=null!==(a=this.findFirstEligibleParent(null===(n=this._electedParent)||void 0===n?void 0:n.youngerClient))&&void 0!==a?a:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(e,t)}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,s;const r=null!==(s=this.findFirstEligibleParent(null===(t=this._electedParent)||void 0===t?void 0:t.youngerClient))&&void 0!==s?s:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(r,e):this.tryElectingParent(r,e)}resetElectedClient(e){const t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return null!==(t=this.findFirstEligibleParent(null===(e=this._electedParent)||void 0===e?void 0:e.youngerClient))&&void 0!==t?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:null===(e=this.electedClient)||void 0===e?void 0:e.clientId,electedParentId:null===(t=this.electedParent)||void 0===t?void 0:t.clientId}}}class vt{constructor(e,t,s){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=s,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){const e=Date.now(),t=this.latestAttemptTime;if(void 0!==t){const s=t-e;s>0&&(this.startTimes=this.startTimes.map((e=>e-s)))}this.startTimes=this.startTimes.filter((t=>e-t<this.delayWindowMs));const s=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map((e=>e+s)),s===this.maxDelayMs&&this.startTimes.shift(),s}}new Promise((()=>{}));class bt{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new C.B}get cancelled(){return this._cancelled||(0,c.h)(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static async create(e){const t=new bt(e);return await t.waitStart(),t}async waitStart(){if(this.runtime.disposed)this.stop("summarizerClientDisconnected");else{if(this.runtime.once("dispose",(()=>this.stop("summarizerClientDisconnected"))),!this.runtime.connected){const e=new Promise((e=>this.runtime.once("connected",e)));await Promise.race([e,this.waitCancelled])}this.runtime.once("disconnected",(()=>this.stop("summarizerClientDisconnected")))}}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}class St{constructor(e,t,s,r,i=(()=>n.S.now())){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=h.G2.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",(e=>{this.startBatchSequenceNumber=e.sequenceNumber,this.batchProcessingStartTimeStamp=i(),this.trackedBatchCount++})),this.batchEventEmitter.on("batchEnd",((e,t)=>{(0,c.h)(void 0!==this.startBatchSequenceNumber&&void 0!==this.batchProcessingStartTimeStamp,698);const n=t.sequenceNumber-this.startBatchSequenceNumber+1;n>=s&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:n,threshold:s,batchEndSequenceNumber:t.sequenceNumber,duration:i()-this.batchProcessingStartTimeStamp,batchError:void 0!==e}),this.trackedBatchCount%r==0&&this.logger.sendPerformanceEvent({eventName:"Length",length:n,samplingRate:r,batchEndSequenceNumber:t.sequenceNumber,duration:i()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0}))}}var Ct,wt=s(19048);class Tt{constructor(e,t){this.storageGetter=e,this.blobs=t}static async serializeTree(e,t){const s={};return await this.serializeTreeCore(e,s,t),s}static async serializeTreeCore(e,t,s){const r=[];for(const i of Object.values(e.trees))r.push(this.serializeTreeCore(i,t,s));for(const r of Object.values(e.blobs)){const e=await s.readBlob(r);t[r]=(0,wt.zT)(e,"utf8")}return Promise.all(r)}static serializeTreeWithBlobContents(e){const t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(const s of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(s,t);for(const s of Object.values(e.blobs)){const r=e.blobsContents[s];(0,c.h)(!!r,748),t[s]=(0,wt.zT)(r,"utf8")}}get storage(){return this._storage||(this._storage=this.storageGetter()),this._storage}get repositoryUrl(){return this.storage.repositoryUrl}async readBlob(e){return void 0!==this.blobs[e]?(0,wt.k8)(this.blobs[e],"utf8"):this.storage.readBlob(e)}async getSnapshotTree(e){return this.storage.getSnapshotTree(e)}async getVersions(e,t){return this.storage.getVersions(e,t)}async createBlob(e){return this.storage.createBlob(e)}async uploadSummaryWithContext(e,t){return this.storage.uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storage.downloadSummary(e)}}class Nt{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,t||(e.inbound.on("push",(e=>{const t="string"==typeof e.contents?e.contents:JSON.stringify(e.contents),s=Nt.messageHasData(e)?e.data:"";this.messageSize[Nt.messageId(e)]=t.length+s.length})),e.on("op",(e=>{var t;this._nonSystemOpCount+=function(e){return e.type===g.C.Operation||e.type===g.C.Summarize}(e)?1:0;const s=Nt.messageId(e);this._opsSizeAccumulator+=null!==(t=this.messageSize[s])&&void 0!==t?t:0,this.messageSize.delete(s)})))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return void 0!==e.data}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias"}(Ct||(Ct={}));const Pt={state:"enabled",idleTime:15e3,maxTime:6e4,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6e4,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};var Et;!function(e){e.wait="wait",e.externalRequest="externalRequest",e.viaHandle="viaHandle"}(Et||(Et={}));const Dt=S.FlushMode.TurnBased;var Ot;!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(Ot||(Ot={}));class kt{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",(e=>{if(0===e.length)return;const t=e[0].metadata;if(!(null==t?void 0:t.batch))return;if(1===e.length)return void delete t.batch;const s=e[e.length-1];s.metadata=Object.assign(Object.assign({},s.metadata),{batch:!1})})),this.deltaManager.inbound.on("push",(e=>{this.trackPending(e)})),(0,c.h)(!this.localPaused,659);const s=this.deltaManager.inbound.toArray();for(const e of s)this.trackPending(e);this.deltaManager.on("op",(e=>this.afterOpProcessing(e.sequenceNumber)))}afterOpProcessing(e){(0,c.h)(!this.localPaused,660),0!==this.deltaManager.inbound.length?void 0!==this.pauseSequenceNumber&&((0,c.h)(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue()):(0,c.h)(void 0===this.pauseSequenceNumber,661)}pauseQueue(){(0,c.h)(!this.localPaused,663),this.localPaused=!0,this.timePaused=n.S.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){const s=t.sequenceNumber,r=this.localPaused?n.S.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3==1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:s,length:s-e+1,msnDistance:s-t.minimumSequenceNumber,duration:r,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,void 0!==r&&r>5e3&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:r,sequenceNumber:s,length:s-e}),this.deltaManager.inbound.resume())}trackPending(e){(0,c.h)(0!==this.deltaManager.inbound.length,664),(0,c.h)(void 0===this.currentBatchClientId==(void 0===this.pauseSequenceNumber),665);const t=e.metadata,s=null==t?void 0:t.batch;if(!f(e))return(0,c.h)(void 0===this.currentBatchClientId,666),(0,c.h)(void 0===s,667),void(0,c.h)(!this.localPaused,668);if(void 0!==this.currentBatchClientId||void 0!==s){if((void 0!==this.currentBatchClientId||!1===s)&&this.currentBatchClientId!==e.clientId)throw new v.Jd("OpBatchIncomplete",Object.assign({runtimeVersion:Ce,batchClientId:this.currentBatchClientId},(0,v.HN)(e)));s?((0,c.h)(void 0===this.currentBatchClientId,670),(0,c.h)(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,1===this.deltaManager.inbound.length&&this.pauseQueue()):!1===s?((0,c.h)(void 0!==this.pauseSequenceNumber,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):(0,c.h)(void 0!==this.currentBatchClientId,673)}else(0,c.h)(!this.localPaused,669)}}class _t{constructor(e,t,s){this.deltaManager=e,this.emitter=t,this.logger=s,this.hitError=!1,this.deltaScheduler=new ge(this.deltaManager,h.G2.create(this.logger,"DeltaScheduler")),new kt(e,s)}beforeOpProcessing(e){var t;if(this.batchClientId!==e.clientId){(0,c.h)(void 0===this.batchClientId,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e);const s=null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.batch;this.batchClientId=s?e.clientId:void 0}}afterOpProcessing(e,t){var s;if((0,c.h)(!this.hitError,675),e)return this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),void this.deltaScheduler.batchEnd(t);const r=null===(s=null==t?void 0:t.metadata)||void 0===s?void 0:s.batch;return void 0===this.batchClientId||!1===r?(this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),void this.deltaScheduler.batchEnd(t)):void 0}}const At="_scheduler";class It extends u.L{constructor(e,t,s,r,n,a,o,u,l,m,p,f,b,S){var C,w,T,N,P,D,O,k,_;void 0===S&&(S=Object.assign(Object.assign({},Pt),null===(C=o.summaryOptions)||void 0===C?void 0:C.summaryConfigOverrides)),super(),this.context=e,this.registry=t,this.runtimeOptions=o,this.containerScope=u,this.logger=l,this._storage=f,this.requestHandler=b,this.summaryConfiguration=S,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...e)=>{if(this.clientDetails.type===X)return this.summarizer.summarizeOnDemand(...e);if(void 0!==this.summaryManager)return this.summaryManager.summarizeOnDemand(...e);throw new v.Oi(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...e)=>{if(this.clientDetails.type===X)return this.summarizer.enqueueSummarize(...e);if(void 0!==this.summaryManager)return this.summaryManager.enqueueSummarize(...e);throw new v.Oi(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=null==s?void 0:s.message,this.disableIsolatedChannels=null!==(w=this.runtimeOptions.summaryOptions.disableIsolatedChannels)&&void 0!==w&&w,this._connected=this.context.connected,this.chunkMap=new Map(n),this.handleContext=new j("",this),this.mc=(0,d.rZ)(h.G2.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=null!==(T=this.mc.config.getBoolean("Fluid.ContainerRuntime.UseDataStoreAliasing"))&&void 0!==T&&T||null!==(N=o.useDataStoreAliasing)&&void 0!==N&&N,this._maxOpSizeInBytes=null!==(P=this.mc.config.getNumber("Fluid.ContainerRuntime.MaxOpSizeInBytes"))&&void 0!==P?P:768e3,this.maxConsecutiveReconnects=null!==(D=this.mc.config.getNumber("Fluid.ContainerRuntime.MaxConsecutiveReconnects"))&&void 0!==D?D:this.defaultMaxConsecutiveReconnects,this._flushMode=o.flushMode;const I=e.pendingLocalState,M=null!==(O=null==I?void 0:I.baseSnapshot)&&void 0!==O?O:e.baseSnapshot;this.garbageCollector=ze.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:M,baseLogger:this.mc.logger,existing:m,metadata:s,isSummarizerClient:this.context.clientDetails.type===X,getNodePackagePath:async e=>this.getGCNodePackagePath(e),getLastSummaryTimestampMs:()=>{var e;return null===(e=this.messageAtLastSummary)||void 0===e?void 0:e.timestamp},readAndParseBlob:async e=>(0,y.g)(this.storage,e)});const R=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=((e,t,s,r,i={},n,a)=>new A(e,t,i,s,void 0===r?void 0:E.createForRoot(r),void 0,void 0,n,a))(h.G2.create(this.logger,"SummarizerNode"),(async(e,t,s)=>this.summarizeInternal(e,t,s)),R,M?R:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),M&&this.summarizerNode.loadBaseSummaryWithoutDifferential(M),this.dataStores=new ht(dt(M,s),this,(e=>this.submit(Ct.Attach,e)),((e,t)=>(s,r,i)=>this.summarizerNode.createChild(s,e,t,void 0,r,i)),(e=>this.summarizerNode.deleteChild(e)),this.mc.logger,(async()=>this.garbageCollector.getBaseGCDetails()),((e,t,s)=>this.garbageCollector.nodeUpdated(e,"Changed",t,s)),new Map(a),this.garbageCollector.writeDataAtRoot),this.blobManager=new Te(this.handleContext,p,(()=>this.storage),(e=>this.submit(Ct.BlobAttach,void 0,void 0,{blobId:e})),(e=>this.garbageCollector.nodeUpdated(e,"Loaded")),this,this.logger),this.scheduleManager=new _t(e.deltaManager,this,h.G2.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new Se({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:e=>this.setFlushMode(e)},this._flushMode,null==I?void 0:I.pending),this.context.quorum.on("removeMember",(e=>{this.clearPartialChunks(e)})),this.summaryCollection=new gt(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==i.mB.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{const e=h.G2.create(this.logger,"OrderedClientElection"),t=new ft(e,this.context.deltaManager,this.context.quorum),s=new yt(e,t,null!=r?r:this.context.deltaManager.lastSequenceNumber,$.isClientEligible);if(this.summarizerClientElection=new $(e,this.summaryCollection,s,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===X)this._summarizer=new me("/_summarizer",this,(()=>this.summaryConfiguration),this,this.handleContext,this.summaryCollection,(async e=>bt.create(e)));else if($.clientDetailsPermitElection(this.context.clientDetails)){const e=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(g.C.SummaryAck,(()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",e)})),this.summaryCollection.off("default",e))};this.summaryCollection.on("default",e),this.summaryManager=new pe(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new vt(6e4,3e4,(({multiplier:e=2,coefficient:t=1,offset:s=0,initialDelay:r}={})=>i=>Math.max(0,i<=0&&void 0!==r?r:t*Math.pow(e,i)+s))({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}let F;this.deltaManager.on("readonly",(e=>{(0,c.h)(e===this.deltaManager.readOnlyInfo.readonly,292),(0,c.h)(!e||!this.connected,293),this.replayPendingStates()})),l.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},function(){try{if("object"==typeof navigator&&null!==navigator)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch(e){}return{}}())),m?(this.createContainerMetadata={createContainerRuntimeVersion:null==s?void 0:s.createContainerRuntimeVersion,createContainerTimestamp:null==s?void 0:s.createContainerTimestamp},F=null!==(_=null!==(k=null==s?void 0:s.summaryNumber)&&void 0!==k?k:null==s?void 0:s.summaryCount)&&void 0!==_?_:0):(this.createContainerMetadata={createContainerRuntimeVersion:Ce,createContainerTimestamp:Date.now()},F=0),this.nextSummaryNumber=F+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:F,summaryFormatVersion:null==s?void 0:s.summaryFormatVersion,disableIsolatedChannels:null==s?void 0:s.disableIsolatedChannels,gcVersion:null==s?void 0:s.gcFeature})),function(e,t,s){new fe(e,t,s)}(this.context.clientId,this.deltaManager,this.logger),((e,t,s=1e3,r=1e3)=>{new St(e,t,s,r)})(this,this.logger),this.opTracker=new Nt(this.deltaManager,!0===this.mc.config.getBoolean("Fluid.ContainerRuntime.DisableOpTracking"))}get IContainerRuntime(){return this}get IFluidRouter(){return this}static async load(e,t,s,r={},i=e.scope,n){var a,o,u;const l=e,d=null!==(a=l.taggedLogger)&&void 0!==a?a:new h.cP(l.logger),m=h.G2.create(d,void 0,{all:{runtimeVersion:Ce}}),{summaryOptions:p={},gcOptions:g={},loadSequenceNumberVerification:f="close",useDataStoreAliasing:b=!1,flushMode:S=Dt,enableOfflineLoad:C=!1}=r,w=e.pendingLocalState,T=null!==(o=null==w?void 0:w.baseSnapshot)&&void 0!==o?o:e.baseSnapshot,N=w?new Tt((()=>e.storage),w.snapshotBlobs):e.storage,P=new G.P(t),E=async e=>{const t=null==T?void 0:T.blobs[e];if(T&&t)return(0,c.h)(void 0!==N,501),(0,y.g)(N,t)},[D,O,k,_]=await Promise.all([E(Xe),E(He),E($e),E(Ve)]),A=!0===n||!0===e.existing,I=await Te.load(null==T?void 0:T.trees[".blobs"],(async e=>((0,c.h)(void 0!==N,598),(0,y.g)(N,e)))),M=null===(u=null==O?void 0:O.message)||void 0===u?void 0:u.sequenceNumber;if(!w&&void 0!==M){const t=e.deltaManager.initialSequenceNumber;if("bypass"!==f&&M!==t){const s=new v.Jd("Summary metadata mismatch",{runtimeVersion:Ce,runtimeSequenceNumber:M,protocolSequenceNumber:t});"log"===f?m.sendErrorEvent({eventName:"SequenceNumberMismatch"},s):e.closeFn(s)}}const R=new It(e,P,O,k,null!=D?D:[],null!=_?_:[],{summaryOptions:p,gcOptions:g,loadSequenceNumberVerification:f,useDataStoreAliasing:b,flushMode:S,enableOfflineLoad:C},i,m,A,I,N,s);return w&&(await R.processSavedOps(w),w.savedOps=[]),await R.getSnapshotBlobs(),R}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return null===(e=this.summarizerClientElection)||void 0===e?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return(0,c.h)(void 0!==this._summarizer,599),this._summarizer}isSummariesDisabled(){return!0===this.runtimeOptions.summaryOptions.disableSummaries||"disabled"===this.summaryConfiguration.state}isHeuristicsDisabled(){var e;return!0===(null===(e=this.runtimeOptions.summaryOptions.summarizerOptions)||void 0===e?void 0:e.disableHeuristics)||"disableHeuristics"===this.summaryConfiguration.state}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?null===(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))||void 0===e||e:!0===this.runtimeOptions.summaryOptions.summarizerClientElection||"disabled"!==this.summaryConfiguration.state&&!0===this.summaryConfiguration.summarizerClientElection}getMaxOpsSinceLastSummary(){return void 0!==this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return void 0!==this.runtimeOptions.summaryOptions.initialSummarizerDelayMs?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),void 0!==this.summaryManager&&this.summaryManager.dispose(),this.garbageCollector.dispose(),null===(t=this._summarizer)||void 0===t||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(null===(e=this.options)||void 0===e?void 0:e.intelligence)return{intelligence:this.options.intelligence}}async request(e){try{const t=I.R.create(e);return"_summarizer"===t.pathParts[0]&&1===t.pathParts.length?void 0!==this._summarizer?{status:200,mimeType:"fluid/object",value:this.summarizer}:(0,M.I4)(e):void 0!==this.requestHandler?this.requestHandler(t,this):(0,M.I4)(e)}catch(e){return(0,M.Nj)(e)}}async resolveHandle(e){try{const t=I.R.create(e),s=t.pathParts[0];if("_channels"===s)return this.resolveHandle(t.createSubRequest(1));if(s===Te.basePath&&t.isLeaf(2)){const s=await this.blobManager.getBlob(t.pathParts[1]);return s?{status:200,mimeType:"fluid/object",value:s.get()}:(0,M.I4)(e)}if(t.pathParts.length>0){const r=await this.getDataStoreFromRequest(s,e),i=t.createSubRequest(1);return(0,c.h)(i.url.startsWith("/"),294),r.IFluidRouter.request(i)}return(0,M.I4)(e)}catch(e){return(0,M.Nj)(e)}}internalId(e){var t;return null!==(t=this.dataStores.aliases().get(e))&&void 0!==t?t:e}async getDataStoreFromRequest(e,t){var s,r,i;const n="boolean"!=typeof(null===(s=t.headers)||void 0===s?void 0:s[Et.wait])||(null===(r=t.headers)||void 0===r?void 0:r[Et.wait]),a=this.internalId(e),o=await this.dataStores.getDataStore(a,n);if((null===(i=t.headers)||void 0===i?void 0:i[Et.externalRequest])&&this.garbageCollector.shouldRunGC){const e=(await o.getBaseGCDetails()).usedRoutes;if(void 0!==e&&!e.includes("")&&!e.includes("/"))throw(0,M.fu)((0,M.I4)(t),t)}const c=await o.realize(),u=t.url.split("?")[0].replace(/^\/+|\/+$/g,"");return this.garbageCollector.nodeUpdated(`/${u}`,"Loaded",void 0,o.packagePath,null==t?void 0:t.headers),c}addMetadataToSummary(e){var t;const s=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:null!==(r=this.deltaManager.lastMessage,t=void 0===r?void 0:{clientId:r.clientId,clientSequenceNumber:r.clientSequenceNumber,minimumSequenceNumber:r.minimumSequenceNumber,referenceSequenceNumber:r.referenceSequenceNumber,sequenceNumber:r.sequenceNumber,timestamp:r.timestamp,type:r.type})&&void 0!==t?t:this.messageAtLastSummary});var r;(0,T.Rt)(e,He,JSON.stringify(s))}addContainerStateToSummary(e,t,s,r){var i;if(this.addMetadataToSummary(e),this.chunkMap.size>0){const t=JSON.stringify([...this.chunkMap]);(0,T.Rt)(e,Xe,t)}const n=this.dataStores.aliases();if(n.size>0&&(0,T.Rt)(e,Ve,JSON.stringify([...n])),this.summarizerClientElection){const t=JSON.stringify(null===(i=this.summarizerClientElection)||void 0===i?void 0:i.serialize());(0,T.Rt)(e,$e,t)}const a=this.blobManager.summarize();if(Object.keys(a.summary.tree).length>0&&(0,T.Jv)(e,We,a),this.garbageCollector.writeDataAtRoot){const i=this.garbageCollector.summarize(t,s,r);void 0!==i&&(0,T.QA)(e,"gc",i)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0||(this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0))}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;const e=this.dirtyContainer;let t;this.dirtyContainer=!1,(0,c.h)(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}async applyStashedOp(e,t){switch(e){case Ct.FluidDataStoreOp:return this.dataStores.applyStashedOp(t);case Ct.Attach:return this.dataStores.applyStashedAttachOp(t);case Ct.Alias:case Ct.BlobAttach:return;case Ct.ChunkedOp:throw new Error("chunkedOp not expected here");case Ct.Rejoin:throw new Error("rejoin not expected here");default:(0,l.U)(e,`Unknown ContainerMessageType: ${e}`)}}setConnectionState(e,t){this.verifyNotClosed();const s=this._connected!==e,r=s&&e;this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),!r||(this.consecutiveReconnects++,this.shouldContinueReconnecting())?(s&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),(0,m.Qq)(this.mc.logger,this,e,t)):this.closeFn(v.Hi.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}))}process(e,t){var s,r;if(this.verifyNotClosed(),!f(e))return;(null!==(s=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==s?s:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let i=Object.assign({},e);this.scheduleManager.beforeOpProcessing(i);try{let e;switch(i=function(e){if(e.type===g.C.Operation){if(void 0!==e.contents.address&&void 0===e.contents.type)e.type=Ct.FluidDataStoreOp;else{const t=e.contents;(0,c.h)(void 0!==t.type,289),e.type=t.type,e.contents=t.contents}(0,c.h)(f(e),290)}return e}(i),i=this.processRemoteChunkedMessage(i),t&&i.type!==Ct.ChunkedOp&&(e=this.pendingStateManager.processPendingLocalMessage(i)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),i.type){case Ct.Attach:this.dataStores.processAttachMessage(i,t);break;case Ct.Alias:this.processAliasMessage(i,e,t);break;case Ct.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(i,t,e);break;case Ct.BlobAttach:(0,c.h)(null===(r=null==i?void 0:i.metadata)||void 0===r?void 0:r.blobId,298),this.blobManager.processBlobAttachOp(i.metadata.blobId,t)}this.emit("op",i),this.scheduleManager.afterOpProcessing(void 0,i),t&&this.resetReconnectCount()}catch(e){throw this.scheduleManager.afterOpProcessing(e,i),e}}processAliasMessage(e,t,s){this.dataStores.processAliasMessage(e,t,s)}sendSignalTelemetryEvent(e){const t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){const s=e.content,r={clientId:e.clientId,content:s.contents.content,type:s.contents.type};e.clientId===this.clientId&&this.connected&&(void 0!==this._perfSignalData.trackingSignalSequenceNumber&&s.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:s.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:s.clientSignalSequenceNumber})):s.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(s.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),void 0!==s.address?this.dataStores.processSignal(s.address,r,t):this.emit("signal",r,t)}async getRootDataStore(e,t=!0){const s=this.internalId(e),r=await this.dataStores.getDataStore(s,t);return(0,c.h)(await r.isRoot(),299),r.realize()}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===S.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if((0,c.h)(0===this._orderSequentiallyCalls,588),this.deltaSender&&(this.pendingStateManager.onFlush(),this.needsFlush&&(this.needsFlush=!1,this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===S.FlushMode.TurnBased)return void this.trackOrderSequentiallyCalls(e);const t=this.flushMode;this.setFlushMode(S.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(e){throw t?t.rollback():this.closeFn(new v.pY("orderSequentially callback exception",e)),e}finally{this._orderSequentiallyCalls--}}async createDataStore(e){const t=(0,L.Z)();return ot(await this._createDataStore(e,!1,t),t,this,this.dataStores,this.mc.logger)}async createRootDataStoreLegacy(e,t){const s=await this._createDataStore(e,!0,t);return void 0!==s.makeVisibleAndAttachGraph?s.makeVisibleAndAttachGraph():s.bindToContext(),s}async createRootDataStore(e,t){if(t.includes("/"))throw new v.Oi(`Id cannot contain slashes: '${t}'`);return!0===this._aliasingEnabled?this.createAndAliasDataStore(e,t):this.createRootDataStoreLegacy(e,t)}async createAndAliasDataStore(e,t,s){const r=(0,L.Z)(),i=await this._createDataStore(e,!1,r,s),n=ot(i,r,this,this.dataStores,this.mc.logger),a=await n.trySetAlias(t);if("Success"!==a)throw new v.pY("dataStoreAliasFailure",void 0,{alias:{value:t,tag:h.XI.UserData},internalId:{value:r,tag:h.XI.PackageData},aliasResult:a});return n}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new v.Oi(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}async _createDataStoreWithPropsLegacy(e,t,s=(0,L.Z)(),r=!1){const i=await this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],s,r,t).realize();return r&&(void 0!==i.makeVisibleAndAttachGraph?i.makeVisibleAndAttachGraph():i.bindToContext(),this.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:void 0!==t})),ot(i,s,this,this.dataStores,this.mc.logger)}async _createDataStoreWithProps(e,t,s=(0,L.Z)(),r=!1){return!0===this._aliasingEnabled&&r?this.createAndAliasDataStore(e,s,t):this._createDataStoreWithPropsLegacy(e,t,s,r)}async _createDataStore(e,t,s=(0,L.Z)(),r){return this.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],s,t,r).realize()}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===Ct.Attach){if(t.id===At)return!1}else if(e===Ct.FluidDataStoreOp&&t.address===At)return!1;return!0}createNewSignalEnvelope(e,t,s){const r=++this._perfSignalData.signalSequenceNumber,i={address:e,clientSignalSequenceNumber:r,contents:{type:t,content:s}};return r%this.defaultTelemetrySignalSampleCount==1&&void 0===this._perfSignalData.trackingSignalSequenceNumber&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=r),i}submitSignal(e,t){this.verifyNotClosed();const s=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(s)}submitDataStoreSignal(e,t,s){const r=this.createNewSignalEnvelope(e,t,s);return this.context.submitSignalFn(r)}setAttachState(e){e===i.mB.Attaching?(0,c.h)(this.attachState===i.mB.Attaching,301):((0,c.h)(this.attachState===i.mB.Attached,302),this.emit("attached")),e!==i.mB.Attached||this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);const s=this.dataStores.createSummary(t);return this.disableIsolatedChannels||Ze(s),this.addContainerStateToSummary(s,!0,!1,t),s.summary}async getAbsoluteUrl(e){if(void 0===this.context.getAbsoluteUrl)throw new Error("Driver does not implement getAbsoluteUrl");if(this.attachState===i.mB.Attached)return this.context.getAbsoluteUrl(e)}async summarizeInternal(e,t,s){const r=await this.dataStores.summarize(e,t,s);let i;return this.disableIsolatedChannels||(Ze(r),i=[S.channelsTreeName]),this.addContainerStateToSummary(r,e,t,s),Object.assign(Object.assign({},r),{id:"",pathPartsForChildren:i})}async summarize(e){this.verifyNotClosed();const{fullTree:t=!1,trackState:s=!0,summaryLogger:r=this.mc.logger,runGC:i=this.garbageCollector.shouldRunGC,runSweep:n,fullGC:a}=e;let o;i&&(o=await this.collectGarbage({logger:r,runSweep:n,fullGC:a}));const u=new T.TA,{stats:l,summary:h}=await this.summarizerNode.summarize(t,s,u);return this.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:u.serialize()}),(0,c.h)(h.type===b.J.Tree,303),{stats:l,summary:h,gcStats:o}}async updateStateBeforeGC(){return this.dataStores.updateStateBeforeGC()}async getGCData(e){const t=new x,s=await this.dataStores.getGCData(e);t.addNodes(s.gcNodes);const r=this.blobManager.getGCData(e);return t.addNodes(r.gcNodes),t.getGCData()}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);const s=[];for(const t of e)t.split("/")[1]!==Te.basePath&&s.push(t);return this.dataStores.updateUsedRoutes(s,t)}deleteUnusedRoutes(e){const t=[],s=[];for(const r of e)this.isBlobPath(r)?t.push(r):s.push(r);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(s)}getCurrentReferenceTimestampMs(){var e,t,s;return null!==(t=null===(e=this.deltaManager.lastMessage)||void 0===e?void 0:e.timestamp)&&void 0!==t?t:null===(s=this.messageAtLastSummary)||void 0===s?void 0:s.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?Me:null!==(t=this.dataStores.getGCNodeType(e))&&void 0!==t?t:"Other"}async getGCNodePackagePath(e){switch(this.getNodeType(e)){case Me:return["_blobs"];case Ae:case Ie:return this.dataStores.getDataStorePackagePath(e);default:(0,c.h)(!1,734)}}isBlobPath(e){const t=e.split("/");return!(t.length<2||t[1]!==Te.basePath)}async collectGarbage(e){return this.garbageCollector.collectGarbage(e)}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}async submitSummary(e){var t,s,r;const{fullTree:i,refreshLatestAck:n,summaryLogger:o}=e,u=this.nextSummaryNumber,l=h.G2.create(o,void 0,{all:{summaryNumber:u}});let d;if(n){const e=await this.refreshLatestSummaryAckFromServer(h.G2.create(l,void 0,{all:{safeSummary:!0}})),t=e.latestSnapshotRefSeq;d=e.latestSnapshotVersionId,t>this.deltaManager.lastSequenceNumber&&await h.Xr.timedExecAsync(l,{eventName:"WaitingForSeq",lastSequenceNumber:this.deltaManager.lastSequenceNumber,targetSequenceNumber:t,lastKnownSeqNumber:this.deltaManager.lastKnownSeqNumber},(async()=>Mt(this.deltaManager,t)),{start:!0,end:!0,cancel:"error"})}try{await this.deltaManager.inbound.pause();const n=this.deltaManager.lastSequenceNumber,o=this.deltaManager.minimumSequenceNumber,h=`Summary @${n}:${this.deltaManager.minimumSequenceNumber}`;n!==(null===(t=this.deltaManager.lastMessage)||void 0===t?void 0:t.sequenceNumber)&&l.sendErrorEvent({eventName:"LastSequenceMismatch",error:h}),this.summarizerNode.startSummary(n,l);const m=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:((0,c.h)(this.connected,600),this.deltaManager.lastSequenceNumber!==n?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${this.deltaManager.lastSequenceNumber} !== ${n}`}:{continue:!0});let p=m();if(!p.continue)return{stage:"base",referenceSequenceNumber:n,minimumSequenceNumber:o,error:p.error};const f=a.start();let y;const v=this.garbageCollector.summaryStateNeedsReset;try{y=await this.summarize({fullTree:i||v,trackState:!0,summaryLogger:l,runGC:this.garbageCollector.shouldRunGC})}catch(e){return{stage:"base",referenceSequenceNumber:n,minimumSequenceNumber:o,error:e}}const{summary:C,stats:w}=y;this.messageAtLastSummary=this.deltaManager.lastMessage;const N=this.disableIsolatedChannels?C:C.tree[S.channelsTreeName];(0,c.h)(N.type===b.J.Tree,508);const P=Object.values(N.tree).filter((e=>e.type===b.J.Handle)).length,E=C.tree.gc?(0,T.i6)(C.tree.gc):void 0,D=Object.assign({dataStoreCount:this.dataStores.size,summarizedDataStoreCount:this.dataStores.size-P,gcStateUpdatedDataStoreCount:null===(s=y.gcStats)||void 0===s?void 0:s.updatedDataStoreCount,gcBlobNodeCount:null==E?void 0:E.blobNodeCount,gcTotalBlobsSize:null==E?void 0:E.totalBlobSize,opsSizesSinceLastSummary:this.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:this.opTracker.nonSystemOpCount,summaryNumber:u},w),O={referenceSequenceNumber:n,minimumSequenceNumber:o,summaryTree:C,summaryStats:D,generateDuration:f.trace().duration,forcedFullTree:v};if(p=m(),!p.continue)return Object.assign(Object.assign({stage:"generate"},O),{error:p.error});const k=this.summaryCollection.latestAck;let _,A;_=(null==k?void 0:k.summaryAck.contents.handle)!==d&&void 0!==d?{proposalHandle:void 0,ackHandle:d,referenceSequenceNumber:n}:void 0===k?{proposalHandle:void 0,ackHandle:null===(r=this.context.getLoadedFromVersion())||void 0===r?void 0:r.id,referenceSequenceNumber:n}:{proposalHandle:k.summaryOp.contents.handle,ackHandle:k.summaryAck.contents.handle,referenceSequenceNumber:n};try{A=await this.storage.uploadSummaryWithContext(y.summary,_)}catch(e){return Object.assign(Object.assign({stage:"generate"},O),{error:e})}const I=_.ackHandle,M={handle:A,head:I,message:h,parents:I?[I]:[]},R=Object.assign(Object.assign({},O),{handle:A,uploadDuration:f.trace().duration});if(p=m(),!p.continue)return Object.assign(Object.assign({stage:"upload"},R),{error:p.error});let F;try{F=this.submitSystemMessage(g.C.Summarize,M)}catch(e){return Object.assign(Object.assign({stage:"upload"},R),{error:e})}const x=Object.assign(Object.assign({stage:"submit"},R),{clientSequenceNumber:F,submitOpDuration:f.trace().duration});return this.summarizerNode.completeSummary(A),this.opTracker.reset(),x}finally{this.summarizerNode.clearSummary(),this.deltaManager.inbound.resume()}}processRemoteChunkedMessage(e){if(e.type!==Ct.ChunkedOp)return e;const t=e.clientId,s=e.contents;if(this.addChunk(t,s),s.chunkId===s.totalChunks){const r=Object.assign({},e),i=this.chunkMap.get(t).join("");return r.contents=JSON.parse(i),r.type=s.originalType,this.clearPartialChunks(t),r}return e}addChunk(e,t){let s=this.chunkMap.get(e);void 0===s&&(s=[],this.chunkMap.set(e,s)),(0,c.h)(t.chunkId===s.length+1,305),s.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,s){const r={address:e,contents:t};this.submit(Ct.FluidDataStoreOp,r,s)}submitDataStoreAliasOp(e,t){if(!at(e))throw new v.Oi("malformedDataStoreAliasMessage");this.submit(Ct.Alias,e,t)}async uploadBlob(e){return this.verifyNotClosed(),this.blobManager.createBlob(e)}submit(e,t,s,r){this.verifyNotClosed(),(0,c.h)(this.attachState!==i.mB.Detached,306);let n=-1,a=r;if(this.canSendOps()){const s=JSON.stringify(t),i=this.context.deltaManager.maxMessageSize;this.flushMode!==S.FlushMode.TurnBased||this.needsFlush||(a=Object.assign(Object.assign({},r),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then((()=>{this.flushTrigger=!1,this.flush()}))),n=this.submitMaybeChunkedMessages(e,t,s,i,this._flushMode===S.FlushMode.TurnBased,a)}this.pendingStateManager.onSubmitMessage(e,n,this.deltaManager.lastSequenceNumber,t,s,a),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,s,r,i,n){return this._maxOpSizeInBytes>=0?!s||s.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,i,n):(this.closeFn(new v.pY("OpTooLarge",void 0,{length:{value:s.length,tag:h.XI.PackageData},limit:{value:this._maxOpSizeInBytes,tag:h.XI.PackageData}})),-1):!s||s.length<=r?this.submitRuntimeMessage(e,t,i,n):this.submitChunkedMessage(e,s,r)}submitChunkedMessage(e,t,s){const r=t.length,i=Math.floor((r-1)/s)+1;let n=0,a=0;for(let r=1;r<=i;r+=1){const o={chunkId:r,contents:t.substr(n,s),originalType:e,totalChunks:i};n+=s,a=this.submitRuntimeMessage(Ct.ChunkedOp,o,!1)}return a}submitSystemMessage(e,t){this.verifyNotClosed(),(0,c.h)(this.connected,307);const s=this.flushMode===S.FlushMode.TurnBased&&this.needsFlush;return s&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,s)}submitRuntimeMessage(e,t,s,r){this.verifyNotClosed(),(0,c.h)(this.connected,601);const i={type:e,contents:t};return this.context.submitFn(g.C.Operation,i,s,r)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,s,r){switch(e){case Ct.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,s);break;case Ct.Attach:case Ct.Alias:this.submit(e,t,s);break;case Ct.ChunkedOp:throw new Error("chunkedOp not expected here");case Ct.BlobAttach:this.submit(e,t,s,r);break;case Ct.Rejoin:this.submit(e,t);break;default:(0,l.U)(e,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,s){if(e!==Ct.FluidDataStoreOp)throw new Error(`Can't rollback ${e}`);this.dataStores.rollbackDataStoreOp(t,s)}async refreshLatestSummaryAck(e,t,s,r){const i=async e=>(0,y.g)(this.storage,e),{snapshotTree:n}=await this.fetchSnapshotFromStorage(t,r,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:s,fetchLatest:!1}),a=await this.summarizerNode.refreshLatestSummary(e,s,(async()=>n),i,r);await this.garbageCollector.latestSummaryStateRefreshed(a,i)}async refreshLatestSummaryAckFromServer(e){const{snapshotTree:t,versionId:s}=await this.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),r=async e=>(0,y.g)(this.storage,e),i=await async function(e,t){const s=e.trees[".protocol"].blobs.attributes;return(await t(s)).sequenceNumber}(t,r),n=await this.summarizerNode.refreshLatestSummary(void 0,i,(async()=>t),r,e);return await this.garbageCollector.latestSummaryStateRefreshed(n,r),{latestSnapshotRefSeq:i,latestSnapshotVersionId:s}}async fetchSnapshotFromStorage(e,t,s){return h.Xr.timedExecAsync(t,s,(async t=>{const s={},r=a.start(),i=await this.storage.getVersions(e,1);(0,c.h)(!!i&&!!i[0],311),s.getVersionDuration=r.trace().duration;const n=await this.storage.getSnapshotTree(i[0]);return(0,c.h)(!!n,312),s.getSnapshotDuration=r.trace().duration,t.end(s),{snapshotTree:n,versionId:i[0].id}}))}notifyAttaching(e){var t;(null!==(t=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==t?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=Tt.serializeTreeWithBlobContents(e))}async getSnapshotBlobs(){var e;(null!==(e=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==e?e:this.runtimeOptions.enableOfflineLoad)&&this.attachState===i.mB.Attached&&!this.context.pendingLocalState&&((0,c.h)(!!this.context.baseSnapshot,741),this.baseSnapshotBlobs=await Tt.serializeTree(this.context.baseSnapshot,this.storage))}getPendingLocalState(){var e;if(!(null!==(e=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==e?e:this.runtimeOptions.enableOfflineLoad))throw new v.Oi("can't get state when offline load disabled");const t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:((0,c.h)(!!this.context.baseSnapshot,742),(0,c.h)(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return async()=>{const t={headers:{[r.cache]:!1,[r.clientDetails]:{capabilities:{interactive:!1},type:X},[o.summarizingClient]:!0,[r.reconnect]:!1},url:"/_summarizer"},s=(await(0,M.bb)(e,t)).ISummarizer;if(!s)throw new v.Oi("Fluid object does not implement ISummarizer");return s}}async processSavedOps(e){for(const t of e.savedOps)this.process(t,!1),await this.pendingStateManager.applyStashedOpsAt(t.sequenceNumber);await this.pendingStateManager.applyStashedOpsAt()}}const Mt=async(e,t)=>new Promise(((s,r)=>{e.on("closed",r);const i=r=>{r.sequenceNumber>=t&&(s(),e.off("op",i))};e.on("op",i)}))},62044:(e,t,s)=>{"use strict";s.d(t,{P:()=>i});var r=s(67008);class i{constructor(e){this.map=new Map;for(const t of e){if(this.map.has(t[0]))throw new r.Oi("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}async get(e){if(this.map.has(e))return this.map.get(e)}}},67008:(e,t,s)=>{"use strict";var r,i;s.d(t,{Lf:()=>c,Jd:()=>u,Hi:()=>l,pY:()=>a,Oi:()=>o,HN:()=>h}),(i=r||(r={})).genericError="genericError",i.throttlingError="throttlingError",i.dataCorruptionError="dataCorruptionError",i.dataProcessingError="dataProcessingError",i.usageError="usageError",i.clientSessionExpiredError="clientSessionExpiredError";var n=s(57921);class a extends n.j4{constructor(e,t,s){super(e,s,new Set(["error"])),this.error=t,this.errorType=r.genericError}}class o extends n.j4{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}}class c extends n.j4{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=r.clientSessionExpiredError}}class u extends n.j4{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=r.dataCorruptionError,this.canRetry=!1}}class l extends n.j4{constructor(e){super(e),this.errorType=r.dataProcessingError,this.canRetry=!1}static create(e,t,s,r={}){const i=l.wrapIfUnrecognized(e,t,s);return i.addTelemetryProperties(r),i}static wrapIfUnrecognized(e,t,s){const r=Object.assign({dataProcessingError:1,dataProcessingCodepath:t},void 0===s?void 0:h(s)),i=(0,n.SC)(e,{props:r});if(!(0,n.XY)(i))return i;const a=(0,n.Jn)(i,(e=>new l(e)));return a.addTelemetryProperties(i.getTelemetryProperties()),a}}const h=e=>({messageClientId:e.clientId,messageSequenceNumber:e.sequenceNumber,messageClientSequenceNumber:e.clientSequenceNumber,messageReferenceSequenceNumber:e.referenceSequenceNumber,messageMinimumSequenceNumber:e.minimumSequenceNumber,messageTimestamp:e.timestamp})},99139:(e,t,s)=>{"use strict";s.d(t,{B:()=>i});var r=s(97495);class i{constructor(e,t,s){this.value=e,this.path=t,this.routeContext=s,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=(0,r.H)(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}async get(){return this.value}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach((e=>{e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){this.visible?e.attachGraph():this.pendingHandlesToMakeVisible.add(e)}}},34628:(e,t,s)=>{"use strict";s.d(t,{m:()=>u});var r=s(19048),i=s(44098),n=s(44394),a=s(72378),o=s(50084);function c(e,t,s){const a=[];for(const u of t){const t=`${e}${u.path}`;if(u.type===n.S.Blob){const e=u.value,i=(0,r.k8)(e.contents,e.encoding),c=(0,o.Z)();s.set(c,i);const l={mode:n.m[u.mode],path:t,sha:c,size:0,type:"blob",url:""};a.push(l)}else if(u.type===n.S.Tree){(0,i.h)(u.type===n.S.Tree,257);const e=u.value,r={mode:n.m[u.mode],path:t,sha:"",size:-1,type:"tree",url:""};a.push(r);const o=c(`${t}/`,e.entries,s);a.push(...o)}}return a}function u(e,t){const s=function(e,t){return{sha:"",tree:c("",e,t),url:""}}(e,t);return(0,a.eB)(s)}},52578:(e,t,s)=>{"use strict";s.d(t,{g:()=>i});var r=s(19048);async function i(e,t){const s=await e.readBlob(t),i=(0,r.zT)(s,"utf8");return JSON.parse(i)}},25910:(e,t,s)=>{"use strict";s.d(t,{u:()=>b,y:()=>v});var r,i,n=s(44098),a=s(42019),o=s(67008),c=s(52578),u=s(71062),l=s(32361),h=s(36610),d=s(88628),m=s(77097),p=s(44725),g=s(29628);const f=m.posix,y="header";class v{get type(){return v.Type}get attributes(){return v.Attributes}async load(e,t,s,r){const i=new b(t,e,r);return await i.load(s),i}create(e,t){const s=new b(t,e,v.Attributes);return s.initializeLocal(),s}}v.Type="https://graph.microsoft.com/types/directory",v.Attributes={type:v.Type,snapshotFormatVersion:"0.1",packageVersion:g.Z};class b extends l.h{constructor(e,t,s){super(e,t,s,"fluid_directory_"),this[r]="SharedDirectory",this.root=new T(this,this.runtime,this.serializer,f.sep),this.messageHandlers=new Map,this.localValueMaker=new p.oU(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",((e,t)=>{this.emit("containedValueChanged",e,t,this)})),this.root.on("subDirectoryCreated",((e,t)=>{this.emit("subDirectoryCreated",e,t,this)})),this.root.on("subDirectoryDeleted",((e,t)=>{this.emit("subDirectoryDeleted",e,t,this)}))}static create(e,t){return e.createChannel(t,v.Type)}static getFactory(){return new v}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(r=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===f.sep)return this.root;let s=this.root;const r=t.substr(1).split(f.sep);for(const e of r)if(s=s.getSubDirectory(e),!s)return;return s}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const s=e,r=this.messageHandlers.get(s.type);(0,n.h)(void 0!==r,13),r.submit(s,t)}async loadCore(e){const t=await(0,c.g)(e,y),s=t;Array.isArray(s.blobs)?(this.populate(s.content),await Promise.all(s.blobs.map((async t=>{const s=await(0,c.g)(e,t);this.populate(s)})))):this.populate(t)}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[e,s]=t.pop();if(s.subdirectories)for(const[r,i]of Object.entries(s.subdirectories)){let s=e.getSubDirectory(r);s||(s=new T(this,this.runtime,this.serializer,f.join(e.absolutePath,r)),e.populateSubDirectory(r,s)),t.push([s,i])}if(s.storage)for(const[t,r]of Object.entries(s.storage)){const s=this.makeLocal(t,e.absolutePath,r);e.populateStorage(t,s)}}}processCore(e,t,s){if(e.type===u.C.Operation){const r=e.contents,i=this.messageHandlers.get(r.type);(0,n.h)(void 0!==i,14),i.process(r,t,s)}}rollback(e,t){const s=e,r=this.getWorkingDirectory(s.path);r&&r.rollback(s,t)}makeAbsolute(e){return f.resolve(f.sep,e)}makeLocal(e,t,s){return(0,n.h)(s.type===h.G[h.G.Plain]||s.type===h.G[h.G.Shared],484),this.localValueMaker.fromSerializable(s)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,s)=>{const r=this.getWorkingDirectory(e.path);r&&r.processClearMessage(e,t,s)},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,s)=>{const r=this.getWorkingDirectory(e.path);r&&r.processDeleteMessage(e,t,s)},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,s)=>{const r=this.getWorkingDirectory(e.path);if(r){const i=t?void 0:this.makeLocal(e.key,e.path,e.value);r.processSetMessage(e,i,t,s)}},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,s)=>{const r=this.getWorkingDirectory(e.path);r&&r.processCreateSubDirectoryMessage(e,t,s)},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,s)=>{const r=this.getWorkingDirectory(e.path);r&&r.processDeleteSubDirectoryMessage(e,t,s)},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,s){const r=new d.x1;let i=0;const n=[],a=[],o={};for(a.push([e,o]);a.length>0;){const[e,s]=a.pop();for(const[a,o]of e.getSerializedStorage(t)){s.storage||(s.storage={});const t={type:o.type,value:o.value&&JSON.parse(o.value)};if(o.value&&o.value.length>=8192){const s={};let o=s;if(e.absolutePath!==f.sep)for(const t of e.absolutePath.substr(1).split(f.sep)){const e={};o.subdirectories={[t]:e},o=e}o.storage={[a]:t};const c=`blob${i}`;i++,n.push(c),r.addBlob(c,JSON.stringify(s))}else s.storage[a]=t}for(const[t,r]of e.subdirectories()){s.subdirectories||(s.subdirectories={});const e={};s.subdirectories[t]=e,a.push([r,e])}}const c={blobs:n,content:o};return r.addBlob(y,JSON.stringify(c)),r.getSummaryTree()}}function S(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&"edit"===e.type}function C(e){return void 0!==e&&"clear"===e.type&&"number"==typeof e.pendingMessageId&&"object"==typeof e.previousStorage}function w(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&("createSubDir"===e.type&&"boolean"==typeof e.previouslyExisted||"deleteSubDir"===e.type)}class T extends a.L{constructor(e,t,s,r){super(),this.directory=e,this.runtime=t,this.serializer=s,this.absolutePath=r,this._deleted=!1,this[i]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new o.Oi("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),null===(t=this._storage.get(e))||void 0===t?void 0:t.value}set(e,t){if(this.throwIfDisposed(),null==e)throw new Error("Undefined and null keys are not supported");const s=this.directory.localValueMaker.fromInMemory(t),r=(0,p.wA)(s,this.serializer,this.directory.handle),i=this.setCore(e,s,!0);if(!this.directory.isAttached())return this;const n={key:e,path:this.absolutePath,type:"set",value:r};return this.submitKeyMessage(n,i),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),null==e)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(f.sep))throw new Error(`SubDirectory name may not contain ${f.sep}`);const t=this.createSubDirectoryCore(e,!0),s=this._subdirectories.get(e);if(!this.directory.isAttached())return s;const r={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(r,!t),s}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return void 0!==t;const s={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(s,t),void 0!==t}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);if(!this.directory.isAttached())return void 0!==t;const s={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(s,t),void 0!==t}clear(){if(this.throwIfDisposed(),!this.directory.isAttached())return void this.clearCore(!0);const e=new Map(this._storage);this.clearCore(!0);const t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach(((t,s,r)=>{e(t.value,s,r)}))}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[(i=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,s){if(this.throwIfDisposed(),t){(0,n.h)(C(s),15);const e=this.pendingClearMessageIds.shift();(0,n.h)(e===s.pendingMessageId,810)}else this.clearExceptPendingKeys()}processDeleteMessage(e,t,s){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,s)&&this.deleteCore(e.key,t)}processSetMessage(e,t,s,r){this.throwIfDisposed(),this.needProcessStorageOperation(e,s,r)&&this.setCore(e.key,t,s)}processCreateSubDirectoryMessage(e,t,s){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,s)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,s){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,s)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const s=++this.pendingMessageId;this.pendingClearMessageIds.push(s);const r={type:"clear",pendingMessageId:s,previousStorage:t};this.directory.submitDirectoryMessage(e,r)}resubmitClearMessage(e,t){(0,n.h)(C(t),811);const s=this.pendingClearMessageIds.shift();(0,n.h)(s===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,s=this.pendingKeys.get(e.key);return void 0!==s?s.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const s={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,s)}resubmitKeyMessage(e,t){(0,n.h)(S(t),813);const s=this.pendingKeys.get(e.key);(0,n.h)(void 0!==s&&s[0]===t.pendingMessageId,814),s.shift(),0===s.length&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,s=this.pendingSubDirectories.get(e.subdirName);return void 0!==s?s.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const s={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,s)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const s={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,s)}resubmitSubDirectoryMessage(e,t){(0,n.h)(w(t),815);const s=this.pendingSubDirectories.get(e.subdirName);(0,n.h)(void 0!==s&&s[0]===t.pendingMessageId,816),s.shift(),0===s.length&&this.pendingSubDirectories.delete(e.subdirName),"createSubDir"===t.type?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,s]of this._storage){const r=[t,s.makeSerialized(e,this.directory.handle)];yield r}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,s){const r=e.get(t),i=null==r?void 0:r.pop();if(!r||i!==s)throw new Error("Rollback op does not match last pending");0===r.length&&e.delete(t)}rollback(e,t){if(void 0===(s=t)||"number"!=typeof s.pendingMessageId||!("edit"===s.type||"deleteSubDir"===s.type||"clear"===s.type&&"object"==typeof s.previousStorage||"createSubDir"===s.type&&"boolean"==typeof s.previouslyExisted))throw new Error("Invalid localOpMetadata");var s;if("clear"===e.type&&"clear"===t.type){t.previousStorage.forEach(((e,t)=>{this.setCore(t,e,!0)}));const e=this.pendingClearMessageIds.pop();if(void 0===e||e!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if("delete"!==e.type&&"set"!==e.type||"edit"!==t.type)if("createSubDirectory"===e.type&&"createSubDir"===t.type)t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else{if("deleteSubDirectory"!==e.type||"deleteSubDir"!==t.type)throw new Error("Unsupported op for rollback");void 0!==t.subDirectory&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId)}else void 0===t.previousValue?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId)}makeAbsolute(e){return f.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,s){if(this.pendingClearMessageIds.length>0)return t&&(0,n.h)(void 0!==s&&S(s)&&s.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,n.h)(void 0!==s&&S(s),17);const t=this.pendingKeys.get(e.key);(0,n.h)(void 0!==t&&t[0]===s.pendingMessageId,817),t.shift(),0===t.length&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,s){if(void 0!==this.pendingSubDirectories.get(e.subdirName)){if(t){(0,n.h)(w(s),18);const t=this.pendingSubDirectories.get(e.subdirName);(0,n.h)(void 0!==t&&t[0]===s.pendingMessageId,818),t.shift(),0===t.length&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach(((t,s,r)=>{e.set(s,this._storage.get(s))})),this.clearCore(!1),e.forEach(((e,t,s)=>{this.setCore(t,e,!0)}))}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const s=this._storage.get(e),r=null==s?void 0:s.value;if(this._storage.delete(e)){const s={key:e,path:this.absolutePath,previousValue:r};this.directory.emit("valueChanged",s,t,this.directory);const i={key:e,previousValue:r};this.emit("containedValueChanged",i,t,this)}return s}setCore(e,t,s){const r=this._storage.get(e),i=null==r?void 0:r.value;this._storage.set(e,t);const n={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",n,s,this.directory);const a={key:e,previousValue:i};return this.emit("containedValueChanged",a,s,this),r}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const s=f.join(this.absolutePath,e),r=new T(this.directory,this.runtime,this.serializer,s);return this.registerEventsOnSubDirectory(r,e),this._subdirectories.set(e,r),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",((e,s)=>{this.emit("subDirectoryCreated",f.join(t,e),s,this)})),e.on("subDirectoryDeleted",((e,s)=>{this.emit("subDirectoryDeleted",f.join(t,e),s,this)}))}deleteSubDirectoryCore(e,t){const s=this._subdirectories.get(e);return void 0!==s&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(s),this.emit("subDirectoryDeleted",e,t,this)),s}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[e,s]of t)this.disposeSubDirectoryTree(s);"function"==typeof e.dispose&&e.dispose()}undeleteSubDirectoryTree(e){for(const[e,t]of this._subdirectories.entries())this.undeleteSubDirectoryTree(t);e.undispose()}}},44725:(e,t,s)=>{"use strict";s.d(t,{oU:()=>a,wA:()=>i});var r=s(36610);function i(e,t,s){const r=e.makeSerialized(t,s);return{type:r.type,value:r.value&&JSON.parse(r.value)}}class n{constructor(e){this.value=e}get type(){return r.G[r.G.Plain]}makeSerialized(e,t){const s=function(e,t,s){return void 0!==e?t.stringify(e,s):e}(this.value,e,t);return{type:this.type,value:s}}}class a{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===r.G[r.G.Shared]){e.type=r.G[r.G.Plain];const t={type:"__fluid_handle__",url:e.value};e.value=t}const t=(s=e.value,i=this.serializer,void 0!==s?i.parse(JSON.stringify(s)):s);var s,i;return new n(t)}fromInMemory(e){return new n(e)}}},97743:(e,t,s)=>{"use strict";s.d(t,{c:()=>f,G:()=>y});var r=s(71062),i=s(52578),n=s(32361),a=s(88628),o=s(36610),c=s(44098),u=s(44725);function l(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&("add"===e.type||"edit"===e.type)}function h(e){return void 0!==e&&"clear"===e.type&&"number"==typeof e.pendingMessageId}class d{constructor(e,t,s,r,i){this.serializer=e,this.handle=t,this.submitMessage=s,this.isAttached=r,this.eventEmitter=i,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new u.oU(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach(((t,s,r)=>{e(t.value,s,r)}))}get(e){const t=this.data.get(e);return void 0===t?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(null==e)throw new Error("Undefined and null keys are not supported");const s=this.localValueMaker.fromInMemory(t),r=(0,u.wA)(s,this.serializer,this.handle),i=this.setCore(e,s,!0);if(!this.isAttached())return;const n={key:e,type:"set",value:r};this.submitMapKeyMessage(n,i)}delete(e){const t=this.deleteCore(e,!0);if(!this.isAttached())return void 0!==t;const s={key:e,type:"delete"};return this.submitMapKeyMessage(s,t),void 0!==t}clear(){const e=this.isAttached()?new Map(this.data):void 0;this.clearCore(!0),this.isAttached()&&this.submitMapClearMessage({type:"clear"},e)}getSerializedStorage(e){const t={};return this.data.forEach(((s,r)=>{t[r]=s.makeSerialized(e,this.handle)})),t}getSerializableStorage(e){const t={};return this.data.forEach(((s,r)=>{t[r]=(0,u.wA)(s,e,this.handle)})),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,s]of Object.entries(e)){const e={key:t,value:this.makeLocal(t,s)};this.data.set(e.key,e.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const s=this.messageHandlers.get(e.type);return void 0!==s&&(s.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(void 0===t)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,s){const r=this.messageHandlers.get(e.type);return void 0!==r&&(r.process(e,t,s),!0)}rollback(e,t){if(void 0===(s=t)||"number"!=typeof s.pendingMessageId||"add"!==s.type&&"edit"!==s.type&&"clear"!==s.type)throw new Error("Invalid localOpMetadata");var s;if("clear"===e.type&&"clear"===t.type){if(void 0===t.previousMap)throw new Error("Cannot rollback without previous map");t.previousMap.forEach(((e,t)=>{this.setCore(t,e,!0)}));const e=this.pendingClearMessageIds.pop();if(void 0===e||e!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else{if("delete"!==e.type&&"set"!==e.type)throw new Error("Unsupported op for rollback");{if("add"===t.type)this.deleteCore(e.key,!0);else{if("edit"!==t.type||void 0===t.previousValue)throw new Error("Cannot rollback without previous value");this.setCore(e.key,t.previousValue,!0)}const s=this.pendingKeys.get(e.key),r=null==s?void 0:s.pop();if(!s||r!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");0===s.length&&this.pendingKeys.delete(e.key)}}}setCore(e,t,s){const r=this.data.get(e),i=null==r?void 0:r.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},s,this.eventEmitter),r}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const s=this.data.get(e),r=null==s?void 0:s.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:r},t,this.eventEmitter),s}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach(((t,s)=>{e.set(s,this.data.get(s))})),this.clearCore(!1),e.forEach(((e,t)=>{this.setCore(t,e,!0)}))}makeLocal(e,t){if(t.type===o.G[o.G.Plain]||t.type===o.G[o.G.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,s){if(this.pendingClearMessageIds.length>0)return t&&(0,c.h)(void 0!==s&&l(s)&&s.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,c.h)(void 0!==s&&l(s),20);const t=this.pendingKeys.get(e.key);(0,c.h)(void 0!==t&&t[0]===s.pendingMessageId,762),t.shift(),0===t.length&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(e,t,s)=>{if(t){(0,c.h)(h(s),21);const e=this.pendingClearMessageIds.shift();(0,c.h)(e===s.pendingMessageId,763)}else 0===this.pendingKeys.size?this.clearCore(t):this.clearExceptPendingKeys()},submit:(e,t)=>{(0,c.h)(h(t),764);const s=this.pendingClearMessageIds.shift();(0,c.h)(s===t.pendingMessageId,765),this.submitMapClearMessage(e,t.previousMap)},getStashedOpLocalMetadata:e=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(e,t,s)=>{this.needProcessKeyOperation(e,t,s)&&this.deleteCore(e.key,t)},submit:(e,t)=>{this.resubmitMapKeyMessage(e,t)},getStashedOpLocalMetadata:e=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(e)})}),e.set("set",{process:(e,t,s)=>{if(!this.needProcessKeyOperation(e,t,s))return;const r=this.makeLocal(e.key,e.value);this.setCore(e.key,r,t)},submit:(e,t)=>{this.resubmitMapKeyMessage(e,t)},getStashedOpLocalMetadata:e=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(e)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const s={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,s)}getMapKeyMessageId(e){const t=++this.pendingMessageId,s=this.pendingKeys.get(e.key);return void 0!==s?s.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const s=this.getMapKeyMessageId(e),r=t?{type:"edit",pendingMessageId:s,previousValue:t}:{type:"add",pendingMessageId:s};this.submitMessage(e,r)}resubmitMapKeyMessage(e,t){(0,c.h)(l(t),766);const s=this.pendingKeys.get(e.key);(0,c.h)(void 0!==s&&s[0]===t.pendingMessageId,767),s.shift(),0===s.length&&this.pendingKeys.delete(e.key);const r=this.getMapKeyMessageId(e),i="edit"===t.type?{type:"edit",pendingMessageId:r,previousValue:t.previousValue}:{type:"add",pendingMessageId:r};this.submitMessage(e,i)}}var m,p=s(29628);const g="header";class f{get type(){return f.Type}get attributes(){return f.Attributes}async load(e,t,s,r){const i=new y(t,e,r);return await i.load(s),i}create(e,t){const s=new y(t,e,f.Attributes);return s.initializeLocal(),s}}f.Type="https://graph.microsoft.com/types/map",f.Attributes={type:f.Type,snapshotFormatVersion:"0.2",packageVersion:p.Z};class y extends n.h{constructor(e,t,s){super(e,t,s,"fluid_map_"),this[m]="SharedMap",this.kernel=new d(this.serializer,this.handle,((e,t)=>this.submitLocalMessage(e,t)),(()=>this.isAttached()),this)}static create(e,t){return e.createChannel(t,f.Type)}static getFactory(){return new f}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(m=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let s=0,r=0,i={};const n=[],o=new a.x1,c=this.kernel.getSerializedStorage(e);for(const e of Object.keys(c)){const t=c[e];if(t.value&&t.value.length>=8192){const s=`blob${r}`;r++,n.push(s);const i={[e]:{type:t.type,value:JSON.parse(t.value)}};o.addBlob(s,JSON.stringify(i))}else{if(s+=t.type.length+21,t.value&&(s+=t.value.length),s>16384){const e=`blob${r}`;r++,n.push(e),o.addBlob(e,JSON.stringify(i)),i={},s=0}i[e]={type:t.type,value:void 0===t.value?void 0:JSON.parse(t.value)}}}const u={blobs:n,content:i};return o.addBlob(g,JSON.stringify(u)),o.getSummaryTree()}async loadCore(e){const t=await(0,i.g)(e,g),s=t;Array.isArray(s.blobs)?(this.kernel.populateFromSerializable(s.content),await Promise.all(s.blobs.map((async t=>{const s=await(0,i.g)(e,t);this.kernel.populateFromSerializable(s)})))):this.kernel.populateFromSerializable(t)}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,s){e.type===r.C.Operation&&this.kernel.tryProcessMessage(e.contents,t,s)}rollback(e,t){this.kernel.rollback(e,t)}}},29628:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});const r="1.2.5"},72378:(e,t,s)=>{"use strict";s.d(t,{Qp:()=>n,VN:()=>a,eB:()=>i,sG:()=>o});var r=s(44394);function i(e,t=new Map,s=!1){const r={},i={id:e.sha,blobs:{},trees:{}};r[""]=i;for(const i of e.tree){const e=s?i.path.replace(/^\.app\//,""):i.path,n=e.lastIndexOf("/"),a=e.slice(0,Math.max(0,n)),o=e.slice(n+1),c=r[a];if("tree"===i.type){const t={id:i.sha,blobs:{},commits:{},trees:{}};c.trees[decodeURIComponent(o)]=t,r[e]=t}else{if("blob"!==i.type)throw new Error("Unknown entry type!!");c.blobs[decodeURIComponent(o)]=i.sha,t.set(i.sha,`/${e}`)}}return i}class n{constructor(e,t,s="utf-8"){this.path=e,this.mode=r.m.File,this.type=r.S.Blob,this.value={contents:t,encoding:s}}}class a{constructor(e,t){this.path=e,this.value=t,this.mode=r.m.Directory,this.type=r.S.Tree}}class o{constructor(e,t){this.path=e,this.id=t,this.mode=r.m.File,this.type=r.S.Attachment,this.value={id:t}}}},71062:(e,t,s)=>{"use strict";var r,i;s.d(t,{C:()=>r}),function(e){e.NoOp="noop",e.ClientJoin="join",e.ClientLeave="leave",e.Propose="propose",e.Reject="reject",e.Summarize="summarize",e.SummaryAck="summaryAck",e.SummaryNack="summaryNack",e.Operation="op",e.RemoteHelp="remoteHelp",e.NoClient="noClient",e.RoundTrip="tripComplete",e.Control="control"}(r||(r={})),function(e){e.ThrottlingError="ThrottlingError",e.InvalidScopeError="InvalidScopeError",e.BadRequestError="BadRequestError",e.LimitExceededError="LimitExceededError"}(i||(i={}))},44394:(e,t,s)=>{"use strict";var r,i;s.d(t,{S:()=>i,m:()=>r}),function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(r||(r={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(i||(i={}))},53039:(e,t,s)=>{"use strict";var r;s.d(t,{J:()=>r}),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(r||(r={}))},17922:(e,t)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityState=t.FlushMode=void 0,(s=t.FlushMode||(t.FlushMode={}))[s.Immediate=0]="Immediate",s[s.TurnBased=1]="TurnBased",t.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}},2029:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreFactory=void 0,t.IFluidDataStoreFactory="IFluidDataStoreFactory"},27125:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreRegistry=void 0,t.IFluidDataStoreRegistry="IFluidDataStoreRegistry"},24049:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gcBlobKey=void 0,t.gcBlobKey="gc"},92992:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),i(s(2029),t),i(s(27125),t),i(s(17922),t),i(s(24049),t),i(s(39233),t),i(s(52694),t)},39233:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},52694:(e,t)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.totalBlobSizePropertyName=t.blobCountPropertyName=t.channelsTreeName=t.CreateSummarizerNodeSource=void 0,(s=t.CreateSummarizerNodeSource||(t.CreateSummarizerNodeSource={}))[s.FromSummary=0]="FromSummary",s[s.FromAttach=1]="FromAttach",s[s.Local=2]="Local",t.channelsTreeName=".channels",t.blobCountPropertyName="BlobCount",t.totalBlobSizePropertyName="TotalBlobSize"},97495:(e,t,s)=>{"use strict";function r(e,t){if(""===e)return void 0===t?"":t.absolutePath;{let s=e.startsWith("/")?e.slice(1):e;return s=s.endsWith("/")?s.slice(0,-1):s,void 0===t?`/${s}`:`${"/"===t.absolutePath?"":t.absolutePath}/${s}`}}s.d(t,{H:()=>r})},46421:(e,t,s)=>{"use strict";s.d(t,{I4:()=>c,Nj:()=>n,Ys:()=>u,bb:()=>o,fu:()=>a});var r=s(44098),i=s(57921);function n(e){if(null!==e&&"object"==typeof e&&!0===e.errorFromRequestFluidObject){const t=e;return{mimeType:"text/plain",status:t.code,value:t.message,get stack(){return t.stack}}}const t=(0,i.FM)();return{mimeType:"text/plain",status:500,value:`${e}`,get stack(){var s;return null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:t.stack}}}function a(e,t){const s=e.value,r=(0,i.FM)();return{errorFromRequestFluidObject:!0,message:s,name:"Error",code:e.status,get stack(){var t;return null!==(t=e.stack)&&void 0!==t?t:r.stack}}}async function o(e,t){const s="string"==typeof t?{url:t}:t,i=await e.request(s);if(200!==i.status||"fluid/object"!==i.mimeType)throw a(i);return(0,r.h)(i.value,410),i.value}const c=e=>u(404,"not found",e);function u(e,t,s){var n;(0,r.h)(200!==e,411);const a=null===(n=s.url)||void 0===n?void 0:n.split("?")[0],o=(0,i.FM)();return{mimeType:"text/plain",status:e,value:void 0===a?t:`${t}: ${a}`,get stack(){return o.stack}}}},57549:(e,t,s)=>{"use strict";s.d(t,{R:()=>r});class r{constructor(e){this.request=e;const t=this.request.url.indexOf("?");this.query=t>=0?this.request.url.substring(t):""}static getPathParts(e){const t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce(((e,t)=>(void 0!==t&&t.length>0&&e.push(decodeURIComponent(t)),e)),[])}static create(e){return e instanceof r?e:new r(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return void 0===this.requestPathParts&&(this.requestPathParts=r.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return""===this.query&&this.pathParts.length===e}createSubRequest(e){const t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const s=`/${this.pathParts.slice(e).join("/")}`;return{url:""===this.query?s:`${s}/${this.query}`,headers:this.headers}}}},88628:(e,t,s)=>{"use strict";s.d(t,{x1:()=>g,TA:()=>b,Rt:()=>d,QA:()=>p,Jv:()=>m,i6:()=>h,S5:()=>y,H4:()=>v,j9:()=>f,Jz:()=>c});var r=s(19048),i=s(1362),n=s(72378),a=s(53039),o=s(44394);function c(...e){const t={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const s of e)t.treeNodeCount+=s.treeNodeCount,t.blobNodeCount+=s.blobNodeCount,t.handleNodeCount+=s.handleNodeCount,t.totalBlobSize+=s.totalBlobSize,t.unreferencedBlobSize+=s.unreferencedBlobSize;return t}function u(e){return"string"==typeof e?function(e){let t=e.length;for(let s=e.length-1;s>=0;s--){const r=e.charCodeAt(s);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&s--}return t}(e):e.byteLength}function l(e,t){switch(e.type){case a.J.Tree:t.treeNodeCount++;for(const s of Object.values(e.tree))l(s,t);return;case a.J.Handle:return void t.handleNodeCount++;case a.J.Blob:return t.blobNodeCount++,void(t.totalBlobSize+=u(e.content));default:return}}function h(e){const t=c();return l(e,t),t}function d(e,t,s){const r={type:a.J.Blob,content:s};e.summary.tree[t]=r,e.stats.blobNodeCount++,e.stats.totalBlobSize+=u(s)}function m(e,t,s){e.summary.tree[t]=s.summary,e.stats=c(e.stats,s.stats)}function p(e,t,s){e.summary.tree[t]=s.summary,e.stats=c(e.stats,s.stats)}class g{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=c(),this.summaryStats.treeNodeCount++}get summary(){return{type:a.J.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){d({summary:{type:a.J.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,s){this.summaryTree[e]={type:a.J.Handle,handleType:t,handle:s},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=c(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:a.J.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}function f(e,t=!1){if(e.id&&!t){const t=c();return t.handleNodeCount++,{summary:{handle:e.id,handleType:a.J.Tree,type:a.J.Handle},stats:t}}return function(e,t=!1){const s=new g;for(const i of e.entries)switch(i.type){case o.S.Blob:{const e=i.value;let t;t="base64"===e.encoding?r.pv.from(e.contents,"base64"):e.contents,s.addBlob(i.path,t);break}case o.S.Tree:{const e=f(i.value,t);s.addWithStats(i.path,e);break}case o.S.Attachment:{const e=i.value.id;s.addAttachment(e);break}default:throw new Error("Unexpected TreeEntry type")}const i=s.getSummaryTree();return i.summary.unreferenced=e.unreferenced,i}(e,t)}function y(e){const t=new g;for(const[i,n]of Object.entries(e.blobs)){let a;if(void 0!==e.blobsContents){const t=e.blobsContents[n];void 0!==t&&(a=(0,r.zT)(t,"utf-8"))}else void 0!==e.blobs[n]&&(s=e.blobs[n],a=r.pv.from(s,"base64").toString("utf-8"));void 0!==a&&t.addBlob(i,a)}var s;for(const[s,r]of Object.entries(e.trees)){const e=y(r);t.addWithStats(s,e)}const i=t.getSummaryTree();return i.summary.unreferenced=e.unreferenced,i}function v(e){const t=[];for(const[s,o]of Object.entries(e.tree))switch(o.type){case a.J.Blob:{let e,i="utf-8";"string"==typeof o.content?e=o.content:(e=(0,r.IN)(o.content,"base64"),i="base64"),t.push(new n.Qp(s,e,i));break}case a.J.Tree:t.push(new n.VN(s,v(o)));break;case a.J.Attachment:t.push(new n.sG(s,o.id));break;case a.J.Handle:throw new Error("Should not have Handle type in summary tree");default:(0,i.U)(o,"Unexpected summary tree type")}return{entries:t,unreferenced:e.unreferenced}}class b{constructor(){this.telemetry=new Map}set(e,t,s){this.telemetry.set(`${e}${t}`,s)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){const e={};return this.telemetry.forEach(((t,s)=>{e[s]=t})),JSON.stringify(e)}}},32361:(e,t,s)=>{"use strict";s.d(t,{h:()=>S});var r=s(50084),i=s(44098),n=s(95336),a=s(92992),o=s(42019);class c extends o.L{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(t){return this.errorHandler(e,t),!0}}}var u=s(90682),l=s(67008),h=s(97495),d=s(38756),m=s(46421);class p{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,(0,i.h)(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}async get(){if(void 0===this.objectP){const e={url:this.absolutePath,headers:{[d.lf.viaHandle]:!0}};this.objectP=this.routeContext.resolveHandle(e).then((t=>{if("fluid/object"===t.mimeType)return t.value;throw(0,m.fu)(t,e)}))}return this.objectP}attachGraph(){}bind(e){e.attachGraph()}async request(e){try{const t=(await this.get()).IFluidRouter;return void 0!==t?t.request(e):(0,m.I4)(e)}catch(e){return(0,m.Nj)(e)}}}class g{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(e,t)=>{const s=null==e?void 0:e.IFluidHandle;return void 0!==s?this.serializeHandle(s,t):e},this.decodeValue=e=>{if((e=>"__fluid_handle__"===(null==e?void 0:e.type))(e)){const t=e.url.startsWith("/")?e.url:(0,h.H)(e.url,this.context),s=new p(t,this.root);return this.handleParsedCb(s),s}return e},this.root=this.context;void 0!==this.root.routeContext;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&"object"==typeof e?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&"object"==typeof e?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,((e,s)=>this.encodeValue(s,t)))}parse(e){return JSON.parse(e,((e,t)=>this.decodeValue(t)))}recursivelyReplace(e,t,s){const r=t(e,s);if(r!==e)return r;let i;for(const r of Object.keys(e)){const n=e[r];if(n&&"object"==typeof n){const a=this.recursivelyReplace(n,t,s);a!==n&&(i=null!=i?i:Array.isArray(e)?[...e]:Object.assign({},e),i[r]=a)}}return null!=i?i:e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}var f=s(99139);class y extends f.B{get isAttached(){return this.value.isAttached()}constructor(e,t,s){super(e,t,s)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}class v extends g{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}}class b extends c{constructor(e,t,s){super(((e,t)=>this.eventListenerErrorHandler(e,t))),this.id=e,this.runtime=t,this.attributes=s,this._connected=!1,this._isBoundToContext=!1,(0,i.h)(!e.includes("/"),772),this.handle=new y(this,e,t.IFluidHandleContext),this.logger=u.G2.create(t.logger,void 0,{all:{sharedObjectId:(0,r.Z)()}}),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}closeWithError(e){void 0===this.closeError&&(this.closeError=e)}verifyNotClosed(){if(void 0!==this.closeError)throw this.closeError}eventListenerErrorHandler(e,t){const s=l.Hi.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw s.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(s),s}attachListeners(){this.isAttached()||this.runtime.once("attaching",(()=>{this.didAttach()}))}async load(e){this.runtime.attachState!==n.mB.Detached&&(this.services=e),await this.loadCore(e.objectStorage),this.runtime.attachState!==n.mB.Detached&&this.attachDeltaHandler()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return void 0!==this.services&&this.runtime.attachState!==n.mB.Detached}handleDecoded(e){var t,s,r;this.isAttached()&&(null===(r=null===(t=this.services)||void 0===t?void 0:(s=t.deltaConnection).addedGCOutboundReference)||void 0===r||r.call(s,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}async newAckBasedPromise(e){let t;return new Promise(((s,r)=>{t=()=>r(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),this.runtime.disposed?t():(this.runtime.on("dispose",t),e(s,r))})).finally((()=>{this.runtime.off("dispose",t)}))}attachDeltaHandler(){(0,i.h)(void 0!==this.services,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,s)=>{this.process(e,t,s)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,s){this.verifyNotClosed(),this.emit("pre-op",e,t,this),this.processCore(e,t,s),this.emit("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}}class S extends b{constructor(e,t,s,r){super(e,t,s),this.telemetryContextPrefix=r,this._isGCing=!1,this._serializer=new g(this.runtime.channelsRoutingContext,(e=>this.handleDecoded(e)))}get serializer(){return(0,i.h)(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,s){const r=this.summarizeCore(this.serializer,s);return this.incrementTelemetryMetric(a.blobCountPropertyName,r.stats.blobNodeCount,s),this.incrementTelemetryMetric(a.totalBlobSizePropertyName,r.stats.totalBlobSize,s),r}async summarize(e=!1,t=!1,s){const r=this.summarizeCore(this.serializer,s);return this.incrementTelemetryMetric(a.blobCountPropertyName,r.stats.blobNodeCount,s),this.incrementTelemetryMetric(a.totalBlobSizePropertyName,r.stats.totalBlobSize,s),r}getGCData(e=!1){let t;(0,i.h)(!this._isGCing,120),this._isGCing=!0;try{const e=new v(this.runtime.channelsRoutingContext,(e=>this.handleDecoded(e)));this.processGCDataCore(e),t={gcNodes:{"/":e.getSerializedRoutes()}},(0,i.h)(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,s){var r;const i=null!==(r=null==s?void 0:s.get(this.telemetryContextPrefix,e))&&void 0!==r?r:0;null==s||s.set(this.telemetryContextPrefix,e,i+t)}}},36610:(e,t,s)=>{"use strict";var r;s.d(t,{G:()=>r}),function(e){e[e.Shared=0]="Shared",e[e.Plain=1]="Plain"}(r||(r={}))},54188:(e,t,s)=>{"use strict";s.d(t,{Q:()=>r});class r{constructor(...e){this.providers=new Map,this.parents=e.filter((e=>void 0!==e))}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const s={};return this.generateRequired(s,t),this.generateOptional(s,e),Object.defineProperty(s,"IFluidDependencySynthesizer",{get:()=>this}),s}has(e,t){return!!this.providers.has(e)||!0!==t&&this.parents.some((t=>t.has(e)))}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof r)return t.getProvider(e);{const s=t;if(void 0!==(null==s?void 0:s.getProvider))return s.getProvider(e)}}}}generateRequired(e,t){if(void 0!==t)for(const s of Object.keys(t)){const t=this.resolveProvider(s);if(void 0===t)throw new Error(`Object attempted to be created without registered required provider ${s}`);Object.defineProperty(e,s,t)}}generateOptional(e,t){var s;if(void 0!==t)for(const r of Object.keys(t)){const t=null!==(s=this.resolveProvider(r))&&void 0!==s?s:{get:async()=>{}};Object.defineProperty(e,r,t)}}resolveProvider(e){const t=this.providers.get(e);if(void 0!==t)return"function"==typeof t?{get(){if(t&&"function"==typeof t)return Promise.resolve(this.IFluidDependencySynthesizer).then((async e=>t(e))).then((t=>null==t?void 0:t[e]))}}:{get(){if(t)return Promise.resolve(t).then((t=>{if(t)return t[e]}))}};for(const t of this.parents){const s={[e]:e},r=t.synthesize(s,{}),i=Object.getOwnPropertyDescriptor(r,e);if(void 0!==i)return i}}}},18977:(e,t,s)=>{"use strict";s.d(t,{MD:()=>u,UK:()=>d,rZ:()=>h,yV:()=>l});const r=new(s(7593).o)((()=>n(c()))),i={getRawConfig:()=>{}},n=e=>null!=e?new u({getRawConfig:t=>{var s,r;try{return null===(r=o(null!==(s=e.getItem(t))&&void 0!==s?s:void 0))||void 0===r?void 0:r.raw}catch(e){}}}):i;function a(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function o(e){let t,s=e;if("string"==typeof e)try{s=JSON.parse(e),t={raw:e,string:e}}catch(e){}if(void 0===s)return t;const r=typeof s;if(a(r))return Object.assign(Object.assign({},t),{raw:e,[r]:s});if(Array.isArray(s)){const r=typeof s[0];if(!a(r))return t;for(const e of s)if(typeof e!==r)return t;return Object.assign(Object.assign({},t),{raw:e,[`${r}[]`]:s})}return t}const c=()=>{try{return null!==sessionStorage?sessionStorage:void 0}catch(e){return}};class u{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set,s=[...e];for(;s.length>0;){const e=s.shift();void 0!==e&&m(e)&&!t.has(e)&&(t.add(e),e instanceof u?s.push(...e.orderedBaseProviders):this.orderedBaseProviders.push(e))}}getBoolean(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}getNumber(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}getString(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}getBooleanArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}getNumberArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}getStringArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}getRawConfig(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(const t of this.orderedBaseProviders){const s=o(null==t?void 0:t.getRawConfig(e));if(void 0!==s)return this.configCache.set(e,s),s}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function l(e){const t=e;return m(null==t?void 0:t.config)&&void 0!==(null==t?void 0:t.logger)}function h(e){return l(e)?e:d(e,r.value)}function d(e,...t){if(l(e))throw new Error("Logger is already a monitoring context");const s=e;return s.config=new u(...t),s.logger=e,s}function m(e){return"function"==typeof(null==e?void 0:e.getRawConfig)}},57921:(e,t,s)=>{"use strict";s.d(t,{FM:()=>u,Jn:()=>h,SC:()=>o,XY:()=>p,YC:()=>n,bO:()=>d,gr:()=>l,j4:()=>g,nE:()=>a});var r=s(50084),i=s(90783);function n(e,t){const s={message:"string"==typeof(null==e?void 0:e.message)?e.message:String(e)};if(null!==(r=e)&&!Array.isArray(r)&&"object"==typeof r){const{errorType:r,stack:i,name:n}=e;if("string"==typeof r&&(s.errorType=r),"string"==typeof i){const e="string"==typeof n?n:void 0;s.stack=((e,s)=>{if(!t)return e;const r=e.split("\n");return r.shift(),void 0!==s&&r.unshift(s),r.join("\n")})(i,e)}}var r;return s}const a=e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties);function o(e,t={}){var s;if((0,i.n5)(e)&&function(e){const t=e;void 0===t.errorInstanceId&&(t.errorInstanceId=(0,r.Z)())}(e),(0,i.IR)(e))return e.addTelemetryProperties(null!==(s=t.props)&&void 0!==s?s:{}),e;const{message:c,stack:u}=n(e,!1),l=new f({message:c,stack:u});if("object"==typeof e&&null!==e){const{canRetry:t,retryAfterSeconds:s}=e;Object.assign(o,{canRetry:t,retryAfterSeconds:s})}"object"!=typeof e&&l.addTelemetryProperties({typeofError:typeof e});const h=a(e)?e.getTelemetryProperties():{};return l.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},h),t.props),{untrustedOrigin:1})),l}let c;function u(){const e=new Error("<<generated stack>>");if(void 0===c&&(c=void 0!==e.stack),c)return e;try{throw e}catch(e){return e}}function l(){return u().stack}function h(e,t){const{message:s,stack:r}=n(e,!1),o=t(s);return void 0!==r&&m(o,r),p(e)&&o.addTelemetryProperties({untrustedOrigin:1}),(0,i.uD)(e)&&(o.overwriteErrorInstanceId(e.errorInstanceId),o.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),a(e)&&o.addTelemetryProperties(e.getTelemetryProperties()),o}function d(e,t,s){const r=h(e,t),i=r.errorInstanceId,n=i;return s.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:n},e),r}function m(e,t){try{Object.assign(e,{stack:t})}catch(s){e.addTelemetryProperties({stack2:t})}}function p(e){return!(0,i.n5)(e)||1===e.getTelemetryProperties().untrustedOrigin&&e.errorType===f.normalizedErrorType}class g extends Error{constructor(e,t,s=new Set){super(e),this.omitPropsFromLogging=s,this._errorInstanceId=(0,r.Z)(),this.fluidErrorCode="-",s.add("omitPropsFromLogging"),s.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){!function(e,t){for(const s of Object.keys(t))void 0===e[s]&&(e[s]=t[s])}(this,e)}getTelemetryProperties(){const e=function(e,t){const s={};for(const i of Object.keys(e)){if(t.has(i))continue;const n=e[i];switch(typeof n){case"string":case"number":case"boolean":case"undefined":s[i]=n;break;default:"object"!=typeof(null==(r=n)?void 0:r.value)&&"string"==typeof(null==r?void 0:r.tag)?s[i]=n:s[i]="REDACTED (arbitrary object)"}}var r;return s}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}class f extends g{constructor(e){super(e.message),this.errorType=f.normalizedErrorType,void 0!==e.stack&&m(this,e.stack)}}f.normalizedErrorType="genericError"},58196:(e,t,s)=>{"use strict";function r(e,t,s,r){try{s?t.emit("connected",r):t.emit("disconnected")}catch(t){e.sendErrorEvent({eventName:"RaiseConnectedEventError"},t)}}s.d(t,{Qq:()=>r})},90783:(e,t,s)=>{"use strict";s.d(t,{IR:()=>n,n5:()=>a,uD:()=>i});const r=e=>"function"==typeof(null==e?void 0:e.getTelemetryProperties)&&"function"==typeof(null==e?void 0:e.addTelemetryProperties),i=e=>"string"==typeof(null==e?void 0:e.errorInstanceId);function n(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&i(e)&&r(e)}function a(e){return"string"==typeof(null==e?void 0:e.errorType)&&"string"==typeof(null==e?void 0:e.message)&&r(e)}},90682:(e,t,s)=>{"use strict";s.d(t,{G2:()=>l,Xr:()=>h,cP:()=>u,XI:()=>i,hy:()=>c});class r{send(e){}}var i,n=s(72570),a=s(18977),o=s(57921);!function(e){e.PackageData="PackageData",e.CodeArtifact="CodeArtifact",e.UserData="UserData"}(i||(i={}));class c{constructor(e,t){this.namespace=e,this.properties=t}static formatTick(e){return Math.floor(e)}static numberFromString(e){if(null==e)return;const t=Number(e);return Number.isNaN(t)?e:t}static sanitizePkgName(e){return e.replace("@","").replace("/","-")}static prepareErrorObject(e,t,s){const{message:r,errorType:i,stack:n}=(0,o.YC)(t,!0);if(e.stack=n,e.error=r,e.errorType=i,(0,o.nE)(t)){const s=t.getTelemetryProperties();for(const t of Object.keys(s))void 0===e[t]&&(e[t]=s[t])}void 0===e.stack&&s&&(e.stack=(0,o.gr)())}sendTelemetryEvent(e,t){var s;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(s=e.category)&&void 0!==s?s:"generic"}),t)}sendTelemetryEventCore(e,t){const s=Object.assign({},e);void 0!==t&&c.prepareErrorObject(s,t,!1),"number"==typeof s.duration&&(s.duration=c.formatTick(s.duration)),this.send(s)}sendErrorEvent(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}sendPerformanceEvent(e,t){var s;const r=Object.assign(Object.assign({},e),{category:null!==(s=e.category)&&void 0!==s?s:"performance"});this.sendTelemetryEventCore(r,t)}prepareEvent(e){const t="error"===e.category||void 0!==e.error,s=Object.assign({},e);if(void 0!==this.namespace&&(s.eventName=`${this.namespace}${c.eventNamespaceSeparator}${s.eventName}`),this.properties){const r=[];r.push(this.properties.all),t&&r.push(this.properties.error);for(const t of r)if(void 0!==t)for(const r of Object.keys(t)){if(void 0!==e[r])continue;const i=t[r],n="function"==typeof i?i():i;void 0!==n&&(s[r]=n)}}return s}}c.eventNamespaceSeparator=":";class u{constructor(e){this.logger=e}send(e){const t={category:e.category,eventName:e.eventName};for(const s of Object.keys(e)){const r=e[s],{value:n,tag:a}="object"==typeof r?r:{value:r,tag:void 0};switch(a){case void 0:case i.PackageData:t[s]=n;break;case i.UserData:t[s]="REDACTED (UserData)";break;default:t[s]="REDACTED (unknown tag)"}}this.logger.send(t)}}class l extends c{constructor(e,t,s){super(t,s),this.baseLogger=e,(0,a.yV)(e)&&(0,a.UK)(this,new a.MD(e.config))}static create(e,t,s){if(e instanceof l){const r={};for(const t of[e.properties,s])void 0!==t&&(void 0!==t.all&&(r.all=Object.assign(Object.assign({},r.all),t.all)),void 0!==t.error&&(r.error=Object.assign(Object.assign({},r.error),t.error)));const i=void 0===e.namespace?t:void 0===t?e.namespace:`${e.namespace}${c.eventNamespaceSeparator}${t}`;return new l(e.baseLogger,i,r)}return new l(e||new r,t,s)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class h{constructor(e,t,s={end:!0,cancel:"generic"}){this.logger=e,this.markers=s,this.startTime=n.S.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),"object"==typeof window&&null!=window&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,s){return new h(e,t,s)}static timedExec(e,t,s,r){const i=h.start(e,t,r);try{const e=s(i);return i.autoEnd(),e}catch(e){throw i.cancel(void 0,e),e}}static async timedExecAsync(e,t,s,r){const i=h.start(e,t,r);try{const e=await s(i);return i.autoEnd(),e}catch(e){throw i.cancel(void 0,e),e}}get duration(){return n.S.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){void 0!==this.markers.cancel&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,s){if(!this.event)return;const r=Object.assign(Object.assign({},this.event),t);r.eventName=`${r.eventName}_${e}`,"start"!==e&&(r.duration=this.duration),this.logger.sendPerformanceEvent(r,s)}}},65760:(e,t,s)=>{"use strict";s.d(t,{z:()=>r});class r{constructor(e,t,s=e){this.threshold=e,this.logger=t,this.thresholdMultiple=s}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=2*this.thresholdMultiple)}}},75260:(e,t,s)=>{"use strict";s.d(t,{E:()=>Pe});var r,i,n,a=s(59939);function o(e){return e.type===i.literal}function c(e){return e.type===i.argument}function u(e){return e.type===i.number}function l(e){return e.type===i.date}function h(e){return e.type===i.time}function d(e){return e.type===i.select}function m(e){return e.type===i.plural}function p(e){return e.type===i.pound}function g(e){return e.type===i.tag}function f(e){return!(!e||"object"!=typeof e||e.type!==n.number)}function y(e){return!(!e||"object"!=typeof e||e.type!==n.dateTime)}!function(e){e[e.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",e[e.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",e[e.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",e[e.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",e[e.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",e[e.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",e[e.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",e[e.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",e[e.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",e[e.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",e[e.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",e[e.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",e[e.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",e[e.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",e[e.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",e[e.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",e[e.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",e[e.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",e[e.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",e[e.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",e[e.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",e[e.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",e[e.INVALID_TAG=23]="INVALID_TAG",e[e.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",e[e.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",e[e.UNCLOSED_TAG=27]="UNCLOSED_TAG"}(r||(r={})),function(e){e[e.literal=0]="literal",e[e.argument=1]="argument",e[e.number=2]="number",e[e.date=3]="date",e[e.time=4]="time",e[e.select=5]="select",e[e.plural=6]="plural",e[e.pound=7]="pound",e[e.tag=8]="tag"}(i||(i={})),function(e){e[e.number=0]="number",e[e.dateTime=1]="dateTime"}(n||(n={}));var v=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,b=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function S(e){var t={};return e.replace(b,(function(e){var s=e.length;switch(e[0]){case"G":t.era=4===s?"long":5===s?"narrow":"short";break;case"y":t.year=2===s?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":t.month=["numeric","2-digit","short","long","narrow"][s-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":t.day=["numeric","2-digit"][s-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":t.weekday=4===s?"short":5===s?"narrow":"short";break;case"e":if(s<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");t.weekday=["short","long","narrow","short"][s-4];break;case"c":if(s<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");t.weekday=["short","long","narrow","short"][s-4];break;case"a":t.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":t.hourCycle="h12",t.hour=["numeric","2-digit"][s-1];break;case"H":t.hourCycle="h23",t.hour=["numeric","2-digit"][s-1];break;case"K":t.hourCycle="h11",t.hour=["numeric","2-digit"][s-1];break;case"k":t.hourCycle="h24",t.hour=["numeric","2-digit"][s-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":t.minute=["numeric","2-digit"][s-1];break;case"s":t.second=["numeric","2-digit"][s-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":t.timeZoneName=s<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""})),t}var C,w=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i,T=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,N=/^(@+)?(\+|#+)?[rs]?$/g,P=/(\*)(0+)|(#+)(0+)|(0+)/g,E=/^(0+)$/;function D(e){var t={};return"r"===e[e.length-1]?t.roundingPriority="morePrecision":"s"===e[e.length-1]&&(t.roundingPriority="lessPrecision"),e.replace(N,(function(e,s,r){return"string"!=typeof r?(t.minimumSignificantDigits=s.length,t.maximumSignificantDigits=s.length):"+"===r?t.minimumSignificantDigits=s.length:"#"===s[0]?t.maximumSignificantDigits=s.length:(t.minimumSignificantDigits=s.length,t.maximumSignificantDigits=s.length+("string"==typeof r?r.length:0)),""})),t}function O(e){switch(e){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function k(e){var t;if("E"===e[0]&&"E"===e[1]?(t={notation:"engineering"},e=e.slice(2)):"E"===e[0]&&(t={notation:"scientific"},e=e.slice(1)),t){var s=e.slice(0,2);if("+!"===s?(t.signDisplay="always",e=e.slice(2)):"+?"===s&&(t.signDisplay="exceptZero",e=e.slice(2)),!E.test(e))throw new Error("Malformed concise eng/scientific notation");t.minimumIntegerDigits=e.length}return t}function _(e){return O(e)||{}}function A(e){for(var t={},s=0,r=e;s<r.length;s++){var i=r[s];switch(i.stem){case"percent":case"%":t.style="percent";continue;case"%x100":t.style="percent",t.scale=100;continue;case"currency":t.style="currency",t.currency=i.options[0];continue;case"group-off":case",_":t.useGrouping=!1;continue;case"precision-integer":case".":t.maximumFractionDigits=0;continue;case"measure-unit":case"unit":t.style="unit",t.unit=i.options[0].replace(/^(.*?)-/,"");continue;case"compact-short":case"K":t.notation="compact",t.compactDisplay="short";continue;case"compact-long":case"KK":t.notation="compact",t.compactDisplay="long";continue;case"scientific":t=(0,a.__assign)((0,a.__assign)((0,a.__assign)({},t),{notation:"scientific"}),i.options.reduce((function(e,t){return(0,a.__assign)((0,a.__assign)({},e),_(t))}),{}));continue;case"engineering":t=(0,a.__assign)((0,a.__assign)((0,a.__assign)({},t),{notation:"engineering"}),i.options.reduce((function(e,t){return(0,a.__assign)((0,a.__assign)({},e),_(t))}),{}));continue;case"notation-simple":t.notation="standard";continue;case"unit-width-narrow":t.currencyDisplay="narrowSymbol",t.unitDisplay="narrow";continue;case"unit-width-short":t.currencyDisplay="code",t.unitDisplay="short";continue;case"unit-width-full-name":t.currencyDisplay="name",t.unitDisplay="long";continue;case"unit-width-iso-code":t.currencyDisplay="symbol";continue;case"scale":t.scale=parseFloat(i.options[0]);continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(P,(function(e,s,r,i,n,a){if(s)t.minimumIntegerDigits=r.length;else{if(i&&n)throw new Error("We currently do not support maximum integer digits");if(a)throw new Error("We currently do not support exact integer digits")}return""}));continue}if(E.test(i.stem))t.minimumIntegerDigits=i.stem.length;else if(T.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(T,(function(e,s,r,i,n,a){return"*"===r?t.minimumFractionDigits=s.length:i&&"#"===i[0]?t.maximumFractionDigits=i.length:n&&a?(t.minimumFractionDigits=n.length,t.maximumFractionDigits=n.length+a.length):(t.minimumFractionDigits=s.length,t.maximumFractionDigits=s.length),""}));var n=i.options[0];"w"===n?t=(0,a.__assign)((0,a.__assign)({},t),{trailingZeroDisplay:"stripIfInteger"}):n&&(t=(0,a.__assign)((0,a.__assign)({},t),D(n)))}else if(N.test(i.stem))t=(0,a.__assign)((0,a.__assign)({},t),D(i.stem));else{var o=O(i.stem);o&&(t=(0,a.__assign)((0,a.__assign)({},t),o));var c=k(i.stem);c&&(t=(0,a.__assign)((0,a.__assign)({},t),c))}}return t}var I=new RegExp("^".concat(v.source,"*")),M=new RegExp("".concat(v.source,"*$"));function R(e,t){return{start:e,end:t}}var F=!!String.prototype.startsWith,x=!!String.fromCodePoint,L=!!Object.fromEntries,z=!!String.prototype.codePointAt,j=!!String.prototype.trimStart,B=!!String.prototype.trimEnd,q=Number.isSafeInteger?Number.isSafeInteger:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e&&Math.abs(e)<=9007199254740991},G=!0;try{G="a"===(null===(C=K("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu").exec("a"))||void 0===C?void 0:C[0])}catch(e){G=!1}var U,V=F?function(e,t,s){return e.startsWith(t,s)}:function(e,t,s){return e.slice(s,s+t.length)===t},H=x?String.fromCodePoint:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var s,r="",i=e.length,n=0;i>n;){if((s=e[n++])>1114111)throw RangeError(s+" is not a valid code point");r+=s<65536?String.fromCharCode(s):String.fromCharCode(55296+((s-=65536)>>10),s%1024+56320)}return r},X=L?Object.fromEntries:function(e){for(var t={},s=0,r=e;s<r.length;s++){var i=r[s],n=i[0],a=i[1];t[n]=a}return t},$=z?function(e,t){return e.codePointAt(t)}:function(e,t){var s=e.length;if(!(t<0||t>=s)){var r,i=e.charCodeAt(t);return i<55296||i>56319||t+1===s||(r=e.charCodeAt(t+1))<56320||r>57343?i:r-56320+(i-55296<<10)+65536}},W=j?function(e){return e.trimStart()}:function(e){return e.replace(I,"")},J=B?function(e){return e.trimEnd()}:function(e){return e.replace(M,"")};function K(e,t){return new RegExp(e,t)}if(G){var Q=K("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");U=function(e,t){var s;return Q.lastIndex=t,null!==(s=Q.exec(e)[1])&&void 0!==s?s:""}}else U=function(e,t){for(var s=[];;){var r=$(e,t);if(void 0===r||ee(r)||te(r))break;s.push(r),t+=r>=65536?2:1}return H.apply(void 0,s)};var Z=function(){function e(e,t){void 0===t&&(t={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!t.ignoreTag,this.requiresOtherClause=!!t.requiresOtherClause,this.shouldParseSkeletons=!!t.shouldParseSkeletons}return e.prototype.parse=function(){if(0!==this.offset())throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},e.prototype.parseMessage=function(e,t,s){for(var n=[];!this.isEOF();){var a=this.char();if(123===a){if((o=this.parseArgument(e,s)).err)return o;n.push(o.val)}else{if(125===a&&e>0)break;if(35!==a||"plural"!==t&&"selectordinal"!==t){if(60===a&&!this.ignoreTag&&47===this.peek()){if(s)break;return this.error(r.UNMATCHED_CLOSING_TAG,R(this.clonePosition(),this.clonePosition()))}if(60===a&&!this.ignoreTag&&Y(this.peek()||0)){if((o=this.parseTag(e,t)).err)return o;n.push(o.val)}else{var o;if((o=this.parseLiteral(e,t)).err)return o;n.push(o.val)}}else{var c=this.clonePosition();this.bump(),n.push({type:i.pound,location:R(c,this.clonePosition())})}}}return{val:n,err:null}},e.prototype.parseTag=function(e,t){var s=this.clonePosition();this.bump();var n=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:i.literal,value:"<".concat(n,"/>"),location:R(s,this.clonePosition())},err:null};if(this.bumpIf(">")){var a=this.parseMessage(e+1,t,!0);if(a.err)return a;var o=a.val,c=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!Y(this.char()))return this.error(r.INVALID_TAG,R(c,this.clonePosition()));var u=this.clonePosition();return n!==this.parseTagName()?this.error(r.UNMATCHED_CLOSING_TAG,R(u,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:i.tag,value:n,children:o,location:R(s,this.clonePosition())},err:null}:this.error(r.INVALID_TAG,R(c,this.clonePosition())))}return this.error(r.UNCLOSED_TAG,R(s,this.clonePosition()))}return this.error(r.INVALID_TAG,R(s,this.clonePosition()))},e.prototype.parseTagName=function(){var e,t=this.offset();for(this.bump();!this.isEOF()&&(45===(e=this.char())||46===e||e>=48&&e<=57||95===e||e>=97&&e<=122||e>=65&&e<=90||183==e||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8255&&e<=8256||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039);)this.bump();return this.message.slice(t,this.offset())},e.prototype.parseLiteral=function(e,t){for(var s=this.clonePosition(),r="";;){var n=this.tryParseQuote(t);if(n)r+=n;else{var a=this.tryParseUnquoted(e,t);if(a)r+=a;else{var o=this.tryParseLeftAngleBracket();if(!o)break;r+=o}}}var c=R(s,this.clonePosition());return{val:{type:i.literal,value:r,location:c},err:null}},e.prototype.tryParseLeftAngleBracket=function(){return this.isEOF()||60!==this.char()||!this.ignoreTag&&(Y(e=this.peek()||0)||47===e)?null:(this.bump(),"<");var e},e.prototype.tryParseQuote=function(e){if(this.isEOF()||39!==this.char())return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if("plural"===e||"selectordinal"===e)break;return null;default:return null}this.bump();var t=[this.char()];for(this.bump();!this.isEOF();){var s=this.char();if(39===s){if(39!==this.peek()){this.bump();break}t.push(39),this.bump()}else t.push(s);this.bump()}return H.apply(void 0,t)},e.prototype.tryParseUnquoted=function(e,t){if(this.isEOF())return null;var s=this.char();return 60===s||123===s||35===s&&("plural"===t||"selectordinal"===t)||125===s&&e>0?null:(this.bump(),H(s))},e.prototype.parseArgument=function(e,t){var s=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(r.EXPECT_ARGUMENT_CLOSING_BRACE,R(s,this.clonePosition()));if(125===this.char())return this.bump(),this.error(r.EMPTY_ARGUMENT,R(s,this.clonePosition()));var n=this.parseIdentifierIfPossible().value;if(!n)return this.error(r.MALFORMED_ARGUMENT,R(s,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(r.EXPECT_ARGUMENT_CLOSING_BRACE,R(s,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:i.argument,value:n,location:R(s,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(r.EXPECT_ARGUMENT_CLOSING_BRACE,R(s,this.clonePosition())):this.parseArgumentOptions(e,t,n,s);default:return this.error(r.MALFORMED_ARGUMENT,R(s,this.clonePosition()))}},e.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),t=this.offset(),s=U(this.message,t),r=t+s.length;return this.bumpTo(r),{value:s,location:R(e,this.clonePosition())}},e.prototype.parseArgumentOptions=function(e,t,s,o){var c,u=this.clonePosition(),l=this.parseIdentifierIfPossible().value,h=this.clonePosition();switch(l){case"":return this.error(r.EXPECT_ARGUMENT_TYPE,R(u,h));case"number":case"date":case"time":this.bumpSpace();var d=null;if(this.bumpIf(",")){this.bumpSpace();var m=this.clonePosition();if((C=this.parseSimpleArgStyleIfPossible()).err)return C;if(0===(f=J(C.val)).length)return this.error(r.EXPECT_ARGUMENT_STYLE,R(this.clonePosition(),this.clonePosition()));d={style:f,styleLocation:R(m,this.clonePosition())}}if((w=this.tryParseArgumentClose(o)).err)return w;var p=R(o,this.clonePosition());if(d&&V(null==d?void 0:d.style,"::",0)){var g=W(d.style.slice(2));if("number"===l)return(C=this.parseNumberSkeletonFromString(g,d.styleLocation)).err?C:{val:{type:i.number,value:s,location:p,style:C.val},err:null};if(0===g.length)return this.error(r.EXPECT_DATE_TIME_SKELETON,p);var f={type:n.dateTime,pattern:g,location:d.styleLocation,parsedOptions:this.shouldParseSkeletons?S(g):{}};return{val:{type:"date"===l?i.date:i.time,value:s,location:p,style:f},err:null}}return{val:{type:"number"===l?i.number:"date"===l?i.date:i.time,value:s,location:p,style:null!==(c=null==d?void 0:d.style)&&void 0!==c?c:null},err:null};case"plural":case"selectordinal":case"select":var y=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(r.EXPECT_SELECT_ARGUMENT_OPTIONS,R(y,(0,a.__assign)({},y)));this.bumpSpace();var v=this.parseIdentifierIfPossible(),b=0;if("select"!==l&&"offset"===v.value){if(!this.bumpIf(":"))return this.error(r.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,R(this.clonePosition(),this.clonePosition()));var C;if(this.bumpSpace(),(C=this.tryParseDecimalInteger(r.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,r.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE)).err)return C;this.bumpSpace(),v=this.parseIdentifierIfPossible(),b=C.val}var w,T=this.tryParsePluralOrSelectOptions(e,l,t,v);if(T.err)return T;if((w=this.tryParseArgumentClose(o)).err)return w;var N=R(o,this.clonePosition());return"select"===l?{val:{type:i.select,value:s,options:X(T.val),location:N},err:null}:{val:{type:i.plural,value:s,options:X(T.val),offset:b,pluralType:"plural"===l?"cardinal":"ordinal",location:N},err:null};default:return this.error(r.INVALID_ARGUMENT_TYPE,R(u,h))}},e.prototype.tryParseArgumentClose=function(e){return this.isEOF()||125!==this.char()?this.error(r.EXPECT_ARGUMENT_CLOSING_BRACE,R(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},e.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,t=this.clonePosition();!this.isEOF();)switch(this.char()){case 39:this.bump();var s=this.clonePosition();if(!this.bumpUntil("'"))return this.error(r.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,R(s,this.clonePosition()));this.bump();break;case 123:e+=1,this.bump();break;case 125:if(!(e>0))return{val:this.message.slice(t.offset,this.offset()),err:null};e-=1;break;default:this.bump()}return{val:this.message.slice(t.offset,this.offset()),err:null}},e.prototype.parseNumberSkeletonFromString=function(e,t){var s=[];try{s=function(e){if(0===e.length)throw new Error("Number skeleton cannot be empty");for(var t=[],s=0,r=e.split(w).filter((function(e){return e.length>0}));s<r.length;s++){var i=r[s].split("/");if(0===i.length)throw new Error("Invalid number skeleton");for(var n=i[0],a=i.slice(1),o=0,c=a;o<c.length;o++)if(0===c[o].length)throw new Error("Invalid number skeleton");t.push({stem:n,options:a})}return t}(e)}catch(e){return this.error(r.INVALID_NUMBER_SKELETON,t)}return{val:{type:n.number,tokens:s,location:t,parsedOptions:this.shouldParseSkeletons?A(s):{}},err:null}},e.prototype.tryParsePluralOrSelectOptions=function(e,t,s,i){for(var n,a=!1,o=[],c=new Set,u=i.value,l=i.location;;){if(0===u.length){var h=this.clonePosition();if("select"===t||!this.bumpIf("="))break;var d=this.tryParseDecimalInteger(r.EXPECT_PLURAL_ARGUMENT_SELECTOR,r.INVALID_PLURAL_ARGUMENT_SELECTOR);if(d.err)return d;l=R(h,this.clonePosition()),u=this.message.slice(h.offset,this.offset())}if(c.has(u))return this.error("select"===t?r.DUPLICATE_SELECT_ARGUMENT_SELECTOR:r.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,l);"other"===u&&(a=!0),this.bumpSpace();var m=this.clonePosition();if(!this.bumpIf("{"))return this.error("select"===t?r.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:r.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,R(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,t,s);if(p.err)return p;var g=this.tryParseArgumentClose(m);if(g.err)return g;o.push([u,{value:p.val,location:R(m,this.clonePosition())}]),c.add(u),this.bumpSpace(),u=(n=this.parseIdentifierIfPossible()).value,l=n.location}return 0===o.length?this.error("select"===t?r.EXPECT_SELECT_ARGUMENT_SELECTOR:r.EXPECT_PLURAL_ARGUMENT_SELECTOR,R(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!a?this.error(r.MISSING_OTHER_CLAUSE,R(this.clonePosition(),this.clonePosition())):{val:o,err:null}},e.prototype.tryParseDecimalInteger=function(e,t){var s=1,r=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(s=-1);for(var i=!1,n=0;!this.isEOF();){var a=this.char();if(!(a>=48&&a<=57))break;i=!0,n=10*n+(a-48),this.bump()}var o=R(r,this.clonePosition());return i?q(n*=s)?{val:n,err:null}:this.error(t,o):this.error(e,o)},e.prototype.offset=function(){return this.position.offset},e.prototype.isEOF=function(){return this.offset()===this.message.length},e.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},e.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var t=$(this.message,e);if(void 0===t)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return t},e.prototype.error=function(e,t){return{val:null,err:{kind:e,message:this.message,location:t}}},e.prototype.bump=function(){if(!this.isEOF()){var e=this.char();10===e?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},e.prototype.bumpIf=function(e){if(V(this.message,e,this.offset())){for(var t=0;t<e.length;t++)this.bump();return!0}return!1},e.prototype.bumpUntil=function(e){var t=this.offset(),s=this.message.indexOf(e,t);return s>=0?(this.bumpTo(s),!0):(this.bumpTo(this.message.length),!1)},e.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var t=this.offset();if(t===e)break;if(t>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},e.prototype.bumpSpace=function(){for(;!this.isEOF()&&ee(this.char());)this.bump()},e.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),t=this.offset(),s=this.message.charCodeAt(t+(e>=65536?2:1));return null!=s?s:null},e}();function Y(e){return e>=97&&e<=122||e>=65&&e<=90}function ee(e){return e>=9&&e<=13||32===e||133===e||e>=8206&&e<=8207||8232===e||8233===e}function te(e){return e>=33&&e<=35||36===e||e>=37&&e<=39||40===e||41===e||42===e||43===e||44===e||45===e||e>=46&&e<=47||e>=58&&e<=59||e>=60&&e<=62||e>=63&&e<=64||91===e||92===e||93===e||94===e||96===e||123===e||124===e||125===e||126===e||161===e||e>=162&&e<=165||166===e||167===e||169===e||171===e||172===e||174===e||176===e||177===e||182===e||187===e||191===e||215===e||247===e||e>=8208&&e<=8213||e>=8214&&e<=8215||8216===e||8217===e||8218===e||e>=8219&&e<=8220||8221===e||8222===e||8223===e||e>=8224&&e<=8231||e>=8240&&e<=8248||8249===e||8250===e||e>=8251&&e<=8254||e>=8257&&e<=8259||8260===e||8261===e||8262===e||e>=8263&&e<=8273||8274===e||8275===e||e>=8277&&e<=8286||e>=8592&&e<=8596||e>=8597&&e<=8601||e>=8602&&e<=8603||e>=8604&&e<=8607||8608===e||e>=8609&&e<=8610||8611===e||e>=8612&&e<=8613||8614===e||e>=8615&&e<=8621||8622===e||e>=8623&&e<=8653||e>=8654&&e<=8655||e>=8656&&e<=8657||8658===e||8659===e||8660===e||e>=8661&&e<=8691||e>=8692&&e<=8959||e>=8960&&e<=8967||8968===e||8969===e||8970===e||8971===e||e>=8972&&e<=8991||e>=8992&&e<=8993||e>=8994&&e<=9e3||9001===e||9002===e||e>=9003&&e<=9083||9084===e||e>=9085&&e<=9114||e>=9115&&e<=9139||e>=9140&&e<=9179||e>=9180&&e<=9185||e>=9186&&e<=9254||e>=9255&&e<=9279||e>=9280&&e<=9290||e>=9291&&e<=9311||e>=9472&&e<=9654||9655===e||e>=9656&&e<=9664||9665===e||e>=9666&&e<=9719||e>=9720&&e<=9727||e>=9728&&e<=9838||9839===e||e>=9840&&e<=10087||10088===e||10089===e||10090===e||10091===e||10092===e||10093===e||10094===e||10095===e||10096===e||10097===e||10098===e||10099===e||10100===e||10101===e||e>=10132&&e<=10175||e>=10176&&e<=10180||10181===e||10182===e||e>=10183&&e<=10213||10214===e||10215===e||10216===e||10217===e||10218===e||10219===e||10220===e||10221===e||10222===e||10223===e||e>=10224&&e<=10239||e>=10240&&e<=10495||e>=10496&&e<=10626||10627===e||10628===e||10629===e||10630===e||10631===e||10632===e||10633===e||10634===e||10635===e||10636===e||10637===e||10638===e||10639===e||10640===e||10641===e||10642===e||10643===e||10644===e||10645===e||10646===e||10647===e||10648===e||e>=10649&&e<=10711||10712===e||10713===e||10714===e||10715===e||e>=10716&&e<=10747||10748===e||10749===e||e>=10750&&e<=11007||e>=11008&&e<=11055||e>=11056&&e<=11076||e>=11077&&e<=11078||e>=11079&&e<=11084||e>=11085&&e<=11123||e>=11124&&e<=11125||e>=11126&&e<=11157||11158===e||e>=11159&&e<=11263||e>=11776&&e<=11777||11778===e||11779===e||11780===e||11781===e||e>=11782&&e<=11784||11785===e||11786===e||11787===e||11788===e||11789===e||e>=11790&&e<=11798||11799===e||e>=11800&&e<=11801||11802===e||11803===e||11804===e||11805===e||e>=11806&&e<=11807||11808===e||11809===e||11810===e||11811===e||11812===e||11813===e||11814===e||11815===e||11816===e||11817===e||e>=11818&&e<=11822||11823===e||e>=11824&&e<=11833||e>=11834&&e<=11835||e>=11836&&e<=11839||11840===e||11841===e||11842===e||e>=11843&&e<=11855||e>=11856&&e<=11857||11858===e||e>=11859&&e<=11903||e>=12289&&e<=12291||12296===e||12297===e||12298===e||12299===e||12300===e||12301===e||12302===e||12303===e||12304===e||12305===e||e>=12306&&e<=12307||12308===e||12309===e||12310===e||12311===e||12312===e||12313===e||12314===e||12315===e||12316===e||12317===e||e>=12318&&e<=12319||12320===e||12336===e||64830===e||64831===e||e>=65093&&e<=65094}function se(e){e.forEach((function(e){if(delete e.location,d(e)||m(e))for(var t in e.options)delete e.options[t].location,se(e.options[t].value);else u(e)&&f(e.style)||(l(e)||h(e))&&y(e.style)?delete e.style.location:g(e)&&se(e.children)}))}function re(e,t){void 0===t&&(t={}),t=(0,a.__assign)({shouldParseSkeletons:!0,requiresOtherClause:!0},t);var s=new Z(e,t).parse();if(s.err){var i=SyntaxError(r[s.err.kind]);throw i.location=s.err.location,i.originalMessage=s.err.message,i}return(null==t?void 0:t.captureLocation)||se(s.val),s.val}function ie(e,t){var s=t&&t.cache?t.cache:de,r=t&&t.serializer?t.serializer:ue;return(t&&t.strategy?t.strategy:ce)(e,{cache:s,serializer:r})}function ne(e,t,s,r){var i,n=null==(i=r)||"number"==typeof i||"boolean"==typeof i?r:s(r),a=t.get(n);return void 0===a&&(a=e.call(this,r),t.set(n,a)),a}function ae(e,t,s){var r=Array.prototype.slice.call(arguments,3),i=s(r),n=t.get(i);return void 0===n&&(n=e.apply(this,r),t.set(i,n)),n}function oe(e,t,s,r,i){return s.bind(t,e,r,i)}function ce(e,t){return oe(e,this,1===e.length?ne:ae,t.cache.create(),t.serializer)}var ue=function(){return JSON.stringify(arguments)};function le(){this.cache=Object.create(null)}le.prototype.get=function(e){return this.cache[e]},le.prototype.set=function(e,t){this.cache[e]=t};var he,de={create:function(){return new le}},me={variadic:function(e,t){return oe(e,this,ae,t.cache.create(),t.serializer)},monadic:function(e,t){return oe(e,this,ne,t.cache.create(),t.serializer)}};!function(e){e.MISSING_VALUE="MISSING_VALUE",e.INVALID_VALUE="INVALID_VALUE",e.MISSING_INTL_API="MISSING_INTL_API"}(he||(he={}));var pe,ge=function(e){function t(t,s,r){var i=e.call(this,t)||this;return i.code=s,i.originalMessage=r,i}return(0,a.__extends)(t,e),t.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},t}(Error),fe=function(e){function t(t,s,r,i){return e.call(this,'Invalid values for "'.concat(t,'": "').concat(s,'". Options are "').concat(Object.keys(r).join('", "'),'"'),he.INVALID_VALUE,i)||this}return(0,a.__extends)(t,e),t}(ge),ye=function(e){function t(t,s,r){return e.call(this,'Value for "'.concat(t,'" must be of type ').concat(s),he.INVALID_VALUE,r)||this}return(0,a.__extends)(t,e),t}(ge),ve=function(e){function t(t,s){return e.call(this,'The intl string context variable "'.concat(t,'" was not provided to the string "').concat(s,'"'),he.MISSING_VALUE,s)||this}return(0,a.__extends)(t,e),t}(ge);function be(e){return"function"==typeof e}function Se(e,t,s,r,i,n,a){if(1===e.length&&o(e[0]))return[{type:pe.literal,value:e[0].value}];for(var v=[],b=0,S=e;b<S.length;b++){var C=S[b];if(o(C))v.push({type:pe.literal,value:C.value});else if(p(C))"number"==typeof n&&v.push({type:pe.literal,value:s.getNumberFormat(t).format(n)});else{var w=C.value;if(!i||!(w in i))throw new ve(w,a);var T=i[w];if(c(C))T&&"string"!=typeof T&&"number"!=typeof T||(T="string"==typeof T||"number"==typeof T?String(T):""),v.push({type:"string"==typeof T?pe.literal:pe.object,value:T});else if(l(C)){var N="string"==typeof C.style?r.date[C.style]:y(C.style)?C.style.parsedOptions:void 0;v.push({type:pe.literal,value:s.getDateTimeFormat(t,N).format(T)})}else if(h(C))N="string"==typeof C.style?r.time[C.style]:y(C.style)?C.style.parsedOptions:void 0,v.push({type:pe.literal,value:s.getDateTimeFormat(t,N).format(T)});else if(u(C))(N="string"==typeof C.style?r.number[C.style]:f(C.style)?C.style.parsedOptions:void 0)&&N.scale&&(T*=N.scale||1),v.push({type:pe.literal,value:s.getNumberFormat(t,N).format(T)});else{if(g(C)){var P=C.children,E=C.value,D=i[E];if(!be(D))throw new ye(E,"function",a);var O=D(Se(P,t,s,r,i,n).map((function(e){return e.value})));Array.isArray(O)||(O=[O]),v.push.apply(v,O.map((function(e){return{type:"string"==typeof e?pe.literal:pe.object,value:e}})))}if(d(C)){if(!(k=C.options[T]||C.options.other))throw new fe(C.value,T,Object.keys(C.options),a);v.push.apply(v,Se(k.value,t,s,r,i))}else if(m(C)){var k;if(!(k=C.options["=".concat(T)])){if(!Intl.PluralRules)throw new ge('Intl.PluralRules is not available in this environment.\nTry polyfilling it using "@formatjs/intl-pluralrules"\n',he.MISSING_INTL_API,a);var _=s.getPluralRules(t,{type:C.pluralType}).select(T-(C.offset||0));k=C.options[_]||C.options.other}if(!k)throw new fe(C.value,T,Object.keys(C.options),a);v.push.apply(v,Se(k.value,t,s,r,i,T-(C.offset||0)))}}}}return(A=v).length<2?A:A.reduce((function(e,t){var s=e[e.length-1];return s&&s.type===pe.literal&&t.type===pe.literal?s.value+=t.value:e.push(t),e}),[]);var A}function Ce(e){return{create:function(){return{get:function(t){return e[t]},set:function(t,s){e[t]=s}}}}}!function(e){e[e.literal=0]="literal",e[e.object=1]="object"}(pe||(pe={}));var we=function(){function e(t,s,r,i){var n,o,c,u=this;if(void 0===s&&(s=e.defaultLocale),this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(e){var t=u.formatToParts(e);if(1===t.length)return t[0].value;var s=t.reduce((function(e,t){return e.length&&t.type===pe.literal&&"string"==typeof e[e.length-1]?e[e.length-1]+=t.value:e.push(t.value),e}),[]);return s.length<=1?s[0]||"":s},this.formatToParts=function(e){return Se(u.ast,u.locales,u.formatters,u.formats,e,void 0,u.message)},this.resolvedOptions=function(){return{locale:Intl.NumberFormat.supportedLocalesOf(u.locales)[0]}},this.getAst=function(){return u.ast},"string"==typeof t){if(this.message=t,!e.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");this.ast=e.__parse(t,{ignoreTag:null==i?void 0:i.ignoreTag})}else this.ast=t;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=(o=e.formats,(c=r)?Object.keys(o).reduce((function(e,t){var s,r;return e[t]=(s=o[t],(r=c[t])?(0,a.__assign)((0,a.__assign)((0,a.__assign)({},s||{}),r||{}),Object.keys(s).reduce((function(e,t){return e[t]=(0,a.__assign)((0,a.__assign)({},s[t]),r[t]||{}),e}),{})):s),e}),(0,a.__assign)({},o)):o),this.locales=s,this.formatters=i&&i.formatters||(void 0===(n=this.formatterCache)&&(n={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:ie((function(){for(var e,t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return new((e=Intl.NumberFormat).bind.apply(e,(0,a.__spreadArray)([void 0],t,!1)))}),{cache:Ce(n.number),strategy:me.variadic}),getDateTimeFormat:ie((function(){for(var e,t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return new((e=Intl.DateTimeFormat).bind.apply(e,(0,a.__spreadArray)([void 0],t,!1)))}),{cache:Ce(n.dateTime),strategy:me.variadic}),getPluralRules:ie((function(){for(var e,t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];return new((e=Intl.PluralRules).bind.apply(e,(0,a.__spreadArray)([void 0],t,!1)))}),{cache:Ce(n.pluralRules),strategy:me.variadic})})}return Object.defineProperty(e,"defaultLocale",{get:function(){return e.memoizedDefaultLocale||(e.memoizedDefaultLocale=(new Intl.NumberFormat).resolvedOptions().locale),e.memoizedDefaultLocale},enumerable:!1,configurable:!0}),e.memoizedDefaultLocale=null,e.__parse=re,e.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},e}();const Te=new Map,Ne={getNumberFormat:ie(((e,t)=>new Intl.NumberFormat(e,t))),getDateTimeFormat:ie(((e,t)=>new Intl.DateTimeFormat(e,t))),getPluralRules:ie(((e,t)=>new Intl.PluralRules(e,t)))};function Pe(e,t,s=!0){const r=Object.entries(e.strings),i={};return r.forEach((([e,r])=>{i[e]=function(e,t,s){switch(e.f){case 0:return e.s;case 1:return r=>{const{s:i}=e;if(s){const e=`${i}_${t}`;let s=Te.get(e);return s||(s=re(i),Te.set(e,s)),new we(s,t,void 0,{formatters:Ne}).format(r)}return new we(i,t,void 0,{formatters:Ne}).format(r)}}}(r,t,s)})),i}},40900:(e,t,s)=>{"use strict";s.d(t,{Vw:()=>h,cS:()=>c,cl:()=>p,gV:()=>d,n5:()=>u,oe:()=>l,z_:()=>m});var r=s(46630);function i(e,t){return e?e+"."+t:t}function n(e,t,s,n){s&&n.push((0,r.dt)("".concat(i(e,t)),s))}function a(e,t,s,n){"boolean"==typeof s&&n.push((0,r.UL)("".concat(i(e,t)),s))}function o(e,t,s,n){"number"==typeof s&&n.push((0,r.Kq)("".concat(i(e,t)),s))}var c={contractName:"Office.System.Activity",getFields:function(e){var t="Activity",s=[];return n(t,"CV",e.cV,s),o(t,"Duration",e.duration,s),o(t,"Count",e.count,s),o(t,"AggMode",e.aggMode,s),a(t,"Success",e.success,s),e.result&&s.push.apply(s,function(e){var t="Activity.Result",s=[];return o(t,"Code",e.code,s),n(t,"Type",e.type,s),o(t,"Tag",e.tag,s),a(t,"IsExpected",e.isExpected,s),s.push((0,r.dt)("zC.Activity.Result","Office.System.Result")),s}(e.result)),s.push((0,r.dt)("zC.Activity",this.contractName)),s}},u={getFields:function(e){var t="User",s=[];return n(t,"PrimaryIdentityHash",e.primaryIdentityHash,s),n(t,"PrimaryIdentitySpace",e.primaryIdentitySpace,s),n(t,"TenantId",e.tenantId,s),n(t,"TenantGroup",e.tenantGroup,s),a(t,"IsAnonymous",e.isAnonymous,s),s}},l={getFields:function(e,t){var s=[];return n(e,"Name",t.name,s),n(e,"State",t.state,s),s}},h={getFields:function(e){var t="UserAction",s=[];return o(t,"Id",e.id,s),n(t,"Name",e.name,s),n(t,"CommandSurface",e.commandSurface,s),n(t,"ParentName",e.parentName,s),n(t,"TriggerMethod",e.triggerMethod,s),o(t,"TimeOffsetMs",e.timeOffsetMs,s),s}},d={getFields:function(e){var t="App",s=[];return n(t,"Name",e.name,s),n(t,"Platform",e.platform,s),n(t,"Version",e.version,s),s}},m={getFields:function(e){var t="Session",s=[];return n(t,"Id",e.id,s),n(t,"EcsETag",e.ecsETag,s),s}},p={getFields:function(e){var t=[];return n("Release","AudienceGroup",e.audienceGroup,t),t}}},46630:(e,t,s)=>{"use strict";function r(e,t,s){return{name:e,dataType:1,value:t,classification:s||4}}function i(e,t,s){return{name:e,dataType:2,value:t,classification:s||4}}function n(e,t,s){return{name:e,dataType:3,value:t,classification:s||4}}function a(e,t,s){return{name:e,dataType:0,value:t,classification:s||4}}s.d(t,{Kq:()=>i,UL:()=>r,b_:()=>n,dt:()=>a})},7744:(e,t,s)=>{"use strict";s.d(t,{H:()=>o,kr:()=>n,uf:()=>a});var r,i=(r=[],{fireEvent:function(e){r.forEach((function(t){return t(e)}))},addListener:function(e){e&&r.push(e)}});function n(){return i}function a(e,t,s){i.fireEvent({level:e,category:t,message:s})}function o(e,t,s){a(0,e,(function(){var e=s instanceof Error?s.message:"";return"".concat(t,": ").concat(e)}))}},43644:(e,t,s)=>{"use strict";s.d(t,{Dw:()=>f,Vp:()=>p,vE:()=>g});var r=s(59939),i=s(7744),n={};function a(e,t){"Office."===e.substring(0,7)&&"."!==e[e.length-1]?n[e]?(t.ariaTenantToken&&(n[e].ariaTenantToken=t.ariaTenantToken),t.dnmToken&&(n[e].dnmToken=t.dnmToken)):n[e]=t:(0,i.uf)(0,0,(function(){return"Namespace: ".concat(e)}))}function o(e,t){for(var s=e.length;s>0;){var r=e.substr(0,s);if(n[r]){var i=n[r];return t.ariaTenantToken=i.ariaTenantToken,t.dnmToken=i.dnmToken,!0}s=e.lastIndexOf(".",s-1)}return!1}var c=9007199254740991,u=/^Office(\.[A-Z][a-zA-Z0-9]*){2,}$/,l=/^[a-zA-Z0-9_\.]{1,95}$/;function h(e){return l.test(e)}function d(e){e&&e.forEach((function(e){if("string"!=typeof e.name||!h(e.name))throw new Error("Invalid dataField name");2===e.dataType&&function(e){if("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e<-9007199254740991||e>c)throw new Error("Invalid integer ".concat(JSON.stringify(e)))}(e.value)}))}var m=s(46630),p=-1;function g(e){var t={eventName:e.eventName,eventFlags:e.eventFlags||{},telemetryProperties:e.telemetryProperties?(0,r.__assign)({},e.telemetryProperties):{},dataFields:e.dataFields?e.dataFields.slice():[],timestamp:e.timestamp||(new Date).getTime()};return e.eventContract&&(t.eventContract={name:e.eventContract.name,dataFields:e.eventContract.dataFields.slice()}),t}var f=function(){function e(e,t,s){var i,n,a;this.telemetrySinks=[],this.persistentDataFields=[],this.partAFields=[],this.eventQueue=[],this.config=s||{},e&&(this.telemetrySinks=e.telemetrySinks,(i=this.persistentDataFields).push.apply(i,e.persistentDataFields),this.config=(0,r.__assign)((0,r.__assign)({},e.getConfig()),this.config),(n=this.partAFields).push.apply(n,e.partAFields)),t&&(a=this.persistentDataFields).push.apply(a,t)}return e.prototype.addEventContentType=function(e,t){e.push((0,m.Kq)("EventContent.Type",t))},e.prototype.sendTelemetryEvent=function(e){var t=g(e),s=t.telemetryProperties;s.nexusTenantToken=p,s.ariaTenantToken||o(t.eventName,s)||s.ariaTenantToken?this.sendTelemetryEventInternal(t,1):(0,i.uf)(0,0,(function(){return"No tenant token: "+e.eventName}))},e.prototype.sendCustomerContent=function(e){var t=g(e),s=t.telemetryProperties,r=s.customerContentVersion;return(!r||r>1)&&(s.customerContentVersion=1),s.ariaTenantToken=void 0,s.nexusTenantToken=void 0,s.dnmToken=void 0,this.addEventContentType(t.dataFields,2),this.sendTelemetryEventInternal(t,2)},e.prototype.sendDirectNumericEvent=function(e){var t=g(e),s=t.telemetryProperties;s.dnmToken||o(t.eventName,s)||s.dnmToken?(this.addEventContentType(t.dataFields,1),this.sendTelemetryEventInternal(t,3)):(0,i.uf)(0,0,(function(){return"No dnm token: "+t.eventName}))},e.prototype.sendTelemetryEventInternal=function(e,t){if(2===t||!e.telemetryProperties.customerContentVersion&&!e.telemetryProperties.customerContentType){try{if(0===this.telemetrySinks.length)return void(this.config.enableQueue&&this.eventQueue.length<1e3?this.eventQueue.push([e,t]):(0,i.uf)(1,0,(function(){return"No telemetry sinks are attached."})));this.processTelemetryEvent(e,t)}catch(e){return void(0,i.H)(0,"SendTelemetryEvent",e)}try{this.telemetrySinks.forEach((function(s){2===t?s.sendCustomerContent&&s.sendCustomerContent(e):3===t?s.sendNonStandardEvent&&s.sendNonStandardEvent(e,t):s.sendTelemetryEvent(e)}))}catch(e){}}else(0,i.uf)(0,0,(function(){return"Customer content"}))},e.prototype.processTelemetryEvent=function(e,t){var s,r,i;if(e.dataFields&&(null===(i=e.dataFields)||void 0===i||i.unshift((0,m.dt)("OTelJS.Version","4.9.0")),3!==t&&this.persistentDataFields&&(s=e.dataFields).unshift.apply(s,this.persistentDataFields)),this.partAFields.length>0){var n=e.eventContract||{name:"",dataFields:[]};(r=n.dataFields).push.apply(r,this.partAFields),e.eventContract=n}this.config.disableValidation||function(e){if(!(t=e.eventName)||t.length>98||!u.test(t))throw new Error("Invalid eventName");var t,s=e.eventContract;if(s){if(s.name&&!h(s.name))throw new Error("Invalid eventContract");d(s.dataFields)}d(e.dataFields)}(e)},e.prototype.addSink=function(e){this.telemetrySinks.push(e),this.flushQueue()},e.prototype.flushQueue=function(){var e=this.eventQueue;if(this.eventQueue=[],this.telemetrySinks.length>0)for(var t=0,s=e;t<s.length;t++){var r=s[t],i=r[0],n=r[1];this.sendTelemetryEventInternal(i,n)}},e.prototype.setTenantToken=function(e,t,s){a(e,{ariaTenantToken:t,nexusTenantToken:s})},e.prototype.setDNMToken=function(e,t){a(e,{dnmToken:t})},e.prototype.cloneEvent=function(e){return g(e)},e.prototype.getConfig=function(){return this.config},e}()},77556:(e,t,s)=>{"use strict";function r(e,t,s){return s?s.getSetting(e,t,"FluidExperiences"):t}s.d(t,{L:()=>r})},82024:(e,t,s)=>{"use strict";s.d(t,{en:()=>r});const r="URL"},17086:(e,t)=>{"use strict";t.b$=function(e){var t,s,n=function(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=e.indexOf("=");return-1===s&&(s=t),[s,s===t?0:4-s%4]}(e),a=n[0],o=n[1],c=new i(function(e,t,s){return 3*(t+s)/4-s}(0,a,o)),u=0,l=o>0?a-4:a;for(s=0;s<l;s+=4)t=r[e.charCodeAt(s)]<<18|r[e.charCodeAt(s+1)]<<12|r[e.charCodeAt(s+2)]<<6|r[e.charCodeAt(s+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===o&&(t=r[e.charCodeAt(s)]<<2|r[e.charCodeAt(s+1)]>>4,c[u++]=255&t),1===o&&(t=r[e.charCodeAt(s)]<<10|r[e.charCodeAt(s+1)]<<4|r[e.charCodeAt(s+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.JQ=function(e){for(var t,r=e.length,i=r%3,n=[],a=16383,o=0,u=r-i;o<u;o+=a)n.push(c(e,o,o+a>u?u:o+a));return 1===i?(t=e[r-1],n.push(s[t>>2]+s[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],n.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"=")),n.join("")};for(var s=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)s[a]=n[a],r[n.charCodeAt(a)]=a;function c(e,t,r){for(var i,n,a=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(s[(n=i)>>18&63]+s[n>>12&63]+s[n>>6&63]+s[63&n]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},50442:e=>{"use strict";function t(e){if(this._capacity=r(e),this._length=0,this._front=0,s(e)){for(var t=e.length,i=0;i<t;++i)this[i]=e[i];this._length=t}}t.prototype.toArray=function(){for(var e=this._length,t=new Array(e),s=this._front,r=this._capacity,i=0;i<e;++i)t[i]=this[s+i&r-1];return t},t.prototype.push=function(e){var t=arguments.length,s=this._length;if(t>1){var r=this._capacity;if(s+t>r){for(var i=0;i<t;++i)this._checkCapacity(s+1),this[n=this._front+s&this._capacity-1]=arguments[i],s++,this._length=s;return s}var n=this._front;for(i=0;i<t;++i)this[n+s&r-1]=arguments[i],n++;return this._length=s+t,s+t}return 0===t?s:(this._checkCapacity(s+1),this[i=this._front+s&this._capacity-1]=e,this._length=s+1,s+1)},t.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,s=this[t];return this[t]=void 0,this._length=e-1,s}},t.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,s=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,s}},t.prototype.unshift=function(e){var t=this._length,s=arguments.length;if(s>1){if(t+s>(i=this._capacity)){for(var r=s-1;r>=0;r--){this._checkCapacity(t+1);var i=this._capacity;this[a=(this._front-1&i-1^i)-i]=arguments[r],t++,this._length=t,this._front=a}return t}var n=this._front;for(r=s-1;r>=0;r--){var a;this[a=(n-1&i-1^i)-i]=arguments[r],n=a}return this._front=n,this._length=t+s,t+s}return 0===s?t:(this._checkCapacity(t+1),i=this._capacity,this[r=(this._front-1&i-1^i)-i]=e,this._length=t+1,this._front=r,t+1)},t.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},t.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},t.prototype.get=function(e){var t=e;if(t===(0|t)){var s=this._length;if(t<0&&(t+=s),!(t<0||t>=s))return this[this._front+t&this._capacity-1]}},t.prototype.isEmpty=function(){return 0===this._length},t.prototype.clear=function(){for(var e=this._length,t=this._front,s=this._capacity,r=0;r<e;++r)this[t+r&s-1]=void 0;this._length=0,this._front=0},t.prototype.toString=function(){return this.toArray().toString()},t.prototype.valueOf=t.prototype.toString,t.prototype.removeFront=t.prototype.shift,t.prototype.removeBack=t.prototype.pop,t.prototype.insertFront=t.prototype.unshift,t.prototype.insertBack=t.prototype.push,t.prototype.enqueue=t.prototype.push,t.prototype.dequeue=t.prototype.shift,t.prototype.toJSON=t.prototype.toArray,Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),t.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(r(1.5*this._capacity+16))},t.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var s=this._front,r=this._length;s+r>t&&function(e,t,s,r,i){for(var n=0;n<i;++n)s[n+r]=e[n+0],e[n+0]=void 0}(this,0,this,t,s+r&t-1)};var s=Array.isArray;function r(e){if("number"!=typeof e){if(!s(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,1+((t|=t>>8)|t>>16);var t}e.exports=t},67725:e=>{"use strict";var t,s="object"==typeof Reflect?Reflect:null,r=s&&"function"==typeof s.apply?s.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};t=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function n(){n.init.call(this)}e.exports=n,e.exports.once=function(e,t){return new Promise((function(s,r){function i(s){e.removeListener(t,n),r(s)}function n(){"function"==typeof e.removeListener&&e.removeListener("error",i),s([].slice.call(arguments))}g(e,t,n,{once:!0}),"error"!==t&&function(e,t,s){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function u(e,t,s,r){var i,n,a,u;if(o(s),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),n=e._events),a=n[t]),void 0===a)a=n[t]=s,++e._eventsCount;else if("function"==typeof a?a=n[t]=r?[s,a]:[a,s]:r?a.unshift(s):a.push(s),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,s){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},i=l.bind(r);return i.listener=s,r.wrapFn=i,i}function d(e,t,s){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?s?[i.listener||i]:[i]:s?function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(i):p(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function p(e,t){for(var s=new Array(t),r=0;r<t;++r)s[r]=e[r];return s}function g(e,t,s,r){if("function"==typeof e.on)r.once?e.once(t,s):e.on(t,s);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(n){r.once&&e.removeEventListener(t,i),s(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=n[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=p(c,u);for(s=0;s<u;++s)r(l[s],this,t)}return!0},n.prototype.addListener=function(e,t){return u(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return u(this,e,t,!0)},n.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},n.prototype.removeListener=function(e,t){var s,r,i,n,a;if(o(t),void 0===(r=this._events))return this;if(void 0===(s=r[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(i=-1,n=s.length-1;n>=0;n--)if(s[n]===t||s[n].listener===t){a=s[n].listener,i=n;break}if(i<0)return this;0===i?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,i),1===s.length&&(r[e]=s[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,s,r;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0===arguments.length){var i,n=Object.keys(s);for(r=0;r<n.length;++r)"removeListener"!==(i=n[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},n.prototype.listeners=function(e){return d(this,e,!0)},n.prototype.rawListeners=function(e){return d(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},n.prototype.listenerCount=m,n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},26056:(e,t,s)=>{var r=s(72221)(s(9649),"DataView");e.exports=r},21102:(e,t,s)=>{var r=s(1637),i=s(16380),n=s(17408),a=s(53997),o=s(34642);function c(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=n,c.prototype.has=a,c.prototype.set=o,e.exports=c},36491:(e,t,s)=>{var r=s(76073),i=s(23390),n=s(42461),a=s(18190),o=s(95670);function c(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=n,c.prototype.has=a,c.prototype.set=o,e.exports=c},95651:(e,t,s)=>{var r=s(72221)(s(9649),"Map");e.exports=r},52290:(e,t,s)=>{var r=s(6881),i=s(25089),n=s(67548),a=s(72151),o=s(51476);function c(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var r=e[t];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=n,c.prototype.has=a,c.prototype.set=o,e.exports=c},36561:(e,t,s)=>{var r=s(72221)(s(9649),"Promise");e.exports=r},89018:(e,t,s)=>{var r=s(72221)(s(9649),"Set");e.exports=r},47649:(e,t,s)=>{var r=s(36491),i=s(38023),n=s(39611),a=s(6138),o=s(96961),c=s(32631);function u(e){var t=this.__data__=new r(e);this.size=t.size}u.prototype.clear=i,u.prototype.delete=n,u.prototype.get=a,u.prototype.has=o,u.prototype.set=c,e.exports=u},20997:(e,t,s)=>{var r=s(9649).Symbol;e.exports=r},37830:(e,t,s)=>{var r=s(9649).Uint8Array;e.exports=r},43895:(e,t,s)=>{var r=s(72221)(s(9649),"WeakMap");e.exports=r},78769:e=>{e.exports=function(e,t){for(var s=-1,r=null==e?0:e.length;++s<r&&!1!==t(e[s],s,e););return e}},41155:e=>{e.exports=function(e,t){for(var s=-1,r=null==e?0:e.length,i=0,n=[];++s<r;){var a=e[s];t(a,s,e)&&(n[i++]=a)}return n}},17296:(e,t,s)=>{var r=s(4830),i=s(27987),n=s(69546),a=s(80758),o=s(95824),c=s(65739),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var s=n(e),l=!s&&i(e),h=!s&&!l&&a(e),d=!s&&!l&&!h&&c(e),m=s||l||h||d,p=m?r(e.length,String):[],g=p.length;for(var f in e)!t&&!u.call(e,f)||m&&("length"==f||h&&("offset"==f||"parent"==f)||d&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||o(f,g))||p.push(f);return p}},35276:e=>{e.exports=function(e,t){for(var s=-1,r=t.length,i=e.length;++s<r;)e[i+s]=t[s];return e}},88902:(e,t,s)=>{var r=s(32618),i=s(17689),n=Object.prototype.hasOwnProperty;e.exports=function(e,t,s){var a=e[t];n.call(e,t)&&i(a,s)&&(void 0!==s||t in e)||r(e,t,s)}},28627:(e,t,s)=>{var r=s(17689);e.exports=function(e,t){for(var s=e.length;s--;)if(r(e[s][0],t))return s;return-1}},36136:(e,t,s)=>{var r=s(20322),i=s(25961);e.exports=function(e,t){return e&&r(t,i(t),e)}},11461:(e,t,s)=>{var r=s(20322),i=s(14399);e.exports=function(e,t){return e&&r(t,i(t),e)}},32618:(e,t,s)=>{var r=s(80026);e.exports=function(e,t,s){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}},8876:(e,t,s)=>{var r=s(47649),i=s(78769),n=s(88902),a=s(36136),o=s(11461),c=s(84751),u=s(38571),l=s(98156),h=s(60164),d=s(28616),m=s(10478),p=s(11970),g=s(49200),f=s(97045),y=s(1685),v=s(69546),b=s(80758),S=s(1880),C=s(12289),w=s(65603),T=s(25961),N=s(14399),P="[object Arguments]",E="[object Function]",D="[object Object]",O={};O[P]=O["[object Array]"]=O["[object ArrayBuffer]"]=O["[object DataView]"]=O["[object Boolean]"]=O["[object Date]"]=O["[object Float32Array]"]=O["[object Float64Array]"]=O["[object Int8Array]"]=O["[object Int16Array]"]=O["[object Int32Array]"]=O["[object Map]"]=O["[object Number]"]=O[D]=O["[object RegExp]"]=O["[object Set]"]=O["[object String]"]=O["[object Symbol]"]=O["[object Uint8Array]"]=O["[object Uint8ClampedArray]"]=O["[object Uint16Array]"]=O["[object Uint32Array]"]=!0,O["[object Error]"]=O[E]=O["[object WeakMap]"]=!1,e.exports=function e(t,s,k,_,A,I){var M,R=1&s,F=2&s,x=4&s;if(k&&(M=A?k(t,_,A,I):k(t)),void 0!==M)return M;if(!C(t))return t;var L=v(t);if(L){if(M=g(t),!R)return u(t,M)}else{var z=p(t),j=z==E||"[object GeneratorFunction]"==z;if(b(t))return c(t,R);if(z==D||z==P||j&&!A){if(M=F||j?{}:y(t),!R)return F?h(t,o(M,t)):l(t,a(M,t))}else{if(!O[z])return A?t:{};M=f(t,z,R)}}I||(I=new r);var B=I.get(t);if(B)return B;I.set(t,M),w(t)?t.forEach((function(r){M.add(e(r,s,k,r,t,I))})):S(t)&&t.forEach((function(r,i){M.set(i,e(r,s,k,i,t,I))}));var q=L?void 0:(x?F?m:d:F?N:T)(t);return i(q||t,(function(r,i){q&&(r=t[i=r]),n(M,i,e(r,s,k,i,t,I))})),M}},29395:(e,t,s)=>{var r=s(12289),i=Object.create,n=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var s=new e;return e.prototype=void 0,s}}();e.exports=n},12506:(e,t,s)=>{var r=s(35276),i=s(69546);e.exports=function(e,t,s){var n=t(e);return i(e)?n:r(n,s(e))}},28247:(e,t,s)=>{var r=s(20997),i=s(37386),n=s(4591),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):n(e)}},70621:(e,t,s)=>{var r=s(28247),i=s(17734);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},4605:(e,t,s)=>{var r=s(11970),i=s(17734);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},50291:(e,t,s)=>{var r=s(93331),i=s(37114),n=s(12289),a=s(77606),o=/^\[object .+?Constructor\]$/,c=Function.prototype,u=Object.prototype,l=c.toString,h=u.hasOwnProperty,d=RegExp("^"+l.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!n(e)||i(e))&&(r(e)?d:o).test(a(e))}},45608:(e,t,s)=>{var r=s(11970),i=s(17734);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},89278:(e,t,s)=>{var r=s(28247),i=s(80459),n=s(17734),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return n(e)&&i(e.length)&&!!a[r(e)]}},59011:(e,t,s)=>{var r=s(46358),i=s(95513),n=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var s in Object(e))n.call(e,s)&&"constructor"!=s&&t.push(s);return t}},56827:(e,t,s)=>{var r=s(12289),i=s(46358),n=s(34040),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return n(e);var t=i(e),s=[];for(var o in e)("constructor"!=o||!t&&a.call(e,o))&&s.push(o);return s}},4830:e=>{e.exports=function(e,t){for(var s=-1,r=Array(e);++s<e;)r[s]=t(s);return r}},99199:e=>{e.exports=function(e){return function(t){return e(t)}}},26477:(e,t,s)=>{var r=s(37830);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},84751:(e,t,s)=>{e=s.nmd(e);var r=s(9649),i=t&&!t.nodeType&&t,n=i&&e&&!e.nodeType&&e,a=n&&n.exports===i?r.Buffer:void 0,o=a?a.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var s=e.length,r=o?o(s):new e.constructor(s);return e.copy(r),r}},52502:(e,t,s)=>{var r=s(26477);e.exports=function(e,t){var s=t?r(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}},4759:e=>{var t=/\w*$/;e.exports=function(e){var s=new e.constructor(e.source,t.exec(e));return s.lastIndex=e.lastIndex,s}},16431:(e,t,s)=>{var r=s(20997),i=r?r.prototype:void 0,n=i?i.valueOf:void 0;e.exports=function(e){return n?Object(n.call(e)):{}}},49687:(e,t,s)=>{var r=s(26477);e.exports=function(e,t){var s=t?r(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}},38571:e=>{e.exports=function(e,t){var s=-1,r=e.length;for(t||(t=Array(r));++s<r;)t[s]=e[s];return t}},20322:(e,t,s)=>{var r=s(88902),i=s(32618);e.exports=function(e,t,s,n){var a=!s;s||(s={});for(var o=-1,c=t.length;++o<c;){var u=t[o],l=n?n(s[u],e[u],u,s,e):void 0;void 0===l&&(l=e[u]),a?i(s,u,l):r(s,u,l)}return s}},98156:(e,t,s)=>{var r=s(20322),i=s(4918);e.exports=function(e,t){return r(e,i(e),t)}},60164:(e,t,s)=>{var r=s(20322),i=s(2659);e.exports=function(e,t){return r(e,i(e),t)}},48976:(e,t,s)=>{var r=s(9649)["__core-js_shared__"];e.exports=r},80026:(e,t,s)=>{var r=s(72221),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},46954:(e,t,s)=>{var r="object"==typeof s.g&&s.g&&s.g.Object===Object&&s.g;e.exports=r},28616:(e,t,s)=>{var r=s(12506),i=s(4918),n=s(25961);e.exports=function(e){return r(e,n,i)}},10478:(e,t,s)=>{var r=s(12506),i=s(2659),n=s(14399);e.exports=function(e){return r(e,n,i)}},55502:(e,t,s)=>{var r=s(89983);e.exports=function(e,t){var s=e.__data__;return r(t)?s["string"==typeof t?"string":"hash"]:s.map}},72221:(e,t,s)=>{var r=s(50291),i=s(85779);e.exports=function(e,t){var s=i(e,t);return r(s)?s:void 0}},65506:(e,t,s)=>{var r=s(78892)(Object.getPrototypeOf,Object);e.exports=r},37386:(e,t,s)=>{var r=s(20997),i=Object.prototype,n=i.hasOwnProperty,a=i.toString,o=r?r.toStringTag:void 0;e.exports=function(e){var t=n.call(e,o),s=e[o];try{e[o]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[o]=s:delete e[o]),i}},4918:(e,t,s)=>{var r=s(41155),i=s(41258),n=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,o=a?function(e){return null==e?[]:(e=Object(e),r(a(e),(function(t){return n.call(e,t)})))}:i;e.exports=o},2659:(e,t,s)=>{var r=s(35276),i=s(65506),n=s(4918),a=s(41258),o=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,n(e)),e=i(e);return t}:a;e.exports=o},11970:(e,t,s)=>{var r=s(26056),i=s(95651),n=s(36561),a=s(89018),o=s(43895),c=s(28247),u=s(77606),l="[object Map]",h="[object Promise]",d="[object Set]",m="[object WeakMap]",p="[object DataView]",g=u(r),f=u(i),y=u(n),v=u(a),b=u(o),S=c;(r&&S(new r(new ArrayBuffer(1)))!=p||i&&S(new i)!=l||n&&S(n.resolve())!=h||a&&S(new a)!=d||o&&S(new o)!=m)&&(S=function(e){var t=c(e),s="[object Object]"==t?e.constructor:void 0,r=s?u(s):"";if(r)switch(r){case g:return p;case f:return l;case y:return h;case v:return d;case b:return m}return t}),e.exports=S},85779:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},1637:(e,t,s)=>{var r=s(55586);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},16380:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},17408:(e,t,s)=>{var r=s(55586),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var s=t[e];return"__lodash_hash_undefined__"===s?void 0:s}return i.call(t,e)?t[e]:void 0}},53997:(e,t,s)=>{var r=s(55586),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},34642:(e,t,s)=>{var r=s(55586);e.exports=function(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},49200:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var s=e.length,r=new e.constructor(s);return s&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},97045:(e,t,s)=>{var r=s(26477),i=s(52502),n=s(4759),a=s(16431),o=s(49687);e.exports=function(e,t,s){var c=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new c(+e);case"[object DataView]":return i(e,s);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return o(e,s);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(e);case"[object RegExp]":return n(e);case"[object Symbol]":return a(e)}}},1685:(e,t,s)=>{var r=s(29395),i=s(65506),n=s(46358);e.exports=function(e){return"function"!=typeof e.constructor||n(e)?{}:r(i(e))}},95824:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,s){var r=typeof e;return!!(s=null==s?9007199254740991:s)&&("number"==r||"symbol"!=r&&t.test(e))&&e>-1&&e%1==0&&e<s}},89983:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},37114:(e,t,s)=>{var r,i=s(48976),n=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!n&&n in e}},46358:e=>{var t=Object.prototype;e.exports=function(e){var s=e&&e.constructor;return e===("function"==typeof s&&s.prototype||t)}},76073:e=>{e.exports=function(){this.__data__=[],this.size=0}},23390:(e,t,s)=>{var r=s(28627),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,s=r(t,e);return!(s<0||(s==t.length-1?t.pop():i.call(t,s,1),--this.size,0))}},42461:(e,t,s)=>{var r=s(28627);e.exports=function(e){var t=this.__data__,s=r(t,e);return s<0?void 0:t[s][1]}},18190:(e,t,s)=>{var r=s(28627);e.exports=function(e){return r(this.__data__,e)>-1}},95670:(e,t,s)=>{var r=s(28627);e.exports=function(e,t){var s=this.__data__,i=r(s,e);return i<0?(++this.size,s.push([e,t])):s[i][1]=t,this}},6881:(e,t,s)=>{var r=s(21102),i=s(36491),n=s(95651);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(n||i),string:new r}}},25089:(e,t,s)=>{var r=s(55502);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},67548:(e,t,s)=>{var r=s(55502);e.exports=function(e){return r(this,e).get(e)}},72151:(e,t,s)=>{var r=s(55502);e.exports=function(e){return r(this,e).has(e)}},51476:(e,t,s)=>{var r=s(55502);e.exports=function(e,t){var s=r(this,e),i=s.size;return s.set(e,t),this.size+=s.size==i?0:1,this}},55586:(e,t,s)=>{var r=s(72221)(Object,"create");e.exports=r},95513:(e,t,s)=>{var r=s(78892)(Object.keys,Object);e.exports=r},34040:e=>{e.exports=function(e){var t=[];if(null!=e)for(var s in Object(e))t.push(s);return t}},59214:(e,t,s)=>{e=s.nmd(e);var r=s(46954),i=t&&!t.nodeType&&t,n=i&&e&&!e.nodeType&&e,a=n&&n.exports===i&&r.process,o=function(){try{return n&&n.require&&n.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=o},4591:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},78892:e=>{e.exports=function(e,t){return function(s){return e(t(s))}}},9649:(e,t,s)=>{var r=s(46954),i="object"==typeof self&&self&&self.Object===Object&&self,n=r||i||Function("return this")();e.exports=n},38023:(e,t,s)=>{var r=s(36491);e.exports=function(){this.__data__=new r,this.size=0}},39611:e=>{e.exports=function(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}},6138:e=>{e.exports=function(e){return this.__data__.get(e)}},96961:e=>{e.exports=function(e){return this.__data__.has(e)}},32631:(e,t,s)=>{var r=s(36491),i=s(95651),n=s(52290);e.exports=function(e,t){var s=this.__data__;if(s instanceof r){var a=s.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new n(a)}return s.set(e,t),this.size=s.size,this}},77606:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},70709:(e,t,s)=>{var r=s(8876);e.exports=function(e){return r(e,5)}},17689:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},27987:(e,t,s)=>{var r=s(70621),i=s(17734),n=Object.prototype,a=n.hasOwnProperty,o=n.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!o.call(e,"callee")};e.exports=c},69546:e=>{var t=Array.isArray;e.exports=t},46387:(e,t,s)=>{var r=s(93331),i=s(80459);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},80758:(e,t,s)=>{e=s.nmd(e);var r=s(9649),i=s(68854),n=t&&!t.nodeType&&t,a=n&&e&&!e.nodeType&&e,o=a&&a.exports===n?r.Buffer:void 0,c=(o?o.isBuffer:void 0)||i;e.exports=c},93331:(e,t,s)=>{var r=s(28247),i=s(12289);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},80459:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},1880:(e,t,s)=>{var r=s(4605),i=s(99199),n=s(59214),a=n&&n.isMap,o=a?i(a):r;e.exports=o},12289:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},17734:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},65603:(e,t,s)=>{var r=s(45608),i=s(99199),n=s(59214),a=n&&n.isSet,o=a?i(a):r;e.exports=o},65739:(e,t,s)=>{var r=s(89278),i=s(99199),n=s(59214),a=n&&n.isTypedArray,o=a?i(a):r;e.exports=o},25961:(e,t,s)=>{var r=s(17296),i=s(59011),n=s(46387);e.exports=function(e){return n(e)?r(e):i(e)}},14399:(e,t,s)=>{var r=s(17296),i=s(56827),n=s(46387);e.exports=function(e){return n(e)?r(e,!0):i(e)}},41258:e=>{e.exports=function(){return[]}},68854:e=>{e.exports=function(){return!1}},77097:e=>{"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function s(e,t){for(var s,r="",i=0,n=-1,a=0,o=0;o<=e.length;++o){if(o<e.length)s=e.charCodeAt(o);else{if(47===s)break;s=47}if(47===s){if(n===o-1||1===a);else if(n!==o-1&&2===a){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var c=r.lastIndexOf("/");if(c!==r.length-1){-1===c?(r="",i=0):i=(r=r.slice(0,c)).length-1-r.lastIndexOf("/"),n=o,a=0;continue}}else if(2===r.length||1===r.length){r="",i=0,n=o,a=0;continue}t&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+="/"+e.slice(n+1,o):r=e.slice(n+1,o),i=o-n-1;n=o,a=0}else 46===s&&-1!==a?++a:a=-1}return r}var r={resolve:function(){for(var e,r="",i=!1,n=arguments.length-1;n>=-1&&!i;n--){var a;n>=0?a=arguments[n]:(void 0===e&&(e={env:{NODE_ENV:"production"}}.cwd()),a=e),t(a),0!==a.length&&(r=a+"/"+r,i=47===a.charCodeAt(0))}return r=s(r,!i),i?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(t(e),0===e.length)return".";var r=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=s(e,!r)).length||r||(e="."),e.length>0&&i&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,s=0;s<arguments.length;++s){var i=arguments[s];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":r.normalize(e)},relative:function(e,s){if(t(e),t(s),e===s)return"";if((e=r.resolve(e))===(s=r.resolve(s)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var n=e.length,a=n-i,o=1;o<s.length&&47===s.charCodeAt(o);++o);for(var c=s.length-o,u=a<c?a:c,l=-1,h=0;h<=u;++h){if(h===u){if(c>u){if(47===s.charCodeAt(o+h))return s.slice(o+h+1);if(0===h)return s.slice(o+h)}else a>u&&(47===e.charCodeAt(i+h)?l=h:0===h&&(l=0));break}var d=e.charCodeAt(i+h);if(d!==s.charCodeAt(o+h))break;47===d&&(l=h)}var m="";for(h=i+l+1;h<=n;++h)h!==n&&47!==e.charCodeAt(h)||(0===m.length?m+="..":m+="/..");return m.length>0?m+s.slice(o+l):(o+=l,47===s.charCodeAt(o)&&++o,s.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var s=e.charCodeAt(0),r=47===s,i=-1,n=!0,a=e.length-1;a>=1;--a)if(47===(s=e.charCodeAt(a))){if(!n){i=a;break}}else n=!1;return-1===i?r?"/":".":r&&1===i?"//":e.slice(0,i)},basename:function(e,s){if(void 0!==s&&"string"!=typeof s)throw new TypeError('"ext" argument must be a string');t(e);var r,i=0,n=-1,a=!0;if(void 0!==s&&s.length>0&&s.length<=e.length){if(s.length===e.length&&s===e)return"";var o=s.length-1,c=-1;for(r=e.length-1;r>=0;--r){var u=e.charCodeAt(r);if(47===u){if(!a){i=r+1;break}}else-1===c&&(a=!1,c=r+1),o>=0&&(u===s.charCodeAt(o)?-1==--o&&(n=r):(o=-1,n=c))}return i===n?n=c:-1===n&&(n=e.length),e.slice(i,n)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!a){i=r+1;break}}else-1===n&&(a=!1,n=r+1);return-1===n?"":e.slice(i,n)},extname:function(e){t(e);for(var s=-1,r=0,i=-1,n=!0,a=0,o=e.length-1;o>=0;--o){var c=e.charCodeAt(o);if(47!==c)-1===i&&(n=!1,i=o+1),46===c?-1===s?s=o:1!==a&&(a=1):-1!==s&&(a=-1);else if(!n){r=o+1;break}}return-1===s||-1===i||0===a||1===a&&s===i-1&&s===r+1?"":e.slice(s,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var s=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return s?s===t.root?s+r:s+"/"+r:r}(0,e)},parse:function(e){t(e);var s={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return s;var r,i=e.charCodeAt(0),n=47===i;n?(s.root="/",r=1):r=0;for(var a=-1,o=0,c=-1,u=!0,l=e.length-1,h=0;l>=r;--l)if(47!==(i=e.charCodeAt(l)))-1===c&&(u=!1,c=l+1),46===i?-1===a?a=l:1!==h&&(h=1):-1!==a&&(h=-1);else if(!u){o=l+1;break}return-1===a||-1===c||0===h||1===h&&a===c-1&&a===o+1?-1!==c&&(s.base=s.name=0===o&&n?e.slice(1,c):e.slice(o,c)):(0===o&&n?(s.name=e.slice(1,a),s.base=e.slice(1,c)):(s.name=e.slice(o,a),s.base=e.slice(o,c)),s.ext=e.slice(a,c)),o>0?s.dir=e.slice(0,o-1):n&&(s.dir="/"),s},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,e.exports=r},59939:(e,t,s)=>{"use strict";s.r(t),s.d(t,{__assign:()=>n,__asyncDelegator:()=>C,__asyncGenerator:()=>S,__asyncValues:()=>w,__await:()=>b,__awaiter:()=>l,__classPrivateFieldGet:()=>D,__classPrivateFieldSet:()=>O,__createBinding:()=>d,__decorate:()=>o,__exportStar:()=>m,__extends:()=>i,__generator:()=>h,__importDefault:()=>E,__importStar:()=>P,__makeTemplateObject:()=>T,__metadata:()=>u,__param:()=>c,__read:()=>g,__rest:()=>a,__spread:()=>f,__spreadArray:()=>v,__spreadArrays:()=>y,__values:()=>p});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])},r(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}var n=function(){return n=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++)for(var i in t=arguments[s])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function a(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s}function o(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a}function c(e,t){return function(s,r){t(s,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))}function h(e,t){var s,r,i,n,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(s)throw new TypeError("Generator is already executing.");for(;a;)try{if(s=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,r=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){a.label=n[1];break}if(6===n[0]&&a.label<i[1]){a.label=i[1],i=n;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(n);break}i[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],r=0}finally{s=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}var d=Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]};function m(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||d(t,e,s)}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,s=t&&e[t],r=0;if(s)return s.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var s="function"==typeof Symbol&&e[Symbol.iterator];if(!s)return e;var r,i,n=s.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=n.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(i)throw i.error}}return a}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function y(){for(var e=0,t=0,s=arguments.length;t<s;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<s;t++)for(var n=arguments[t],a=0,o=n.length;a<o;a++,i++)r[i]=n[a];return r}function v(e,t,s){if(s||2===arguments.length)for(var r,i=0,n=t.length;i<n;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function S(e,t,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=s.apply(e,t||[]),n=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){i[e]&&(r[e]=function(t){return new Promise((function(s,r){n.push([e,t,s,r])>1||o(e,t)}))})}function o(e,t){try{(s=i[e](t)).value instanceof b?Promise.resolve(s.value.v).then(c,u):l(n[0][2],s)}catch(e){l(n[0][3],e)}var s}function c(e){o("next",e)}function u(e){o("throw",e)}function l(e,t){e(t),n.shift(),n.length&&o(n[0][0],n[0][1])}}function C(e){var t,s;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(s=!s)?{value:b(e[r](t)),done:"return"===r}:i?i(t):t}:i}}function w(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,s=e[Symbol.asyncIterator];return s?s.call(e):(e=p(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=e[s]&&function(t){return new Promise((function(r,i){!function(e,t,s,r){Promise.resolve(r).then((function(t){e({value:t,done:s})}),t)}(r,i,(t=e[s](t)).done,t.value)}))}}}function T(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var N=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&d(t,e,s);return N(t,e),t}function E(e){return e&&e.__esModule?e:{default:e}}function D(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}function O(e,t,s,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,s):i?i.value=s:t.set(e,s),s}},50084:(e,t,s)=>{"use strict";var r;s.d(t,{Z:()=>l});var i=new Uint8Array(16);function n(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,o=function(e){return"string"==typeof e&&a.test(e)};for(var c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));const l=function(e,t,s){var r=(e=e||{}).random||(e.rng||n)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){s=s||0;for(var i=0;i<16;++i)t[s+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!o(s))throw TypeError("Stringified UUID is invalid");return s}(r)}},82144:(e,t,s)=>{"use strict";function r(){const e=document.currentScript;if(e){const r=e.src;t=r.substring(0,r.lastIndexOf("/")+1),s.p=t}var t;!function(){const e=s.e;s.e=(e=>t=>{let s=3;return function r(){return e(t).catch((i=>(s-=1,0===s?e(t):r())))}()})(e)}()}var i=s(40544),n=s(58252);const a=(e,t,s)=>"FluidObject"===t.factory.type?{...t,factory:{type:"FluidObject",factory:new i.d(o(e,t.factory.factory,s))}}:{...t,factory:{type:"LoopObject",factory:new i.d(o(e,t.factory.factory,s))}};function o(e,t,s){return()=>{const r=n.a.start("ComponentCodeLoad",s,{additionalPropsToLog:{componentType:e}});return t.then((()=>r.setResult(!0))).catch((()=>r.setResult(!1))),t}}var c=s(54188),u=s(4744);async function l(e,t,s){const r=await t;return r&&void 0===r[e]&&(s&&(0,u.ve)(s,{eventName:"RegisterScopeObjectsMissingProvider",message:`Scope dependency: '${e}' does not implement the provider contract.`}),r[e]=t),t}class h{constructor(e){this.doNotUse_WorkspaceRosterIdPromise=e}get RosterLWGProvider(){return this}}var d,m=s(38756),p=s(57549),g=s(46421);class f{constructor(){this.handlers=[]}pushHandler(...e){void 0!==e&&this.handlers.push(...e)}async handleRequest(e,t){const s=p.R.create(e);for(const e of this.handlers){const r=await e(s,t);if(void 0!==r)return r}return(0,g.I4)(e)}}class y{constructor(){this[d]="Deferred",this.isPending=!0,this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}then(e,t){return this.p.then(e,t)}catch(e){return this.p.catch(e)}resolve(e){this.isPending=!1,this.res(e)}reject(e){this.isPending=!1,this.rej(e)}pending(){return this.isPending}finally(e){return this.p.finally(e)}}d=Symbol.toStringTag;class v{constructor(e){this.processorMap=e,this.requestProcessors=new Map,this.seenComponents=new Map,this.ensureContainerProcessor=async(e,t)=>{const s=(await t.factory).instantiateContainerService(e);this.addComponentHelper(s,e)}}get DataConnector(){return this}async submitRequest(e,t,s){await this.ensureContainerProcessors(e,s);const r=this.requestProcessors.get(e);if(!r)return[];const i=[];return r.forEach((async s=>{i.push(s.processDataRequest(e,t))})),i}addComponent(e,t,s){const r=e.startsWith("/")?e.substr(1):e;this.seenComponents.has(r)||(this.seenComponents.set(r,void 0),this.addComponentHelper(t,s))}addComponentHelper(e,t){const s=e.DataRequestProcessor;s&&this.registerDataProcessor(s);const r=e.DataRequestCreator;r&&r.registerDataRequestCallback((async(e,s)=>await this.submitRequest(e,s,t)))}registerDataProcessor(e){e.supportedDataTypes.forEach((t=>{this.requestProcessors.has(t)||this.requestProcessors.set(t,[]),this.requestProcessors.get(t).push(e)}))}async ensureContainerProcessors(e,t){let s=new Array;this.processorMap.forEach(((r,i)=>{if(r.processes?.includes(e)){const e=this.seenComponents.get(i);if(void 0!==e)s.push(e);else if(!this.seenComponents.has(i)){const e=this.ensureContainerProcessor(t,r);this.seenComponents.set(i,e),s.push(e)}}})),await Promise.all(s)}}var b=s(30105),S=s(95336);const C=async e=>{if(e.attachState!==S.mB.Detached)return new Promise(((t,s)=>{e.disposed&&s(),e.once("dispose",s);const r=()=>{const r=e.deltaManager,i=r.lastKnownSeqNumber;i<=r.lastSequenceNumber&&(t(),e.off("dispose",s));const n=a=>{i<=a.sequenceNumber&&(t(),r.off("op",n),e.off("dispose",s))};r.on("op",n)};e.connected?r():e.once("connected",r)}))},w=async(e,t,s,r,i,n,a,o)=>{if(s.pathParts.length<1||"_create"!==s.pathParts[0])return;const c=s.headers?.registryContext;if(void 0!==c){const u=Array.isArray(c),l=s.headers?.collectionId||s.headers?.isManaged||u&&1===c.length&&t.get(c[0])?.collection,h=await(async(e,t,s)=>{if(0===t.length)return;if(1===t.length)return s.get(t[0]);const r=t.length-1,i=await(async(e,t)=>t.reduce(((e,t)=>e.then((e=>e?.IFluidDataStoreRegistry?.get(t)))),Promise.resolve(e)))(e,t.slice(0,r));return i?.SubComponentRegistryDataProvider?.getSubComponentRegistryInfo(t[r])})(r,c,t);if(h&&E(h,i,o,Promise.resolve(r)).catch((()=>{})),l){const t=s.headers?.collectionId??h?.TOBEREMOVED_collectionId;return await N(r,c,e,t,n,s.headers?.initialConfig,a)}return await P(r,s.headers?.registryContext,e,a,s.headers?.initialConfig??{},s.headers?.root?"defaultComponent":void 0)}const u=new URLSearchParams(s.query),l=await T(r,t,u,s.headers);if(!l)return{status:404,mimeType:"fluid/object",value:void 0};E(l.registryData,i,o,Promise.resolve(r)).catch((()=>{}));let h=s.headers?.initialConfig??{};return u.get("dataProvider")&&(h={...h,manifest:l.initialData}),l.registryData.collection&&l.registryData.TOBEREMOVED_collectionId?await N(r,[l.registryType],e,l.registryData.TOBEREMOVED_collectionId,n,h,a):await P(r,[l.registryType],e,a,h,s.headers?.root?"defaultComponent":void 0)},T=async(e,t,s,r)=>{const i=s.get("registryType");if(i){const e=t.get(i);return e?{registryType:i,registryData:e}:void 0}const n=s.get("dataProvider"),a=r?.initialData;if(n){const s=e.scope.IFluidDependencySynthesizer?.synthesize({TokenProvider:b.B7,SettingsProvider:b.mu},void 0);for(let[e,r]of t.entries()){const t=r.dataCreationInfo;if(t){const i=t.find((e=>e.dataType===n));try{if(i&&(void 0===i.canHandleData||await i.canHandleData(a,s)))return{registryType:e,initialData:{dataType:i.dataType,initialData:a},registryData:r}}catch{}}}}},N=async(e,t,s,r,i,n,a)=>{a&&(0,u.ve)(a,{eventName:"StartWaitForSafeCoordinatedCreate"}),await C(e),a&&(0,u.ve)(a,{eventName:"EndWaitForSafeCoordinatedCreate"});let o=await e.request({url:r,headers:{wait:!1}});200!==o.status||"fluid/object"!==o.mimeType?(i.has(r)||i.set(r,P(e,t,s,a,void 0,r)),o=await i.get(r)):i.delete(r);const c=o?.value,l=c?.IFluidObjectCollection?.createCollectionItem(n);return l?(l.IFluidLoadable&&s.addComponent(l.IFluidLoadable.handle.absolutePath,l,e),{status:200,mimeType:"fluid/object",value:l}):{status:404,mimeType:"fluid/object",value:void 0}},P=async(e,t,s,r,i,a)=>{const o=t[t.length-1],c=n.a.start("CreateComponent",r,{additionalPropsToLog:{componentType:o}}),u=await e._createDataStoreWithProps(t,i).catch((e=>(c.setResult(!1,{componentType:o},e),{status:404,mimeType:"fluid/object",value:e})));a&&await(u?.trySetAlias(a));const l=e.disposed;if(!u||!u.fluidDataStoreChannel||!u.fluidDataStoreChannel.bindToContext||l){const e=new Error(l?"Container runtime is closed":"Couldn't create component runtime");return c.setResult(!1,{componentType:o},e),{status:404,mimeType:"fluid/object",value:e}}const h=await u.request({url:"/"});u.fluidDataStoreChannel.bindToContext();const d=u.fluidDataStoreChannel.id;return c.setResult(!0,{componentId:d,componentType:o}),200===h.status&&s.addComponent(d,h.value,e),h},E=async(e,t,s,r)=>{const{providersToPreload:i}=e;i&&r&&Promise.all(i.map((async e=>{(await r).scope.IFluidDependencySynthesizer?.synthesize({[e]:e},{})}))).catch((()=>{})),e.preloadLocalizationAssets&&s&&e.preloadLocalizationAssets(s),e.dataProvidersToPreload&&e.dataProvidersToPreload.forEach((e=>{const i=t.get(e);i&&E(i,t,s,r).catch((()=>{}))})),e.factory.factory.catch((()=>{}))};class D{constructor(e,t,s){this.containerRuntime=e,this.loadComponentHandler=t,this.createComponentHandler=s}get DataStoreService(){return this}async loadComponent(e,t=!0){const s=p.R.create({url:e.absolutePath,headers:{wait:t}}),r=await this.loadComponentHandler(s,this.containerRuntime);if(r&&200===r.status)return r.value;const i=r?` Error code: ${r.status}, message: ${r.value}`:"";throw new Error(`Failed to load component.${i}`)}async getFluidHandle(e){const t=p.R.create({url:e}),s=await this.loadComponentHandler(t,this.containerRuntime);let r;return s&&200===s.status&&(r=s.value?.IFluidLoadable?.handle),r}async checkComponentExists(e,t=!1){const s=p.R.create({url:e,headers:{wait:!1}});t||await C(this.containerRuntime);const r=await this.loadComponentHandler(s,this.containerRuntime);let i;return r&&200===r.status&&(i=r.value?.IFluidLoadable?.handle),void 0!==i}async createComponentFromRegistry(e,t,s){const r=p.R.create({url:"_create",headers:{registryContext:e,initialConfig:t,root:s}}),i=await this.createComponentHandler(r,this.containerRuntime);return i&&200===i.status?i.value:Promise.reject(i?.value)}async createManagedCollection(e,t){const s=p.R.create({url:"_create",headers:{registryContext:e,initialConfig:t,isManaged:!0}}),r=await this.createComponentHandler(s,this.containerRuntime);if(r&&200===r.status)return r.value}async createComponentFromDataProvider(e){const t=p.R.create({url:`_create?dataProvider=${e.dataType}`,headers:{initialData:e.data}}),s=await this.createComponentHandler(t,this.containerRuntime);if(s&&200===s.status)return s.value}}class O{constructor(e,t,s){this.runtime=e,this.dependencyContainer=t,this.containerLogger=s}get ResolvedUrlProvider(){return this}async getResolvedUrl(){return this.resolvedUrl||(this.resolvedUrl=this.resolveDocumentUrl()),this.resolvedUrl}async getResolver(){const{ILoader:e}=this.dependencyContainer.synthesize({ILoader:"ILoader"},void 0),t=await e;if(function(e){return!(!e||!e.services?.urlResolver)}(t))return t.services.urlResolver}async resolveDocumentUrl(){const e=await this.runtime.getAbsoluteUrl("/");if(!e)return;const t=await this.getResolver();if(t)try{return await t.resolve({url:e})}catch(e){return void(this.containerLogger&&(0,u.uX)(this.containerLogger,{eventName:"ResolveDocumentUrlError"},e))}}}class k{constructor(e){this.containerLogger=e,this.criticalTasks=new Map,this.taskIdCounter=1,this.taskQueue=new Map}get NonCriticalTaskScheduler(){return this}get areCriticalTasksPending(){return this.criticalTasks.size>0}reportCriticalTask(e,t){this.criticalTasks.set(e,t),t.finally((()=>{this.criticalTasks.delete(e),this.onCriticalTaskComplete()}))}getCriticalTaskPromise(e){return this.criticalTasks.get(e)}scheduleNonCriticalTask(e){let t;if(this.areCriticalTasksPending)return t={execute:e,id:this.taskIdCounter},this.taskQueue.set(t.id,t),this.taskIdCounter=this.taskIdCounter+1,t.id;e()}cancelNonCriticalTask(e){e&&this.taskQueue.delete(e)}onCriticalTaskComplete(){this.areCriticalTasksPending||this.runTasks()}runTasks(){for(const e of this.taskQueue.values())try{e.execute()}catch(e){this.containerLogger&&(0,u.uX)(this.containerLogger,{eventName:"Non critical task error"},e)}finally{this.taskQueue.delete(e.id)}}}async function _(e,t=new Map,s=new Map,r=new Map,n=[],a,o,l,h){const d=new v(s);let g=new Map;t.forEach(((e,t)=>{"FluidObject"===e.factory.type&&g.set(t,e.factory.factory)}));const b=new f,S=function(e,t,s,r){const i=(e=>{let t=new Map;return e.forEach((e=>{e.dataCreationInfo&&e.dataCreationInfo.forEach((s=>{s.dataType&&t.set(s.dataType,e)}))})),t})(t),n=new Map;return(a,o)=>w(e,t,a,o,i,n,s,r)}(d,t,a,h),C=function(e,t){return(s,r)=>(async(e,t,s,r)=>{const i=0===s.pathParts.length?p.R.create({url:`defaultComponent${s.url}`,headers:s.headers}):s;let n,a;try{if(n=await e.resolveHandle(i),200===n.status){t.addComponent(s.url,n.value,e);const i=n.value?.ComponentMetadata;i&&r&&await(i.identityName?.then((e=>{(0,u.ve)(r,{eventName:"LoadComponentMetadata",identityName:e})})))}else a={message:`Failed with status ${n.status}: ${n.value}`,stack:n.stack}}catch(e){a=e,n={status:404,mimeType:"fluid/object",value:e}}return 200!==n.status&&!1!==s.headers?.wait&&r&&(0,u.uX)(r,{eventName:"LoadComponentError"},a),n})(r,e,s,t)}(d,a);b.pushHandler(...n,C);const T=new y,N=function(e,t,s,r){const n=new c.Q(t);return s.forEach(((t,s)=>{"string"==typeof s&&(n.has(s)||n.register(s,new i.d((async()=>{const i=await e,n=(await t.factory).instantiateContainerService(i);return r?.addComponent(s,n,i),n}))))})),n}(T,l,r,d);N.has("DataStoreService")||N.register("DataStoreService",new i.d((async()=>{const e=await T;return new D(e,C,S)}))),N.has("DataConnector")||N.register("DataConnector",new i.d((async()=>d))),N.has("ResolvedUrlProvider")||N.register("ResolvedUrlProvider",new i.d((async()=>new O(await T,N,a)))),N.has("NonCriticalTaskScheduler")||N.register("NonCriticalTaskScheduler",new i.d((async()=>new k(a))));const P=await m.kE.load(e,g,(async(e,t)=>b.handleRequest(e,t)),o,function(e,t){const s=[...Object.keys(e),...Object.keys(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(e)))],r={};s.forEach((s=>{void 0===t[s]&&(r[s]=e[s])}));for(const e in t)r[e]=t[e];return r}(e.scope,{IFluidDependencySynthesizer:N}));return T.resolve(P),P}var A=s(61920),I=s(42681);const M=1e4;var R=s(36047);const F=new class{logEvent(e){e.category===R.J.Error?console.error("%cPurple: %c%s","color: purple; font-style: italic","",JSON.stringify(e)):console.log("%cPurple: %c%s","color: purple; font-style: italic","",JSON.stringify(e))}setUserContext(e){}shutdown(){}loadFull(){return Promise.resolve()}loadAsha(){}};var x,L=s(43644),z=s(46630),j=s(7744);!function(e){e.DataClassification={EssentialServiceMetadata:1,AccountData:2,SystemMetadata:4,OrganizationIdentifiableInformation:8,EndUserIdentifiableInformation:16,CustomerContent:32,AccessControl:64,PublicNonPersonalData:128,EndUserPseudonymousInformation:256,PublicPersonalData:512,SupportData:1024,DirectMeasurementData:2048,Everything:65535},e.DataFieldType={String:0,Boolean:1,Int64:2,Double:3,Guid:4},e.SamplingPolicy={NotSet:0,Measure:1,Diagnostics:2,CriticalBusinessImpact:191,CriticalCensus:192,CriticalExperimentation:193,CriticalUsage:194},e.PersistencePriority={NotSet:0,Normal:1,High:2},e.CostPriority={NotSet:0,Normal:1,High:2},e.DataCategories={NotSet:0,SoftwareSetup:1,ProductServiceUsage:2,ProductServicePerformance:4,DeviceConfiguration:8,InkingTypingSpeech:16},e.DiagnosticLevel={ReservedDoNotUse:0,Required:10,BasicEvent:10,Optional:100,FullEvent:100,RequiredServiceData:110,NecessaryServiceDataEvent:110,RequiredServiceDataForEssentialServices:120,AlwaysOnNecessaryServiceDataEvent:120},e.DnmInterval={Hourly:1,Daily:2},e.AllowedPartA={ReleaseAudienceGroup:1,WacRing:2,AppName:3,AppPlatform:4,AppVersion:5},e.CustomerContentType={None:0,MocaAddIn:1},e.LogLevel={Error:0,Warning:1,Info:2,Verbose:3},e.Category={Core:0,Sink:1,Transport:2},e.PrimaryIdentitySpace={UserObjectId:"UserObjectId",MSACID:"MSACID",OrgIdPuid:"OrgIdPuid",OrgIdCID:"OrgIdCID",MsaPuid:"MsaPuid",WopiAuth:"WopiAuth",ThirdParty:"ThirdParty"},e.AudienceGroup={Automation:"Automation",Dogfood:"Dogfood",Microsoft:"Microsoft",Insiders:"Insiders",Production:"Production"}}(x||(x={}));var B,q,G=s(40900),U=s(31065);!function(e){e.Open="Open",e.Interruptions="Interruptions",e.VetoMissingClassification="VetoMissingClassification"}(B||(B={})),function(e){e.LoadFailed="LoadFailed",e.UnhandledError="UnhandledError",e.UnhandledRejection="UnhandledRejection"}(q||(q={}));const V=[{pillar:B.Open,vetos:[q.LoadFailed]},{pillar:B.Interruptions,vetos:[q.UnhandledError,q.UnhandledRejection]}];function H(e){for(let t of V)if(t.vetos.includes(e))return t.pillar;return B.VetoMissingClassification}const X={token:"6a8929bcfc6d44e9b13fee392ada9cf0-4dea6a88-32c5-404b-8af1-4a43b94ef559-7393",namespacePrefix:"Office.Fluid"},$={token:"742fa5a288b045e5beab1a2b8e445a71-66618038-43f3-4a1f-a680-59d90da7d572-7251",namespacePrefix:"Office.Fluid"};class W{constructor(e,t){this.initialPersistentProps=t,this.ashaLoadStarted=!1,this.telemetryLogger=new L.Dw(void 0,void 0,this.getTelemetryConfig(e)),this.telemetryLogger.partAFields.push((0,z.dt)("Loop.Audience",e)),this.ariaInfo=function(e){return function(){let e=!1;try{e=!!localStorage.getItem("FluidCodeDetailsOverride")}catch{}return e}()||function(e){return"Local"===e||"Automation"===e}(e)?$:X}(e),this.telemetryLogger.setTenantToken(this.ariaInfo.namespacePrefix,this.ariaInfo.token,L.Vp),this.isNonProductionAudience(e)&&this.registerOtelErrorsListener()}async logEvent(e){let{namespace:t,category:s,props:r}=e;if(s===R.J.UserAction)this.logUserActionEventToOtel(e);else if(s===R.J.Activity)this.logActivityEventToOtel(e);else{if(["AshaPillarAdd","AshaPillarRemove","AshaError"].includes(r.eventName))return this.loadAsha(),void this.ashaUtils?.then((({handleAshaEvent:t})=>t(e))).catch((()=>{this.logDefaultEventToOtel({category:R.J.Error,namespace:t,props:{eventName:`${r.eventName}Failure`}})}));s===R.J.Error&&function(e){return"eventName"in e&&"veto"in e}(r)&&(r=function(e){return{...e,pillar:e.pillar??H(e.veto),isIntentional:e.isIntentional??!1,isInternal:e.isInternal??!0,alertOnPillar:e.alertOnPillar??!0,isSessionEndingError:e.isSessionEndingError??!1}}(r)),this.logDefaultEventToOtel({namespace:t,category:s,props:r})}}shutdown(){this.ashaUtils?.then((({shutdownAshaForFluid:e})=>e())).catch((()=>{this.logDefaultEventToOtel({category:R.J.Error,props:{eventName:"AshaShutdownFailure"}})}))}logDefaultEventToOtel(e){this.logEventToOtelInternal(e,(t=>{this.prepareDefaultOtelEvent(t,e)}))}logActivityEventToOtel(e){this.logEventToOtelInternal(e,(t=>{this.prepareActivityOtelEvent(t,{...e.props})}))}logUserActionEventToOtel(e){this.logEventToOtelInternal(e,(t=>{this.prepareUserActionOtelEvent(t,{...e.props},e.namespace)}))}getTelemetryConfig(e){const t={enableQueue:!0};return this.isNonProductionAudience(e)?t:{...t,disableValidation:!0}}isNonProductionAudience(e){return"Automation"===e||"Local"===e||"Staging"===e}registerOtelErrorsListener(){(0,j.kr)().addListener((e=>{0===e.category&&0===e.level&&console.error(e.message())}))}getDataFieldsFromProps(e){let t=[];return Object.keys(e).forEach((s=>{const r=(0,U.r)(e[s],s);r&&t.push(r)})),t}logEventToOtelInternal(e,t){const s=this.getBasicOtelEvent(e);t(s),this.telemetryLogger.sendTelemetryEvent(s)}getBasicOtelEvent(e){let t=e.category&&`${e.category.charAt(0).toUpperCase()}${e.category.substring(1)}`;return e.props.subCategory&&e.category===R.J.Generic&&(t+=`.${e.props.subCategory.charAt(0).toUpperCase()}${e.props.subCategory.substring(1)}`),{eventName:`${this.ariaInfo.namespacePrefix}${e.namespace?"."+e.namespace:""}.${t}`,eventFlags:{diagnosticLevel:x.DiagnosticLevel.RequiredServiceData}}}prepareDefaultOtelEvent(e,t){e.eventFlags.dataCategories=x.DataCategories.ProductServicePerformance,e.dataFields=this.getDataFieldsFromProps({...t.props})}mapActivityResultTypeToCode(e){switch(e){case R.u.Failure:return 0;case R.u.Success:return 1;case R.u.Cancelled:return 2}}prepareBaseActivityOtelEvent(e,t,s){t.durationMs||(t.durationMs=0);const r=Math.floor(1e3*t.durationMs),{durationMs:i,succeeded:n,resultType:a,...o}=t;return e.eventContract={name:G.cS.contractName,dataFields:G.cS.getFields({duration:r,count:1,aggMode:0,success:n,result:!s&&a?{code:this.mapActivityResultTypeToCode(a),type:a}:void 0})},o}prepareActivityOtelEvent(e,t){const s=t.eventName;e.eventName+=`.${s.charAt(0).toUpperCase()}${s.substring(1)}`,e.eventFlags.dataCategories=x.DataCategories.ProductServicePerformance;const r=this.prepareBaseActivityOtelEvent(e,t,!1);e.dataFields=this.getDataFieldsFromProps(r||{})}prepareUserActionOtelEvent(e,t,s){const r=t.eventName;e.eventName+=`.${r.charAt(0).toUpperCase()}${r.substring(1)}`,e.eventFlags.dataCategories=x.DataCategories.ProductServiceUsage;const i=G.oe.getFields("Funnel",{name:s,state:"Successful"}),n=t,a=G.Vw.getFields({id:n.actionId,name:r,commandSurface:n.commandSurface,parentName:n.parentName,triggerMethod:n.triggerMethod,timeOffsetMs:n.timeOffsetMs}),o=this.prepareBaseActivityOtelEvent(e,t,!0),{eventName:c,actionId:u,commandSurface:l,parentName:h,triggerMethod:d,timeOffsetMs:m,...p}=o;e.dataFields=[...i,...a,...this.getDataFieldsFromProps(p||{})]}loadAsha(){this.ashaLoadStarted||(this.ashaLoadStarted=!0,this.ashaUtils=s.e(49576).then(s.bind(s,27839)),this.ashaUtils.then((({initializeAshaForFluid:e})=>e(this.ariaInfo.namespacePrefix,this.initialPersistentProps,(e=>{delete e.eventContract,this.telemetryLogger.sendTelemetryEvent(e)})))).catch((()=>{this.ashaLoadStarted=!1,this.logDefaultEventToOtel({category:R.J.Error,props:{eventName:"AshaLoadFailure"}})})))}}class J extends W{constructor(e,t,s){super(t,s),this.hostTelemetrySink=e,this.telemetryLogger.addSink(this.hostTelemetrySink)}setUserContext(e){}async loadFull(){}}class K extends W{constructor(e,t){super(e.audience,t),this.context=e,this.loadFullCalled=!1}async logEvent(e){return e.category===R.J.Error&&(this.loadFullCalled||this.loadFull().catch((()=>{}))),super.logEvent(e)}setUserContext(e){this.context={...this.context,...e},this.telemetrySink?.setPartADataFields(this.context)}shutdown(){super.shutdown(),this.loadFull().then((()=>this.telemetrySink?.shutdown())).catch((()=>{}))}async loadFull(){this.loadFullCalled||(this.loadFullCalled=!0,Promise.all([s.e(4992),s.e(73206)]).then(s.bind(s,50869)).then((e=>{this.telemetrySink=new e.OfficeFluidOneDsSink(this.context),this.telemetryLogger.addSink(this.telemetrySink.createOneDsSink()),this.telemetryLogger.flushQueue()})).catch((e=>{this.logDefaultEventToOtel({category:R.J.Error,props:{eventName:"LoggerLoadFailure",message:e.message,stack:e.stack}})})))}}class Q extends class{constructor(e,t){this.namespace=t,this.persistentProps=e||{},this.namespace=t}get NamespaceLogger(){return this}get PersistedProperties(){return this}send(e){this.sendWithNamespace(e,this.namespace)}sendWithNamespace(e,t){const s=t||this.namespace;let{category:r,...i}={...this.persistentProps,...e};const n=Object.keys(i).length>100;"error"!==r&&"Error"!==r||(i=(e=>{let t;return"string"==typeof e.message&&e.message.length>M&&(t="message",e.message=e.message.substr(0,M)),"string"==typeof e.stack&&e.stack.length>M&&(t=t?t.concat(", stack"):"stack",e.stack=e.stack.substr(0,M)),t?{...e,cappedFields:t}:e})(i)),this.logEvent({category:r,props:{...i,exceedsMaxAllowedFields:n},namespace:s})}addPersistedProperties(e){this.persistentProps={...this.persistentProps,...e}}}{constructor(e){const t={...e.persistentProps,hostCorrelationId:e.hostContextProps.hostCorrelationId,hostScenarioName:[e.hostContextProps.hostScenarioLifecycle,e.hostContextProps.hostScenarioName,e.hostContextProps.hostScenarioEntryPoint].filter((e=>e)).join("_"),hostName:e.hostContextProps.hostName,hostScenarioStartTime:e.hostContextProps.hostScenarioStartTime,loopAudience:e.hostContextProps.audience};super(t,e.namespace),this.forceTelemetryToConsole=!1,this.shutdown=()=>{this.logProcessor.shutdown()};const{hostContextProps:s,delayLoadLogger:r,hostTelemetrySink:i}=e;this.audience=s.audience;try{this.forceTelemetryToConsole="1"===localStorage.getItem("debugPurple")}catch{}if(i?this.logProcessor=new J(i,this.audience,t):(this.logProcessor=new K({appPlatform:s.hostAppPlatform,appName:s.hostAppName,appVersion:s.hostAppVersion,user:s.userContext.user,sessionId:s.hostSessionId,audience:s.audience,uiLanguage:s.hostLocaleContext?.uiLanguage},t),r||this.loadFull().catch((()=>{}))),e.hostMetadata){const{hostMetadata:t}=e,s=t.hostFlights;this.sendWithNamespace({eventName:"HostMetadata",hostRing:t.hostRing,hostFlights:s&&JSON.stringify(s),category:"Generic"},"HostMetadata")}}get PersistedProperties(){return this}async loadFull(){try{await this.logProcessor.loadFull()}catch{}}setUserContext(e){this.logProcessor.setUserContext(e)}logEvent(e){this.forceTelemetryToConsole&&F.logEvent(e),this.logProcessor.logEvent(e)}addPersistedProperties(e){super.addPersistedProperties(e),s.e(49576).then(s.bind(s,27839)).then((({updateAshaAdditionalPartCEventDataFromTelemetryProperties:t})=>t(e))).catch((()=>{this.send({category:"Error",eventName:"AshaUpdatePartCEventDataFailure"})}))}}let Z=[],Y=!1,ee=!1;function te(){if(!Y){if(window.requestIdleCallback)window.requestIdleCallback(re);else{const e=Date.now()+50;window.setTimeout((()=>re({timeRemaining:()=>Math.max(e-Date.now(),0),didTimeout:!1})),0)}Y=!0}}function se(e,t){let s=[];for(let r=0;r<Z.length;r+=1){if(t&&!t()){s.push(...Z.slice(r));break}const i=Z[r];e&&!e(i)?s.push(i):i.task()}Z=s}function re(e){se(void 0,(()=>e.timeRemaining()>10)),Y=!1,Z.length>0&&te()}class ie{constructor(){}get HostContext(){return this}get audience(){return"Automation"}get hostName(){return"Mock Container Logger HostContext"}get hostAppName(){return"Demo App"}get hostAppPlatform(){return"Web"}get hostCorrelationId(){return"0"}get hostSessionId(){return"0"}get userContext(){return{user:{id:"0",tenantId:"0",userIdSpace:"OrgIdPuid"}}}get hostScenarioName(){return"Mock Container Logger Host Context"}}var ne=s(73228),ae=s(40923);function oe(e){return{pattern:e.source,flags:e.flags}}const ce=new Map;let ue=!1,le=0;function he(){if(document.hidden){const e=Date.now();ce.forEach(((t,s)=>{-1===t&&ce.set(s,e)})),de()}}function de(){ue=!1,document.removeEventListener("visibilitychange",he)}function me(){return le+=1,function(e){document.hidden?ce.set(e,0):(ue||(ue=!0,document.addEventListener("visibilitychange",he)),ce.set(e,-1))}(le),le}function pe(e,t){const s=ce.get(e);return t&&ge(e),s}function ge(e){ce.delete(e),0===ce.size&&ue&&de()}class fe{constructor(e,t,s){this.componentRegistry=e,this.synthesizer=t,this.loggerPromise=s,this.dataStoreProvider=t.synthesize({DataStoreService:"DataStoreService"},void 0),this.registryDependencyProvider=t.synthesize({TokenProvider:b.B7,SettingsProvider:b.mu,CardChannelProvider:b.YR,MetaOSProvider:b.Dl,LinkService:b.Mv,OptionalConnectedServicesPolicyProvider:b.U$},void 0),this.loggerPromise?.then((e=>this.logger=e)).catch((()=>{}))}async createComponentFromRegistry(e,t){const s=e[0];let r;const i=this.componentRegistry.get(s),a=n.a.start("CreateLoop",this.logger,{addUserTiming:!0}),o=me();if("FluidObject"===i?.factory.type){const s=await this.dataStoreProvider.DataStoreService;r=await(s?.createComponentFromRegistry(e,t).catch((()=>{})))}else if("LoopObject"===i?.factory.type){const e=await i.factory.factory;r=await e.instantiateLoopComponent(t,this.synthesizer)}return r?(()=>{const e=pe(o,!0);a.setResult(!0,{componentType:s,creationType:"Registry",documentHidden:e>-1})})():(ge(o),a.setResult(!1,{componentType:s,creationType:"Registry"})),r}async createComponentFromDataProvider(e){const t=n.a.start("CreateLoop",this.logger,{addUserTiming:!0}),s=me(),r=r=>{const i=pe(s,!0);t.setResult(!0,{componentType:r,creationType:"DataProvider",creationDataType:e.dataType,documentHidden:i>-1})};for(const[t,s]of this.componentRegistry.entries())if(s.dataCreationInfo)for(const i of s.dataCreationInfo)try{if(i.dataType===e.dataType&&await(i.canHandleData?.(e.data,this.registryDependencyProvider))){if("FluidObject"===s.factory.type){const s=await this.dataStoreProvider.DataStoreService,i=await(s?.createComponentFromDataProvider(e));return r(t),i}if("LoopObject"===s.factory.type){const i=await s.factory.factory,n={creationData:e},a=await i.instantiateLoopComponent(n,this.synthesizer);return r(t),a}}}catch(e){}ge(s),t.setResult(!1,{creationType:"DataProvider",creationDataType:e.dataType})}}const ye="GetLoopPreviewData",ve=/\/:fl:\/.*(?:\?|&)nav=/;class be extends ne.L{static getFactory(){return this.factory}async hasInitialized(){const e=this.context.scope,t=this.providers.NamespaceLogger?.then((e=>e?new I.g("CatalogRootDataObject",e):void 0)).catch((()=>{}));this.loopFetcher=new fe(it(),e.IFluidDependencySynthesizer,t),this.logger=await t}get LoopComponentRouter(){return this}get DataRequestCreator(){return this}registerDataRequestCallback(e){this.dataRequestCallback=e}async getLoopComponent(e){if("Data"===e.type){const{type:t,...s}=e;return await(this.loopFetcher?.createComponentFromDataProvider(s))}return await(this.loopFetcher?.createComponentFromRegistry([e.loopType],e.loopConfig))}async getLoopUrlRegexes(){const e=it().values(),t=[];for(let s of e)if(void 0!==s.urlRegexes)try{t.push(s.urlRegexes(this.context.scope).catch((e=>Promise.resolve([]))))}catch(e){}const s=(await Promise.all(t)).reduce(((e,t)=>(t.forEach((t=>e.push(oe(t)))),e)),[oe(ve)]);return this.logger&&(0,u.ve)(this.logger,{eventName:"GetLoopUrlRegexes",urlRegexListLength:`${s.length}`}),s}async getLoopPreviewData(e){const t=await this.ensureDiscoverData();for(let s of t)if(s.queryableData.manifest&&s.queryableData.manifest.find((async t=>await(t.canHandleData?.(e,this.getRegistryDependencies())))))return this.logger&&(0,u.ve)(this.logger,{eventName:ye,subCategory:"MatchFound"}),[s];return this.logger&&(0,u.ve)(this.logger,{eventName:ye,subCategory:"NoMatchFound"}),[]}async getLoopRegistryData(){const e=it().values(),t=[],s=this.getRegistryDependencies();for(const r of e)r.getRegistryData&&t.push(r.getRegistryData(s).catch((async e=>[])));return(await Promise.all(t)).flat()}getRegistryDependencies(){return this.context.scope.IFluidDependencySynthesizer.synthesize({TokenProvider:b.B7,SettingsProvider:b.mu,CardChannelProvider:b.YR,MetaOSProvider:b.Dl,OptionalConnectedServicesPolicyProvider:b.U$,LinkService:b.Mv},void 0)}async ensureDiscoverData(){return void 0===this.discoverData&&(this.discoverData=await new Promise((async(e,t)=>{if(void 0!==this.dataRequestCallback){const t=await this.dataRequestCallback("DiscoverData"),s=await Promise.all(t),r=[];s.forEach((e=>{e.length>0&&r.push(...e)})),e(r)}else t()}))),this.discoverData}}be.factory=new ae.c("CatalogRootComponent",be,[],{NamespaceLogger:"NamespaceLogger"});const Se={factory:{type:"FluidObject",factory:new i.d((()=>Promise.resolve(be.getFactory())))}};var Ce=s(59939);const we=e=>(0,Ce.__awaiter)(void 0,void 0,void 0,(function*(){return new((yield Promise.all([s.e(5684),s.e(39659),s.e(41949)]).then(s.bind(s,73413))).CardLoopLogger)(e)}));var Te=s(51922),Ne=s(88490);const Pe={storeUnfurlStore(e,t,s){const r=Ee(void 0!==s);if(!r||!e||!t)return;const i=`${Te.Xf}${s}-${t}`,n={unfurlDomains:Array.from(e),expiry:De()+Te.mJ};try{r.setItem(i,JSON.stringify(n))}catch(e){}},getUnfurlStore(e,t){const s=Ee(void 0!==t);if(!s||!e)return;const r=`${Te.Xf}${t}-${e}`,i=s.getItem(r);try{const e=i?JSON.parse(i):null;if(e&&De()<=e.expiry)return new Map(e.unfurlDomains);s.removeItem(r)}catch(e){s.removeItem(r)}},doesCacheContainValidStore(e,t){return void 0!==this.getUnfurlStore(e,t)}};function Ee(e){return e?null===window||void 0===window?void 0:window.localStorage:null===window||void 0===window?void 0:window.sessionStorage}function De(){return Math.floor((new Date).getTime())}var Oe=s(28803);const ke=(e,t)=>(0,Ce.__awaiter)(void 0,void 0,void 0,(function*(){var s,r,i,n;try{const a=null===(i=null===(r=null===(s=e.HostContext)||void 0===s?void 0:s.userContext)||void 0===r?void 0:r.user)||void 0===i?void 0:i.id,[o,c]=yield(0,Ne.P)(e,t);if(Pe.doesCacheContainValidStore(c,a)){const e=Pe.getUnfurlStore(c,a);yield Oe.J.populateStore(e)}else{const e=t.startPerfEvent("UserConfig"),s=yield null===(n=null==o?void 0:o.getUnfurlableDomains)||void 0===n?void 0:n.call(o);e.end(),Pe.storeUnfurlStore(s,c,a),yield Oe.J.populateStore(s)}}catch(e){}}));var _e=s(47667);const Ae=e=>(0,_e.L5)(Te.TP.ComponentEnabled,!1,e);var Ie=s(17201);const Me={factory:{type:"LoopObject",factory:new i.d((()=>Promise.all([s.e(9685),s.e(93675),s.e(5684),s.e(39659),s.e(86398),s.e(92372)]).then(s.bind(s,49591)).then((e=>e.CardLoop))))},dataCreationInfo:[{dataType:b.en,canHandleData:function(e,t){return(0,Ce.__awaiter)(this,void 0,void 0,(function*(){const s=yield null==t?void 0:t.SettingsProvider;if(!Ae(s))return!1;(0,Ie.C)(s);const r=yield we("URL"),i=r.startPerfEvent("CanHandleData"),[n,a,o]=yield Promise.all([null==t?void 0:t.MetaOSProvider,null==t?void 0:t.TokenProvider,null==t?void 0:t.CardChannelProvider]);yield ke({TokenProvider:a,MetaOSProvider:n,CardChannelProvider:o,SettingsProvider:s},r);const c=yield Oe.J.canHandleUrl(e.url,n,r);return r.logEvent({eventType:"info",eventName:"CanHandleData",metaData:JSON.stringify(c)}),i.end(),c}))}},{dataType:b.mI,canHandleData:function(e,t){return(0,Ce.__awaiter)(this,void 0,void 0,(function*(){if(e.registrationId!==Te.AF)return!1;const s=yield null==t?void 0:t.SettingsProvider;if(!Ae(s))return!1;(0,Ie.C)(s);const r=yield we("Card");return e.cardId&&(r.correlationId=e.cardId),!0}))}}],urlRegexes:function(e){return new i.d((()=>(0,Ce.__awaiter)(this,void 0,void 0,(function*(){if(!Ae(e.SettingsProvider))return[];(0,Ie.C)(e.SettingsProvider);const t=yield we("Unknown");return t.HostContext=e.HostContext,yield ke({TokenProvider:e.TokenProvider,MetaOSProvider:e.MetaOSProvider,CardChannelProvider:e.CardChannelProvider,SettingsProvider:e.SettingsProvider},t),Oe.J.regexList}))))},providersToPreload:["CardChannelProvider","MetaOSProvider","SettingsProvider","StylingProvider"]};var Re=s(83487),Fe=s(29364);function xe(e){return(0,Ce.__awaiter)(this,void 0,void 0,(function*(){if((0,Fe.checkVersionOverride)()){const{getLoopRegexes:t}=yield(0,Fe.overrideGraphPrefetch)();return t(e)}const{getLoopRegexes:t}=yield Promise.all([s.e(5684),s.e(39659),s.e(53096),s.e(36591),s.e(72887)]).then(s.bind(s,17530));return t(e)}))}let Le;const ze={factory:{type:"LoopObject",factory:(0,Fe.checkVersionOverride)()?new i.d((()=>(0,Fe.overrideGraph)().then((e=>e.GraphLoop)))):new i.d((()=>Promise.all([s.e(9685),s.e(93675),s.e(5684),s.e(39659),s.e(53096),s.e(36591),s.e(74688),s.e(98478)]).then(s.bind(s,43784)).then((e=>e.GraphLoop))))},dataCreationInfo:[{dataType:"URL",canHandleData:function(e,t){return(0,Ce.__awaiter)(this,void 0,void 0,(function*(){const s=yield null==t?void 0:t.SettingsProvider;if(!(0,_e.L5)(Re.T.ComponentEnabled,!1,s))return!1;if(!Le&&(null==t?void 0:t.TokenProvider)){const e={TokenProvider:yield t.TokenProvider,SettingsProvider:s};Le=yield xe(e)}return!!Le&&Le.some((t=>t.test(e.url.href)))}))}}],urlRegexes:e=>new i.d((()=>Promise.resolve(function(e){return(0,Ce.__awaiter)(this,void 0,void 0,(function*(){return(0,_e.L5)(Re.T.ComponentEnabled,!1,e.SettingsProvider)?(Le=yield xe(e),Le):[]}))}(e)))),preloadLocalizationAssets:function(e){return(0,Ce.__awaiter)(this,void 0,void 0,(function*(){if((0,Fe.checkVersionOverride)()){const{initStrings:t}=yield(0,Fe.overrideGraphPrefetch)();t(Fe.overrideGraphStrings,e)}else{const{initStrings:t}=yield Promise.all([s.e(5684),s.e(39659),s.e(53096),s.e(36591),s.e(72887)]).then(s.bind(s,17530));t(Fe.loadGraphStrings,e)}}))}};var je=s(82298),Be={factory:{type:"LoopObject",factory:new i.d((function(){return Promise.all([s.e(86398),s.e(6161)]).then(s.bind(s,65295)).then((function(e){return e.loopExport}))}))},dataCreationInfo:[{dataType:je.en,canHandleData:function(e,t){return(0,Ce.__awaiter)(this,void 0,void 0,(function(){return(0,Ce.__generator)(this,(function(s){switch(s.label){case 0:return[4,null==t?void 0:t.SettingsProvider];case 1:return Ue("powerAppsPOC.componentEnabled",!1,s.sent())?[2,!!e.url.href.match(Ge)||!!e.url.href.match(qe)]:[2,!1]}}))}))}}],urlRegexes:function(e){var t=this;return new i.d((function(){return(0,Ce.__awaiter)(t,void 0,void 0,(function(){return(0,Ce.__generator)(this,(function(t){return Ue("powerAppsPOC.componentEnabled",!1,e.SettingsProvider)?[2,Promise.resolve([qe,Ge])]:[2,Promise.resolve([])]}))}))}))}},qe=/^https:\/\/.*crm10.dynamics.com.*/,Ge=/^https:\/\/.*crm.dynamics.com.*/;function Ue(e,t,s){return s?s.getSetting(e,t,"FluidExperiences"):t}var Ve=s(82024),He=s(77556);const Xe={discoverData:function(e){return new i.d((async()=>[{queryableData:{displayName:"Polls",icon:"FFXCPoll",keywords:[],description:"Collect quick responses in real time with polls, to engage and drive consensus."}}]))},factory:{type:"LoopObject",factory:new i.d((()=>Promise.all([s.e(80311),s.e(9685),s.e(93675),s.e(52366)]).then(s.bind(s,57744)).then((e=>e.loopExport))))},dataCreationInfo:[{dataType:Ve.en,canHandleData:async function(e){return!!e.url.href.match($e)}}],urlRegexes:function(e){return new i.d((async()=>(0,He.L)("formsLoop.componentEnabled",!1,e.SettingsProvider)?Promise.resolve([$e]):Promise.resolve([])))}},$e=/^https:\/\/forms\.office\.com\/Pages\/ResponsePage\.aspx\?(loop=1&id=[0-9A-Za-z-_=]+|id=[0-9A-Za-z-_=]+&loop=1)$/;var We=s(21383),Je=s(10355);const Ke={factory:{type:"LoopObject",factory:new i.d((()=>Promise.all([s.e(80311),s.e(9685),s.e(86963),s.e(44677),s.e(93675),s.e(13129),s.e(2238),s.e(67421),s.e(35764)]).then(s.bind(s,65997)).then((e=>e.loopExport))))},dataCreationInfo:[{dataType:b.en,canHandleData:async function(e,t){const s=await(t?.SettingsProvider);return!!(0,We.Y)(s)&&(0,Je.y)(e.url)}}],urlRegexes:function(e){return new i.d((async()=>(0,We.Y)(e.SettingsProvider)?[Je.i]:[]))}};var Qe=s(78485);const Ze={factory:{type:"LoopObject",factory:new i.d((()=>Promise.all([s.e(80311),s.e(9685),s.e(86963),s.e(44677),s.e(93675),s.e(13129),s.e(2238),s.e(67421),s.e(61951),s.e(10991)]).then(s.bind(s,20849)).then((e=>e.loopExport))))},dataCreationInfo:[{dataType:b.en,canHandleData:async function(e,t){return s=await(t?.SettingsProvider),(0,Qe.L5)("wxpembed.officeComponent.enabled",!1,s)&&async function(e){const t=e.url;return(!!t.href.match(/^https:\/\/[a-zA-Z0-9\-]+\.sharepoint(-df)?\.com\//)||!!t.href.match(/^https:\/\/1drv.ms/)||!!t.href.match(/^https:\/\/onedrive.live.com/))&&function(e){return!!(e.pathname.match(/^\/:(w|x|p):/)||e.pathname.match(/^\/(w|x|p)\//)||e.pathname.match(/\.(docx|pptx|xlsx)$/)||e.search.match(/\?sourcedoc=/))}(t)}(e);var s}}]};var Ye=s(60273),et=s(11345);const tt={factory:{type:"LoopObject",factory:new i.d((()=>Promise.all([s.e(9685),s.e(13129),s.e(67421),s.e(44739)]).then(s.bind(s,20684)).then((e=>e.loopExport))))},dataCreationInfo:[{dataType:b.en,canHandleData:async function(e,t){const s=await(t?.SettingsProvider);return!!(0,Ye.Y)(s)&&(0,et.D9)(e.url)}}],urlRegexes:function(e){return new i.d((async()=>(0,Ye.Y)(e.SettingsProvider)?[et.xF]:[]))}};var st=s(81051);const rt="RootComponentType",it=()=>new Map([[rt,Se],["PowerAppsComponentType",Be],["CardLoopComponentType",Me],["GraphLoopComponentType",ze],["FormsLoopComponentType",Xe],["YoutubeComponentType",Ke],["OfficeComponentType",Ze],["GoogleDocsComponentType",tt],["VideoComponentType",st.i]]);class nt{constructor(e,t,s){this.componentRegistry=e,this.supportedDataTypes=["DiscoverData"],this.getDiscoverData=async(e,t,s,r)=>e.discoverData?await e.discoverData(s,r):[],this.discoverDataPromise=this.getContainerDiscoverData(t,s)}get DataRequestProcessor(){return this}get IContainerServiceFactory(){return this}instantiateContainerService(){return this}async processDataRequest(e,t){return"DiscoverData"===e?await this.discoverDataPromise:[]}async getContainerDiscoverData(e,t){let s=[],r=new Array;return this.componentRegistry.forEach(((i,n)=>{r.push(this.getDiscoverData(i,n,e,t).then((e=>{e.forEach((e=>{let t={queryableData:{...e.queryableData,manifest:i.dataCreationInfo},loaderData:{componentType:[n],initialConfiguration:e.initialConfiguration},isComponentData:!0};e.getBlueprintHtml&&(t={...t,blueprintData:{componentType:[n],getBlueprintHtml:e.getBlueprintHtml}}),s.push(t)}))})))})),await Promise.all(r),s}}r();class at{constructor(e){this.logger=e}get NamespaceLogger(){return this}get IContainerServiceFactory(){return this}instantiateContainerService(){return this}send(e){this.logger.send(e)}sendWithNamespace(e,t){this.logger.sendWithNamespace(e,t)}}r();var ot=s(44364);const ct=new class{constructor(e){this.optionalProviders=e,this.type="LoopObject"}async instantiateLoopComponent(e,t){const s=e;if(!s)throw new Error("Cannot instantiate loop component. Loop router input is invalid.");const r=this.optionalProviders&&t?.synthesize(this.optionalProviders,void 0)||void 0;if(!this.loopFetcher){const e=r?.NamespaceLogger?.then((e=>e?new I.g("CatalogFactory",e):void 0)).catch((()=>{}));this.loopFetcher=new fe(it(),t||new c.Q,e)}let i;if(function(e){return!!e&&"object"==typeof e&&"creationData"in e}(s)?s.creationData&&(i=await this.loopFetcher.createComponentFromDataProvider(s.creationData)):i=await this.loopFetcher.createComponentFromRegistry([s.loopType],s.loopConfig),!i)throw new Error("Could not create loop component.");return i}}({NamespaceLogger:"NamespaceLogger",SettingsProvider:"SettingsProvider"});r();const ut=new class{get IRuntimeFactory(){return this}async instantiateRuntime(e,t){const s=new y,r=((e,t)=>new Map([...e].map((([e,t])=>[e,a(e,t,undefined)]))))(it()),n=new y,o=new ot.M(n),d=function(e,t){const s=new c.Q(e.IFluidDependencySynthesizer);return function(e,t,s){for(const r in t)if(!e.has(r)){const n=t[r];e.register(r,new i.d((()=>l(r,n,s))))}}(s,e,t),function(e,t,s){const r=new Map([["InformationProtectionServicePromise","InformationProtectionService"],["LinkServicePromise","LinkService"],["NotificationServicePromise","NotificationService"],["PeopleServicePromise","PeopleService"],["ShareServicePromise","ShareService"]]),n=[];for(const[s,a]of r){const r=t[s];r&&!e.has(a)&&(n.push(s),e.register(a,new i.d((async()=>{const e=await r;return e&&void 0===e[a]&&(e[a]=e),e}))))}n.length>0&&s&&(0,u.ve)(s,{eventName:"ConvertPromiseProviderToNewProvider",message:`Promise providers dependencies: '${n.toString()}' were converted to the new provider contracts.`})}(s,e,t),function(e,t){const s=t;void 0!==s.doNotUse_WorkspaceRosterIdPromise&&e.register("RosterLWGProvider",new h(s.doNotUse_WorkspaceRosterIdPromise))}(s,e),s}(e.scope,o),m=d.synthesize({HostContext:"HostContext",TelemetryConfig:"TelemetryConfig",NamespaceLogger:"NamespaceLogger"},void 0),p=await m.HostContext,g=await m.TelemetryConfig,f=(0,A.jR)(p?.hostLocaleContext?.uiLanguage);let v;e.clientDetails.capabilities.interactive&&!g?.disallowServiceTelemetry&&(v=await(async(e,t,s)=>{let r;try{r=e?.id}catch(e){}const i={docId:r,codeVersion:undefined},n=await t.NamespaceLogger;if(n)return new I.g("CatalogContainer",n,i);const a=await t.HostContext??new ie,o=new Q({hostContextProps:a,persistentProps:i,namespace:"CatalogContainer",delayLoadLogger:!0});return c=()=>{o.loadFull().catch((()=>{}))},u={ensureExecution:!0},Z.push({ensureExecution:!0===u?.ensureExecution,task:c}),u?.ensureExecution&&!ee&&(document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&se((e=>e.ensureExecution))})),ee=!0),te(),o;var c,u})(e,m),n.resolve(v));try{const n=await _(e,r,function(e,t){return new Map([["RegistryService",{factory:new i.d((()=>Promise.resolve(new nt(e,t)))),processes:["DiscoverData"]}]])}(r,f),function(e,t){let s=new Map([]);return t&&s.set("NamespaceLogger",{factory:new i.d((()=>Promise.resolve(new at(t))))}),s}(0,v),void 0,v,void 0,d,f);return void 0===t||t||await(async(e,t,s,r)=>{try{const t=e.scope.IFluidDependencySynthesizer?.synthesize({DataStoreService:"DataStoreService"},void 0),s=await(t?.DataStoreService);let r,i;return await(s?.checkComponentExists("/"))&&(i=await(s?.getFluidHandle("/"))),r=i?await(s?.loadComponent(i)):await(s?.createComponentFromRegistry(["RootComponentType"],void 0,!0).catch((()=>{}))),r}catch(e){throw e}})(n),s.resolve(n),n}catch(e){throw e}}};window.catalogContainer={fluidExport:ut,loopExport:ct}},60273:(e,t,s)=>{"use strict";s.d(t,{Y:()=>i});var r=s(78485);function i(e){return(0,r.L5)("loop.googleDocs.enabled",!1,e)}},11345:(e,t,s)=>{"use strict";s.d(t,{Ch:()=>c,D9:()=>a,HS:()=>o,xF:()=>i});var r=s(60273);const i=/https?:\/\/(www\.)?docs\.google\.com\/(presentation)\/d\/(e\/)?[\w\d\-]*\/?/;function n(e){return e.href.match(i)}function a(e){return!!e.href.match(i)}function o(e){const t=n(e);if(t)switch(t[2]){case"document":case"spreadsheets":case"presentation":case"forms":return t[2]}}async function c(e,t){if(!(0,r.Y)(t))throw Error("Feature not enabled");if(!a(e))throw Error("Attempting to resolve a non-GoogleDocs link w/ a GoogleDocs resolver");let s=e.toString();if("published"===function(e){const t=n(e);return t&&t[0]?t[3]?"published":"unpublished":"none"}(e))s=e.origin+e.pathname+"?embedded=true";else{s=e.toString()+"?embedded=true";const t=e.toString().match(i);if(!t)throw Error("regex should match");s=t[0]}const c=await fetch(s,{referrerPolicy:"no-referrer"}),u="accounts.google.com"===new URL(c.url).host,l=await c.text();return{title:(new DOMParser).parseFromString(l,"text/html").querySelector("title")?.text??s,embeddedSrc:s,isPrivateDoc:u,documentType:o(e)}}},24115:(e,t,s)=>{"use strict";s.d(t,{PA:()=>i,Ur:()=>a,Bi:()=>n});const r={FFXCCalendar:{rtlIconName:"FFXCCalendarMirrored"},FFXCClipboardList:{rtlIconName:"FFXCClipboardListMirrored"},FFXCBulletedList:{rtlIconName:"FFXCBulletedListMirrored"},FFXCNumberedList:{rtlIconName:"FFXCNumberedListMirrored"},FFXCChecklist:{rtlIconName:"FFXCChecklistMirrored"},FFXCChevronRight:{rtlIconName:"FFXCChevronLeft"},FFXCIncreaseIndent:{rtlIconName:"FFXCIncreaseIndentMirrored"},FFXCDecreaseIndent:{rtlIconName:"FFXCDecreaseIndentMirrored"},FFXCSeeMore:{rtlIconName:"FFXCSeeMoreMirrored"},FFXQuickSync:{rtlIconName:"FFXQuickSyncMirrored"},FFXCBody:{rtlIconName:"FFXCBodyMirrored"},FFXCBold:{localizedIconNames:{"bg-bg":"FFXCBoldBulgarian","ca-es":"FFXCBoldN","da-dk":"FFXCBoldF","de-de":"FFXCBoldF","es-es":"FFXCBoldN","es-mx":"FFXCBoldN","et-ee":"FFXCBoldP","eu-es":"FFXCBoldN","fr-ca":"FFXCBoldG","fr-fr":"FFXCBoldG","gl-es":"FFXCBoldN","hu-hu":"FFXCBoldF","it-it":"FFXCBoldG","kk-kz":"FFXCBoldKazakh","ko-kr":"FFXCBoldKorean","lt-lt":"FFXCBoldP","lv-lv":"FFXCBoldT","ms-my":"FFXCBoldT","nb-no":"FFXCBoldF","nn-no":"FFXCBoldF","pt-br":"FFXCBoldN","pt-pt":"FFXCBoldN","ru-ru":"FFXCBoldRussian","sl-si":"FFXCBoldK","sr-cyrl-rs":"FFXCBoldSerbian","sr-latn-rs":"FFXCBoldP","sv-se":"FFXCBoldF","tr-tr":"FFXCBoldK","uk-ua":"FFXCBoldRussian"}},FFXCItalic:{localizedIconNames:{"bg-bg":"FFXCItalicK","ca-es":"FFXCItalicK","da-dk":"FFXCItalicK","de-de":"FFXCItalicK","es-es":"FFXCItalicK","es-mx":"FFXCItalicK","et-ee":"FFXCItalicK","eu-es":"FFXCItalicK","gl-es":"FFXCItalicK","hu-hu":"FFXCItalicD","it-it":"FFXCItalicC","kk-kz":"FFXCItalicKazakh","ko-kr":"FFXCItalicKorean","lt-lt":"FFXCItalicK","lv-lv":"FFXCItalicS","nb-no":"FFXCItalicK","nn-no":"FFXCItalicK","ru-ru":"FFXCItalicK","sl-si":"FFXCItalicL","sr-cyrl-rs":"FFXCItalicK","sr-latn-rs":"FFXCItalicK","sv-se":"FFXCItalicK","tr-tr":"FFXCItalicT","uk-ua":"FFXCItalicK"}},FFXCFontColor:{localizedIconNames:{"ko-kr":"FFXCFontColorKorean"}},FFXCStrikethrough:{localizedIconNames:{"ko-kr":"FFXCStrikethroughKorean"}},FFXCUnderline:{localizedIconNames:{"bg-bg":"FFXCUnderlineSerbian","ca-es":"FFXCUnderlineS","es-es":"FFXCUnderlineS","es-mx":"FFXCUnderlineS","et-ee":"FFXCUnderlineA","eu-es":"FFXCUnderlineS","fr-ca":"FFXCUnderlineS","fr-fr":"FFXCUnderlineS","gl-es":"FFXCUnderlineS","hu-hu":"FFXCUnderlineA","it-it":"FFXCUnderlineS","kk-kz":"FFXCUnderlineA","ko-kr":"FFXCUnderlineKorean","lt-lt":"FFXCUnderlineP","lv-lv":"FFXCUnderlineP","pt-br":"FFXCUnderlineS","pt-pt":"FFXCUnderlineS","ru-ru":"FFXCUnderlineRussian","sl-si":"FFXCUnderlineP","sr-cyrl-rs":"FFXCUnderlineSerbian","sr-latn-rs":"FFXCUnderlineP","tr-tr":"FFXCUnderlineA","uk-ua":"FFXCUnderlineSerbian"}}},i=(e,t)=>{const s=r[e];if(void 0===t||void 0===s)return e;const i=function(e){return function(e){switch(e){case"ar-sa":case"fa-ir":case"he-il":case"ug-cn":case"ur-pk":return"rtl";default:return"ltr"}}(e)}(t);return"rtl"===i&&s.rtlIconName?s.rtlIconName:void 0!==s.localizedIconNames?.[t]?s.localizedIconNames[t]??e:e},n=e=>e,a=e=>e},30105:(e,t,s)=>{"use strict";s.d(t,{B7:()=>u,Dl:()=>d,Lb:()=>a,Mv:()=>m,U$:()=>p,YR:()=>h,bw:()=>o,en:()=>i,mI:()=>r,mu:()=>l,nP:()=>n,og:()=>c});const r="Card",i="URL",n="application/vnd.microsoft.card.adaptive",a="application/vnd.microsoft.card.hero",o="application/vnd.microsoft.card.thumbnail",c="application/vnd.microsoft.teams.card.o365connector",u="TokenProvider",l="SettingsProvider",h="CardChannelProvider",d="MetaOSProvider",m="LinkService",p="OptionalConnectedServicesPolicyProvider"},40923:(e,t,s)=>{"use strict";s.d(t,{c:()=>K,R:()=>J});var r=s(25910),i=s(97743),n=s(95336),a=s(67008),o=s(42019),c=s(40544),u=s(44098),l=s(1362),h=s(90682),d=s(58196),m=s(57921),p=s(34628),g=s(53039),f=s(92992),y=s(97495),v=s(57549),b=s(46421),S=s(88628);class C{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,s]of Object.entries(this.gcNodesSet))e[t]=[...s];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[s,r]of Object.entries(t)){let t=s.replace(/^\/+/g,"");t=`/${e}/${t}`,t=t.replace(/\/+$/g,""),this.gcNodesSet[t]=new Set(r)}}addNodes(e){for(const[t,s]of Object.entries(e))this.gcNodesSet[t]=new Set(s)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}var w=s(50084);class T{constructor(e,t,s,r,i){this.objectId=e,this._connected=t,this.submit=s,this.dirty=r,this.addedGCOutboundReference=i}get handler(){return(0,u.h)(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){(0,u.h)(void 0===this._handler,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,s){try{this.handler.process(e,t,s)}catch(t){throw a.Hi.wrapIfUnrecognized(t,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(void 0===this.handler.rollback)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}class N{constructor(e,t,s,r){this.tree=e,this.storage=t,this.logger=s,this.extraBlobs=r,this.flattenedTree={},void 0!==e&&N.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,s){for(const r in t.trees)N.flattenTree(`${e}${r}/`,t.trees[r],s);for(const r in t.blobs)s[`${e}${r}`]=t.blobs[r]}async contains(e){return void 0!==this.flattenedTree[e]}async readBlob(e){const t=await this.getIdForPath(e),s=void 0!==this.extraBlobs?this.extraBlobs.get(t):void 0;if(void 0!==s)return s;const r=this.storage.readBlob(t);return r.catch((e=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},e))),r}async list(e){var t;let s=this.tree;const r=function(e){let t=e;return t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1)),t.length>0?t.split("/"):[]}(e);for(;void 0!==s&&r.length>0;){const e=r.shift();s=s.trees[e]}if(void 0===s||0!==r.length)throw new Error("path does not exist");return Object.keys(null!==(t=null==s?void 0:s.blobs)&&void 0!==t?t:{})}async getIdForPath(e){return this.flattenedTree[e]}}const P=".attributes";function E(e,t,s,r,i,n,a,o,c){return{deltaConnection:new T(e,t,((e,t)=>s(e,t)),r,i),objectStorage:new N(o,n,a,c)}}function D(e,t=!1,s=!1,r){const i=e.getAttachSummary(t,s,r);return(0,S.Rt)(i,P,JSON.stringify(e.attributes)),i}async function O(e,t=!1,s=!1,r){const i=await e.summarize(t,s,r);return(0,S.Rt)(i,P,JSON.stringify(e.attributes)),i}var k=s(70709),_=s.n(k),A=s(52578),I=s(7593);class M{constructor(e,t,s,r){this.id=e,this.registry=t,this.runtime=s,this.servicesGetter=r,this.globallyVisible=!1,this.pending=[],(0,u.h)(!this.id.includes("/"),783)}async getChannel(){return(0,u.h)(void 0!==this.channel,519),this.channel}get isLoaded(){return void 0!==this.channel}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,s){(0,u.h)(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,s):((0,u.h)(!1===t,393),this.pending.push(e))}reSubmit(e,t){(0,u.h)(this.isLoaded,394),(0,u.h)(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){(0,u.h)(this.isLoaded,750),(0,u.h)(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}async summarize(e=!1,t=!1,s){return(0,u.h)(this.isLoaded&&void 0!==this.channel,396),O(this.channel,e,t,s)}getAttachSummary(e){return(0,u.h)(this.isLoaded&&void 0!==this.channel,397),D(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&((0,u.h)(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}async getGCData(e=!1){return(0,u.h)(this.isLoaded&&void 0!==this.channel,403),this.channel.getGCData(e)}updateUsedRoutes(e,t){}}class R extends M{constructor(e,t,s,r,i,n,a,o,c,u){super(e,t,s,(()=>this.services)),this.snapshotTree=u;const l=new Map,h=_()(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(h,l)&&this.sanitizeSnapshot(h),this.services=new I.o((()=>E(this.id,r.connected,a,this.dirtyFn,c,i,n,h,l))),this.dirtyFn=()=>{o(e)}}async getChannel(){return void 0===this.channel&&(this.channel=await this.loadChannel().catch((e=>{throw a.Hi.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)}))),this.channel}async loadChannel(){(0,u.h)(!this.isLoaded,398),(0,u.h)(await this.services.value.objectStorage.contains(".attributes"),400);const e=await(0,A.g)(this.services.value.objectStorage,".attributes");if((0,u.h)(void 0===this.factory,520),this.factory=this.registry.get(e.type),void 0===this.factory)throw new Error(`Channel Factory ${e.type} not registered`);const t=await this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(const e of this.pending)this.services.value.deltaConnection.process(e,!1,void 0);return this.channel}isSnapshotInOldFormatAndCollectBlobs(e,t){let s=!1;const r=e.blobsContents;Object.entries(r).forEach((([r,i])=>{t.set(r,i),void 0!==e.blobs[r]&&(s=!0)}));for(const r of Object.values(e.trees))s=s||this.isSnapshotInOldFormatAndCollectBlobs(r,t);return s}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[s,r]of t.entries())void 0===t.get(r)&&delete e.blobs[s];for(const t of Object.values(e.trees))this.sanitizeSnapshot(t)}}class F extends M{constructor(e,t,s,r,i,n,a,o,c,l){if(super(e,t,r,(()=>this.services)),(0,u.h)(void 0!==s,521),this.factory=t.get(s),void 0===this.factory)throw new Error(`Channel Factory ${s} not registered`);this.channel=this.factory.create(r,e),this.services=new I.o((()=>E(this.id,i.connected,o,this.dirtyFn,l,n,a))),this.dirtyFn=()=>{c(e)}}}var x,L=s(65760);class z{constructor(e,t,s,r,i,n,a,o,c,l,d,m,p){this.runtime=e,this.dataStoreContext=t,this.id=a,this.registry=c,this.attachMessageType=p,this.isLoaded=!1,this.pending=[],(0,u.h)(!this.id.includes("/"),784),this.subLogger=h.G2.create(this.runtime.logger,"RemoteChannelContext"),this.services=E(this.id,this.dataStoreContext.connected,r,(()=>i(this.id)),n,s,this.subLogger,o,l),this.summarizerNode=d((async(e,t,s)=>this.summarizeInternal(e,t,s)),(async e=>this.getGCDataInternal(e)),(async()=>m())),this.thresholdOpsCounter=new L.z(z.pendingOpsCountThreshold,this.subLogger)}getChannel(){return void 0===this.channelP&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}applyStashedOp(e){return(0,u.h)(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}processOp(e,t,s){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,s):((0,u.h)(!t,405),(0,u.h)(void 0!==this.pending,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(e,t){(0,u.h)(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}rollback(e,t){(0,u.h)(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}async summarize(e=!1,t=!0,s){return this.summarizerNode.summarize(e,t,s)}async summarizeInternal(e,t,s){const r=await this.getChannel(),i=await O(r,e,t,s);return Object.assign(Object.assign({},i),{id:this.id})}async loadChannel(){let e,t;if((0,u.h)(!this.isLoaded,407),await this.services.objectStorage.contains(P)&&(e=await(0,A.g)(this.services.objectStorage,P)),void 0===e){if(void 0===this.attachMessageType)throw new a.Jd("channelTypeNotAvailable",{channelId:{value:this.id,tag:h.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:h.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(t=this.registry.get(this.attachMessageType),void 0===t)throw new a.Jd("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:h.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:h.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});e=t.attributes}else if(t=this.registry.get(e.type),void 0===t)throw new a.Jd("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:h.XI.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:h.XI.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:e.type});void 0!==e.snapshotFormatVersion&&e.snapshotFormatVersion!==t.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:e.type,tag:h.XI.PackageData},channelSnapshotVersion:{value:`${e.snapshotFormatVersion}@${e.packageVersion}`,tag:h.XI.PackageData},channelCodeVersion:{value:`${t.attributes.snapshotFormatVersion}@${t.attributes.packageVersion}`,tag:h.XI.PackageData}});const s=await t.load(this.runtime,this.id,this.services,e);(0,u.h)(void 0!==this.pending,575);for(const e of this.pending)this.services.deltaConnection.process(e,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=s,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return(await this.getChannel()).getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""])}}z.pendingOpsCountThreshold=1e3,function(e){e.Attach="attach",e.ChannelOp="op"}(x||(x={}));class j extends o.L{constructor(e,t,s){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new c.B,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,(0,u.h)(!e.id.includes("/"),782),this.logger=h.G2.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:(0,w.Z)()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const r=e.baseSnapshot;this.channelsBaseGCDetails=new c.d((async()=>{var e,t,s;return function(e){const t=new Map;if(void 0===e.gcData)return t;const s=e.gcData.gcNodes;delete s["/"];for(const[e,r]of Object.entries(s)){(0,u.h)(e.startsWith("/"),686);const s=e.split("/")[1];let i=e.slice(s.length+1);""===i&&(i="/");let n=t.get(s);void 0===n&&(n={gcData:{gcNodes:{}},usedRoutes:[]}),(0,u.h)(void 0!==n.gcData,687),n.gcData.gcNodes[i]=[...new Set(r)],t.set(s,n)}if(void 0===e.usedRoutes)return t;const r=e.usedRoutes.filter((e=>""!==e&&"/"!==e));for(const e of r){(0,u.h)(e.startsWith("/"),688);const s=e.split("/")[1],r=e.slice(s.length+1),i=t.get(s);(0,u.h)(void 0!==(null==i?void 0:i.usedRoutes),689),i.usedRoutes.push(r),t.set(s,i)}return t}(await(null!==(s=null===(t=(e=this.dataStoreContext).getBaseGCDetails)||void 0===t?void 0:t.call(e))&&void 0!==s?s:this.dataStoreContext.getInitialGCSummaryDetails()))})),void 0!==(null==r?void 0:r.trees)&&Object.keys(r.trees).forEach((t=>{if("_search"===t)return;let s;e.isLocalDataStore?(s=new R(t,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,((e,s)=>this.submitChannelOp(t,e,s)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),r.trees[t]),e.attachState!==n.mB.Detached?s.makeVisible():this.localChannelContextQueue.set(t,s)):s=new z(this,e,e.storage,((e,s)=>this.submitChannelOp(t,e,s)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),t,r.trees[t],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(t,{type:f.CreateSummarizerNodeSource.FromSummary}),(async()=>this.getChannelBaseGCDetails(t)));const i=new c.B;i.resolve(s),this.contexts.set(t,s),this.contextsDeferred.set(t,i)})),this.attachListener(),this.bindState=s?n.xU.Bound:n.xU.NotBound,this._attachState=e.attachState,this.visibilityState=s?e.attachState===n.mB.Detached?f.VisibilityState.LocallyVisible:f.VisibilityState.GloballyVisible:f.VisibilityState.NotVisible,s&&this.deferredAttached.resolve()}static load(e,t,s){return new j(e,t,s)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==n.mB.Detached}get attachState(){return this._attachState}get absolutePath(){return(0,y.H)(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(e){return this.request(e)}async request(e){try{const t=v.R.create(e),s=t.pathParts[0];if("_channels"===s||"_custom"===s)return this.request(t.createSubRequest(1));if(this.contextsDeferred.has(s)&&t.isLeaf(1))try{const e=await this.contextsDeferred.get(s).promise;return{mimeType:"fluid/object",status:200,value:await e.getChannel()}}catch(t){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},t),(0,b.Ys)(500,`Failed to get Channel: ${t}`,e)}return(0,b.I4)(e)}catch(e){return(0,b.Nj)(e)}}async getChannel(e){this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new c.B);const t=await this.contextsDeferred.get(e).promise;return await t.getChannel()}createChannel(e=(0,w.Z)(),t){if(e.includes("/"))throw new a.Oi(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),(0,u.h)(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const s=new F(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,((t,s)=>this.submitChannelOp(e,t,s)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)));if(this.contexts.set(e,s),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(s);else{const t=new c.B;t.resolve(s),this.contextsDeferred.set(e,t)}return(0,u.h)(!!s.channel,378),s.channel}bindChannel(e){(0,u.h)(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached?this.attachChannel(e):this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===f.VisibilityState.NotVisible&&(this.visibilityState=f.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach((e=>{e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===n.xU.NotBound&&(this.bindState=n.xU.Binding,this.dataStoreContext.bindToContext(),this.bindState=n.xU.Bound)}bind(e){this.visibilityState===f.VisibilityState.NotVisible?this.pendingHandlesToMakeVisible.add(e):e.attachGraph()}setConnectionState(e,t){this.verifyNotClosed();for(const[,s]of this.contexts)s.setConnectionState(e,t);(0,d.Qq)(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(e){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)}process(e,t,s){this.verifyNotClosed();try{switch(e.type){case x.Attach:{const s=e.contents,r=s.id;if(t)(0,u.h)(this.pendingAttach.has(r),380),this.pendingAttach.delete(r);else{(0,u.h)(!this.contexts.has(r),381);const t=new Map,i=(0,p.m)(s.snapshot.entries,t),n=new z(this,this.dataStoreContext,this.dataStoreContext.storage,((e,t)=>this.submitChannelOp(r,e,t)),(e=>this.setChannelDirty(e)),((e,t)=>this.addedGCOutboundReference(e,t)),r,i,this.sharedObjectRegistry,t,this.dataStoreContext.getCreateChildSummarizerNodeFn(r,{type:f.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:s.snapshot}),(async()=>this.getChannelBaseGCDetails(r)),s.type);if(this.contexts.set(r,n),this.contextsDeferred.has(r))this.contextsDeferred.get(r).resolve(n);else{const e=new c.B;e.resolve(n),this.contextsDeferred.set(r,e)}}break}case x.ChannelOp:this.processChannelOp(e,t,s)}this.emit("op",e)}catch(t){throw a.Hi.wrapIfUnrecognized(t,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}async getGCData(e=!1){const t=new C;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>this.isChannelAttached(e))).map((async([s,r])=>{const i=await r.getGCData(e);t.prefixAndAddNodes(s,i.gcNodes)}))),this.updateGCNodes(t),t.getGCData()}updateUsedRoutes(e,t){var s;const r=function(e){const t=e.filter((e=>""!==e&&"/"!==e)),s=new Map;for(const e of t){(0,u.h)(e.startsWith("/"),408);const t=e.split("/")[1],r=e.slice(t.length+1),i=s.get(t);void 0!==i?i.push(r):s.set(t,[r])}return s}(e);for(const[e]of r)(0,u.h)(this.contexts.has(e),382);for(const[e,i]of this.contexts)i.updateUsedRoutes(null!==(s=r.get(e))&&void 0!==s?s:[],t)}addedGCOutboundReference(e,t){var s,r;null===(r=(s=this.dataStoreContext).addedGCOutboundReference)||void 0===r||r.call(s,e,t)}async getChannelBaseGCDetails(e){var t;let s=(await this.channelsBaseGCDetails).get(e);return void 0===s?s={}:void 0!==(null===(t=s.gcData)||void 0===t?void 0:t.gcNodes)&&function(e,t){const s=Object.entries(e);for(const[r,i]of s){const s=new Set(i);s.delete(t),e[r]=[...s]}}(s.gcData.gcNodes,this.absolutePath),void 0!==s.usedRoutes&&0!==s.usedRoutes.length||(s.usedRoutes=[""]),s}async summarize(e=!1,t=!0,s){const r=new S.x1;return await Promise.all(Array.from(this.contexts).filter((([e,t])=>{const s=this.isChannelAttached(e);return(0,u.h)(s,383),s})).map((async([i,n])=>{const a=await n.summarize(e,t,s);r.addWithStats(i,a)}))),r.getSummaryTree()}getAttachSummary(e){this.attachGraph();const t=new S.x1;for(const[s,r]of this.contexts){if(!(r instanceof M))throw new m.j4("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(s)){let i;if(r.isLoaded){const t=r.getAttachSummary(e);(0,u.h)(t.summary.type===g.J.Tree,384),i={stats:t.stats,summary:t.summary}}else(0,u.h)(!!this.dataStoreContext.baseSnapshot,385),i=(0,S.S5)(this.dataStoreContext.baseSnapshot.trees[s]);t.addWithStats(s,i)}}return t.getSummaryTree()}submitMessage(e,t,s){this.submit(e,t,s)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}async waitAttached(){return this.deferredAttached.promise}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),(0,u.h)(this.isAttached,386),(0,u.h)(this.visibilityState===f.VisibilityState.GloballyVisible,720);const t=D(e,!0,!1),s=(0,S.H4)(t.summary),r={id:e.id,snapshot:s,type:e.attributes.type};this.pendingAttach.set(e.id,r),this.submit(x.Attach,r),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,s){const r={address:e,contents:t};this.submit(x.ChannelOp,r,s)}submit(e,t,s){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,s)}reSubmit(e,t,s){switch(this.verifyNotClosed(),e){case x.ChannelOp:{const e=t,r=this.contexts.get(e.address);(0,u.h)(!!r,387),r.reSubmit(e.contents,s);break}case x.Attach:this.submit(e,t,s);break;default:(0,l.U)(e)}}rollback(e,t,s){switch(this.verifyNotClosed(),e){case x.ChannelOp:{const e=t,r=this.contexts.get(e.address);(0,u.h)(!!r,749),r.rollback(e.contents,s);break}default:throw new m.j4(`Can't rollback ${e} message`)}}async applyStashedOp(e){const t=e,s=this.contexts.get(t.address);return(0,u.h)(!!s,388),await s.getChannel(),s.applyStashedOp(t.contents)}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,s){this.verifyNotClosed();const r=e.contents,i=Object.assign(Object.assign({},e),{contents:r.contents}),n=this.contexts.get(r.address);return(0,u.h)(!!n,389),n.processOp(i,t,s),n}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",(()=>{this.attachGraph(),this._attachState=n.mB.Attaching,(0,u.h)(this.visibilityState===f.VisibilityState.LocallyVisible,721),this.visibilityState=f.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach((e=>{e.makeVisible()})),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")})),this.dataStoreContext.once("attached",(()=>{(0,u.h)(this.visibilityState===f.VisibilityState.GloballyVisible,722),this._attachState=n.mB.Attached,this.emit("attached")}))}verifyNotClosed(){if(this._disposed)throw new m.j4("Runtime is closed")}}const B=(e,t=j)=>class extends t{async request(t){const s=await super.request(t);return 404===s.status?e(t,this):s}},q=(e,t=j)=>class extends t{addBlob(e,t,s){const r=t.shift();if(void 0===r)throw new m.j4("Path can't be empty");let i={type:g.J.Blob,content:s};e.stats.blobNodeCount++,e.stats.totalBlobSize+=s.length;for(const s of t.reverse())i={type:g.J.Tree,tree:{[s]:i}},e.stats.treeNodeCount++;e.summary.tree[r]=i}async summarize(...t){const s=await super.summarize(...t),r=await e(this);return void 0!==r&&this.addBlob(s,r.path,r.content),s}};var G=s(62044),U=s(54188),V=s(73);async function H(e,t,s,r,i,n,a){let o=i;o=B((async(e,t)=>(await V.y.getDataObject(t)).request(e)),o);const c=new o(t,s,n),u=t.scope,l=new e({runtime:c,context:t,providers:new U.Q(u.IFluidDependencySynthesizer).synthesize(r,{}),initProps:a});return n||await l.finishInitialization(n),{instance:l,runtime:c}}var X=s(73228);class ${constructor(e,t){this.contractCache=new Map([]),this.contractAdapterFactoryMap=new Map(t.map((e=>[e.key,e.factory]))),this.proxyComponent=new Proxy(e,this)}getProxy(){return this.proxyComponent}getProxyState(){return void 0===this.proxyState&&(this.proxyState={proxyComponent:this.proxyComponent}),this.proxyState}get(e,t,s){return t in e?Reflect.get(e,t,s):this.contractGetTrap(e,t)}contractGetTrap(e,t){if(this.contractCache.has(t))return this.contractCache.get(t);const s=this.contractAdapterFactoryMap.get(t);if(s){const r=s(e,this.getProxyState());return r&&this.contractCache.set(t,r),r}}getOwnPropertyDescriptor(e,t){if("[[Target]]"===t)return{configurable:!0,enumerable:!0,value:e}}}function W(e,t){return t&&t.length>0?function(e,t){return new $(e,t).getProxy()}(e,t):e}class J{constructor(e,t,s){this.ctor=e,this.optionalProviders=t,this.contractAdapters=s,this.type="LoopObject"}async instantiateLoopComponent(e,t){const s=this.optionalProviders&&t?.synthesize(this.optionalProviders,void 0)||void 0;return W(new this.ctor(e,s),this.contractAdapters)}}class K extends class extends class{constructor(e,t,s,r,i,n=j){if(this.type=e,this.ctor=t,this.optionalProviders=r,this.runtimeClass=n,""===this.type)throw new Error("undefined type member");void 0!==i&&(this.registry=new G.P(i)),this.sharedObjectRegistry=new Map(s.map((e=>[e.type,e])))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(e,t){const{runtime:s}=await H(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return s}async createChildInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)}async createPeerInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)}async createInstance(e,t){return this.createNonRootInstanceCore(e,[this.type],t)}async createRootInstance(e,t,s){const r=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(r,s)}async createNonRootInstanceCore(e,t,s){const r=e.createDetachedDataStore(t);return this.createInstanceCore(r,s)}async createInstanceCore(e,t){const{instance:s,runtime:r}=await H(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return await e.attachRuntime(this,r),s}}{constructor(e,t,s=[],n,a,o=j){const c=[...s];s.find((e=>e.type===r.y.Type))||c.push(r.u.getFactory()),s.find((e=>e.type===i.c.Type))||c.push(i.G.getFactory()),super(e,t,c,n,a,o)}}{constructor(e,t,s,r,i,n,a){super(e,t,s,r,function(e){if(!e)return;const t=new Map;return e.forEach(((e,s)=>{"FluidObject"===e.factory.type&&t.set(s,e.factory.factory)})),t}(i),function(e=j){return q((async e=>{const t=(await X.L.getDataObject(e)).SearchContent;if(void 0===t)return;const s=await t.getSearchContent();return void 0!==s?{path:["_search","01"],content:s.endsWith("\n")?s:s+"\n"}:void 0}),e)}(n)),this.registryEntries=i,this.contractAdapters=a}async instantiateDataStore(e,t){const s=await super.instantiateDataStore(e,t);return s._dataObject=W(s._dataObject,this.contractAdapters),s}getSubComponentRegistryInfo(e){return this.registryEntries?.get(e)}get SubComponentRegistryDataProvider(){return this}}},36047:(e,t,s)=>{"use strict";var r,i;s.d(t,{J:()=>r,u:()=>i}),function(e){e.Generic="Generic",e.Error="Error",e.UserAction="UserAction",e.Activity="Activity"}(r||(r={})),function(e){e.Success="Success",e.Failure="Failure",e.Cancelled="Cancelled"}(i||(i={}))},31065:(e,t,s)=>{"use strict";s.d(t,{r:()=>i});var r=s(46630);const i=(e,t)=>{const s=function(e){const{value:t,tag:s}=null!==e&&"object"==typeof e?e:{value:e,tag:void 0};switch(s){case void 0:case"PackageData":case"CodeArtifact":return t;case"UserData":return"REDACTED (tag: UserData)";default:return`REDACTED (tag: ${s})`}}(e);if(void 0!==s)return"string"==typeof s?(0,r.dt)(t,s):"number"==typeof s?(0,r.b_)(t,s):(0,r.UL)(t,s)}},58252:(e,t,s)=>{"use strict";s.d(t,{a:()=>o});var r=s(36047),i=s(50084),n=s(4744);let a=new Set;class o{constructor(e,t,s){this.activityName=e,this.logger=t,this.isAPerformanceMetric=!1,this.additionalPropsToLog=s?.additionalPropsToLog,this.addUserTiming=s?.addUserTiming,this.isAPerformanceMetric=s?.isAPerformanceMetric||!1,this.subActivities={},this.identifier=(0,i.Z)(),this.activityStartName=`${this.activityName}-start-${this.identifier}`,this.activityEndName=`${this.activityName}-end-${this.identifier}`,this.addUserTiming&&performance.mark(this.activityStartName),this.startTime=performance.now(),this.startTimeSinceEpoch=Date.now()}static start(e,t,s){const r=new o(e,t,s);return a.add(r),r}markSubActivityStart(e){this.subActivities[e]={startTime:performance.now(),startTimeSinceEpoch:Date.now()},this.addUserTiming&&performance.mark(this.getSubActivityName(e,"start"))}markSubActivityEnd(e,t){if(this.subActivities[e]){if(this.addUserTiming){const t=this.getSubActivityName(e,"end");performance.mark(t),performance.measure(e,this.getSubActivityName(e,"start"),t)}this.additionalPropsToLog={[`startTime_${e}`]:this.subActivities[e].startTimeSinceEpoch,[`durationMs_${e}`]:Math.round(performance.now()-this.subActivities[e].startTime),...this.additionalPropsToLog,...t}}}setResult(e,t,s,r){this.logActivityResult(e,t,s,r?.skipLogging)}cancel(e,t,s){this.logActivityResult(e,t,s,!1,!0)}addAdditionalProps(e){this.additionalPropsToLog={...this.additionalPropsToLog,...e}}dispose(){this.cancel();const e=e=>performance.clearMarks(e),t=e=>performance.clearMeasures(e);if(this.addUserTiming){e(this.activityStartName),e(this.activityEndName),this.cachedMeasureName&&t(this.cachedMeasureName);for(const s in this.subActivities)e(this.getSubActivityName(s,"start")),e(this.getSubActivityName(s,"end")),t(s)}}logActivityResult(e,t,s,i,o){if(this.hasAlreadyResolved)return;this.hasAlreadyResolved=!0,this.addUserTiming&&performance.mark(this.activityEndName);const c=performance.now(),u=Math.round(c-this.startTime);if(this.isAPerformanceMetric){const e=window._pageTimings||(window._pageTimings={});e[this.activityName]?e[this.activityName]=Math.max(e[this.activityName],u):e[this.activityName]=u}if(this.logger&&!i){const i={eventName:this.activityName,startTime:this.startTimeSinceEpoch,durationMs:u,succeeded:e,resultType:o?r.u.Cancelled:e?r.u.Success:r.u.Failure,...this.additionalPropsToLog,...t};(0,n.t_)(this.logger,i,s)}this.logger=void 0,a.delete(this),this.addUserTiming&&performance.measure(this.generateMeasureName(e),this.activityStartName,this.activityEndName)}generateMeasureName(e){return this.cachedMeasureName=`${this.activityName}${!1===e?"-FAILED":""}-${this.identifier}`,this.cachedMeasureName}getSubActivityName(e,t){return`${e}-${t}-${this.identifier}`}}},44364:(e,t,s)=>{"use strict";s.d(t,{M:()=>r});class r{constructor(e){this.logBuffer=[],this.logger=void 0,this.persistedProperties={},e.then((e=>{e&&(this.logger=e,this.addPersistedProperties(this.persistedProperties),this.logBuffer.forEach((({event:t,namespace:s})=>{void 0!==s?e.sendWithNamespace(t,s):e.send(t)}))),this.logBuffer=[]})).catch((()=>{}))}get NamespaceLogger(){return this}get PersistedProperties(){return this}addPersistedProperties(e){void 0!==this.logger?this.logger.PersistedProperties?.addPersistedProperties(e):this.persistedProperties={...e,...this.persistedProperties}}send(e){this.logger?this.logger.send(e):this.logBuffer.push({event:e})}sendWithNamespace(e,t){this.logger?this.logger.sendWithNamespace(e,t):this.logBuffer.push({event:e,namespace:t})}}},4744:(e,t,s)=>{"use strict";s.d(t,{t_:()=>o,uX:()=>a,ve:()=>n,kZ:()=>c});var r=s(36047);function i(e){return e.replace(/(https:\/\/)(\w)+(-my.sharepoint.com)/,"(redacted)")}function n(e,t){e.send({...t,category:r.J.Generic})}function a(e,t,s){s&&u(t,s),e.send({...t,category:r.J.Error})}function o(e,t,s){s&&u(t,s),t.resultType||void 0===t.succeeded||(t.resultType=t.succeeded?r.u.Success:r.u.Failure),e.send({...t,category:r.J.Activity})}function c(e,t){e.send({...t,category:r.J.UserAction})}function u(e,t){!function(e,t){const s="object"==typeof e&&null!==e;function r(t){if(!s)return;const r=e[t];return"string"==typeof r?r:void 0}t.errorMessage=r("message")??String(e),t.errorName=r("name"),t.stack=r("stack"),t.errorType=r("errorType"),t.errorInstanceId=r("errorInstanceId")}(t,e),e.message?e.message=`${e.message}\n${e.errorMessage}`:e.message=e.errorMessage,void 0===e.stack&&(e.stack=function(){let e=(new Error).stack;if(!e)try{throw new Error}catch(t){e=t.stack}return e}()),e.message&&(e.message=i(e.message.toString())),e.stack&&(e.stack=i(e.stack.toString())),e.error&&(e.error=i(e.error.toString()))}new Set,new Set},42681:(e,t,s)=>{"use strict";s.d(t,{g:()=>r});class r{constructor(e,t,s){this.namespace=e,this.persistedProperties=s,this.logger=t}get NamespaceLogger(){return this}get PersistedProperties(){return this}addPersistedProperties(e){this.persistedProperties={...this.persistedProperties,...e}}send(e){this.sendWithNamespace(e,this.namespace)}sendWithNamespace(e,t){this.logger?.sendWithNamespace({...e,...this.persistedProperties},t)}dispose(){this.logger=null}}},61920:(e,t,s)=>{"use strict";var r;s.d(t,{al:()=>n,b8:()=>o,jR:()=>c}),function(e){e.afZa="af-za",e.amEt="am-et",e.arSa="ar-sa",e.asIn="as-in",e.azLatnAz="az-latn-az",e.bgBg="bg-bg",e.bnIn="bn-in",e.bsLatnBa="bs-latn-ba",e.caEs="ca-es",e.caEsValencia="ca-es-valencia",e.csCz="cs-cz",e.cyGb="cy-gb",e.daDk="da-dk",e.deDe="de-de",e.elGr="el-gr",e.enGb="en-gb",e.enUs="en-us",e.esEs="es-es",e.esMx="es-mx",e.etEe="et-ee",e.euEs="eu-es",e.faIr="fa-ir",e.fiFi="fi-fi",e.filPh="fil-ph",e.frCa="fr-ca",e.frFr="fr-fr",e.gaIe="ga-ie",e.gdGb="gd-gb",e.glEs="gl-es",e.guIn="gu-in",e.heIl="he-il",e.hiIn="hi-in",e.hrHr="hr-hr",e.huHu="hu-hu",e.idId="id-id",e.isIs="is-is",e.itIt="it-it",e.jaJp="ja-jp",e.kaGe="ka-ge",e.kkKz="kk-kz",e.kmKh="km-kh",e.knIn="kn-in",e.kokIn="kok-in",e.koKr="ko-kr",e.lbLu="lb-lu",e.loLa="lo-la",e.ltLt="lt-lt",e.lvLv="lv-lv",e.miNz="mi-nz",e.mkMk="mk-mk",e.mlIn="ml-in",e.mrIn="mr-in",e.msMy="ms-my",e.mtMt="mt-mt",e.nbNo="nb-no",e.neNp="ne-np",e.nlNl="nl-nl",e.nnNo="nn-no",e.orIn="or-in",e.paIn="pa-in",e.plPl="pl-pl",e.ptBr="pt-br",e.ptPt="pt-pt",e.quzPe="quz-pe",e.roRo="ro-ro",e.ruRu="ru-ru",e.skSk="sk-sk",e.slSi="sl-si",e.sqAl="sq-al",e.srCyrlBa="sr-cyrl-ba",e.srCyrlRs="sr-cyrl-rs",e.srLatnRs="sr-latn-rs",e.svSe="sv-se",e.taIn="ta-in",e.teIn="te-in",e.thTh="th-th",e.trTr="tr-tr",e.ttRu="tt-ru",e.ugCn="ug-cn",e.ukUa="uk-ua",e.urPk="ur-pk",e.viVn="vi-vn",e.zhCn="zh-cn",e.zhTw="zh-tw"}(r||(r={}));const i={af:r.afZa,am:r.amEt,ar:r.arSa,as:r.asIn,az:r.azLatnAz,bg:r.bgBg,bn:r.enGb,bs:r.bsLatnBa,"bs-cyrl-ba":r.enGb,ca:r.caEs,cs:r.csCz,cy:r.cyGb,da:r.daDk,de:r.deDe,el:r.elGr,"el-cy":r.enGb,en:r.enUs,es:r.esEs,et:r.etEe,eu:r.euEs,fa:r.faIr,fi:r.fiFi,fil:r.filPh,fr:r.frFr,ga:r.gaIe,gd:r.gdGb,gl:r.glEs,gu:r.guIn,he:r.heIl,hi:r.hiIn,hr:r.hrHr,hu:r.huHu,id:r.idId,is:r.isIs,it:r.itIt,iw:r.heIl,"iw-il":r.heIl,ja:r.jaJp,ka:r.kaGe,kk:r.kkKz,km:r.kmKh,kn:r.knIn,ko:r.koKr,kok:r.kokIn,lb:r.lbLu,lo:r.loLa,lt:r.ltLt,lv:r.lvLv,mi:r.miNz,mk:r.mkMk,ml:r.mlIn,mr:r.mrIn,ms:r.msMy,mt:r.mtMt,nb:r.nbNo,ne:r.neNp,nl:r.nlNl,nn:r.nnNo,or:r.orIn,pa:r.paIn,pl:r.plPl,pt:r.ptBr,quz:r.quzPe,ro:r.roRo,ru:r.ruRu,sk:r.skSk,sl:r.slSi,sq:r.sqAl,sv:r.svSe,ta:r.taIn,te:r.teIn,th:r.thTh,tr:r.trTr,"tr-cy":r.enGb,tt:r.ttRu,ug:r.ugCn,uk:r.ukUa,ur:r.urPk,uz:r.enUs,vi:r.viVn,zh:r.enUs},n=r.enUs,a=/^([^-]+)-.+/;function o(e){if(null==e)return!1;const t=e.toLowerCase();return Object.values(r).includes(t)||void 0!==i[t]}function c(e){if(null==e)return n;const t=e.toLowerCase();if(Object.values(r).includes(t))return t;if(void 0!==i[t])return i[t];const s=function(e){const t=a.exec(e.trim().toLowerCase());if(null!==t&&t.length>1)return t[1]}(t);return void 0!==s&&void 0!==i[s]?i[s]:n}},87573:(e,t,s)=>{"use strict";s.d(t,{C:()=>i});var r=s(4744);function i(e,t,s){try{return JSON.parse(e,t)}catch(e){return void(s&&(0,r.uX)(s.logger,s.event,e))}}},78485:(e,t,s)=>{"use strict";s.d(t,{L5:()=>u});var r=s(87573);let i,n;try{i=localStorage}catch{}i||(i=void 0);try{n=sessionStorage}catch{}n||(n=void 0);const a=new URLSearchParams("undefined"!=typeof location?location.search:""),o=new Map;function c(e){if(null!=e){const t=(0,r.C)(e),s=void 0!==t?t:e;return"on"===s||"off"===s?"on"===s:s}}function u(e,t,s){return s?s.getSetting(e,t,"FluidExperiences"):function(e,t){const s=function(e,t){const s=o.get(e);if(void 0!==s)return s;let r,n,u;return u=void 0!==(r=function(e){return c(a.get(e))}(e))?r:void 0!==(n=function(e){const t=i?.getItem(e);return c(t)}(e))?n:t,o.set(e,u),u}(e,t);return s}(e,t)}},81051:(e,t,s)=>{"use strict";s.d(t,{i:()=>p});var r=s(40544),i=s(24115),n=s(61920),a=s(30105),o=s(78485);function c(e,t){return(0,o.L5)(e,!1,t)}function u(e){return c("video.videoUnfurling",e)}const l=/^https?:\/\/([A-Za-z0-9-]{1,63}\.)+[A-Za-z]{2,}\/:v:\/[a-z]+\/+(.*?\.+[A-Za-z0-9]{2,6}|.*?\/+[A-Za-z0-9_-]{1,})+(\?.+)?$/,h=new RegExp(`^https?://([A-Za-z0-9-]{1,63}\\.)+[A-Za-z]{2,}/[a-z]+/[a-z0-9_]+/_layouts/\\d+/.*\\.aspx\\?[a-z_]+=.*(${["3g2","3gp","3gpp","asf","avi","m2ts","m4v","mkv","mov","mp4","mp4v","mts","ts","webm","wmv"].join("|")}).*$`);var d=s(75260);const m=e=>s(9475)(`./${e}/VideoStrings.json`);const p={discoverData:function(e,t){return function(e){return c("video.renderVideoComponent",e)}(t)?new r.d((async()=>{const t=(0,n.jR)(e),s=await function(e){return async function(e,t){const s=await e(t);return(0,d.E)(s,t)}(m,e)}(t);return Promise.resolve([{initialConfiguration:{actionType:2},queryableData:{displayName:s.discoverMenuRecordVideoOptionText,icon:(0,i.PA)("FFXCVideoAdd",t),keywords:[],description:s.discoverMenuRecordVideoOptionDescription,properties:{testComponent:!0}}}])})):new r.d((async()=>Promise.resolve([])))},factory:{type:"LoopObject",factory:new r.d((()=>Promise.all([s.e(9685),s.e(86963),s.e(13129),s.e(61951),s.e(77478)]).then(s.bind(s,86286)).then((e=>e.loopExport))))},dataCreationInfo:[{dataType:a.en,canHandleData:async function(e,t){const s=t?await t.SettingsProvider:void 0,r=e.url.href;return u(s)&&(l.test(r)||h.test(r))}}],urlRegexes:function(e){return new r.d((async()=>u(e.SettingsProvider)?Promise.resolve([l,h]):Promise.resolve([])))}}},21383:(e,t,s)=>{"use strict";s.d(t,{Y:()=>i,r:()=>n});var r=s(78485);function i(e){return(0,r.L5)("loopYouTubeComponent.isComponentEnabled",!1,e)}function n(e){return(0,r.L5)("loopYouTubeComponent.isInlineExperimentEnabled",!1,e)}},10355:(e,t,s)=>{"use strict";s.d(t,{i:()=>r,y:()=>i});const r=/^(?:https?:\/\/(?:www\.)?)(?:youtube\.com\/(?:(?:v|e|watch)(?:\?(?:.*&)?v=|\/)|embed\/)|youtu\.be\/)([0-9A-Za-z_-]{11})/;function i(e){return!!e.href.match(r)}},9475:(e,t,s)=>{var r={"./af-za/VideoStrings.json":[66141,24609],"./am-et/VideoStrings.json":[66521,99476],"./ar-sa/VideoStrings.json":[41879,43893],"./as-in/VideoStrings.json":[16169,96611],"./az-latn-az/VideoStrings.json":[17643,30845],"./bg-bg/VideoStrings.json":[381,97863],"./bn-in/VideoStrings.json":[39093,29938],"./bs-latn-ba/VideoStrings.json":[62262,38012],"./ca-es-valencia/VideoStrings.json":[42262,79902],"./ca-es/VideoStrings.json":[45466,2944],"./cs-cz/VideoStrings.json":[43114,13750],"./cy-gb/VideoStrings.json":[14267,20116],"./da-dk/VideoStrings.json":[18685,27333],"./de-de/VideoStrings.json":[9532,72917],"./el-gr/VideoStrings.json":[35999,56927],"./en-gb/VideoStrings.json":[80859,41230],"./en-us/VideoStrings.json":[63244,65898],"./es-es/VideoStrings.json":[41781,37347],"./es-mx/VideoStrings.json":[60912,69502],"./et-ee/VideoStrings.json":[56148,19769],"./eu-es/VideoStrings.json":[43727,24237],"./fa-ir/VideoStrings.json":[12177,14915],"./fi-fi/VideoStrings.json":[29401,35034],"./fil-ph/VideoStrings.json":[98900,11556],"./fr-ca/VideoStrings.json":[29998,22975],"./fr-fr/VideoStrings.json":[15748,28914],"./ga-ie/VideoStrings.json":[84151,4938],"./gd-gb/VideoStrings.json":[79506,49861],"./gl-es/VideoStrings.json":[28445,23737],"./gu-in/VideoStrings.json":[83829,57976],"./he-il/VideoStrings.json":[7934,9805],"./hi-in/VideoStrings.json":[74448,76489],"./hr-hr/VideoStrings.json":[64456,98557],"./hu-hu/VideoStrings.json":[98210,76015],"./hy-am/VideoStrings.json":[24808,86128],"./id-id/VideoStrings.json":[94935,94149],"./is-is/VideoStrings.json":[81432,54428],"./it-it/VideoStrings.json":[74645,274],"./ja-jp/VideoStrings.json":[65863,68232],"./ka-ge/VideoStrings.json":[69476,83767],"./kk-kz/VideoStrings.json":[88179,81664],"./km-kh/VideoStrings.json":[53147,98553],"./kn-in/VideoStrings.json":[32371,65339],"./ko-kr/VideoStrings.json":[19513,91966],"./kok-in/VideoStrings.json":[81566,2766],"./lb-lu/VideoStrings.json":[36849,65971],"./lo-la/VideoStrings.json":[39103,55517],"./lt-lt/VideoStrings.json":[24981,30422],"./lv-lv/VideoStrings.json":[18830,85629],"./mi-nz/VideoStrings.json":[48319,67033],"./mk-mk/VideoStrings.json":[92767,69167],"./ml-in/VideoStrings.json":[83269,10510],"./mr-in/VideoStrings.json":[9042,28610],"./ms-my/VideoStrings.json":[70601,62486],"./mt-mt/VideoStrings.json":[55854,13324],"./nb-no/VideoStrings.json":[74714,52110],"./ne-np/VideoStrings.json":[94627,6683],"./nl-nl/VideoStrings.json":[50488,38731],"./nn-no/VideoStrings.json":[75890,59669],"./or-in/VideoStrings.json":[51605,13599],"./pa-in/VideoStrings.json":[70072,1983],"./pl-pl/VideoStrings.json":[82490,7893],"./pt-br/VideoStrings.json":[94596,34366],"./pt-pt/VideoStrings.json":[89171,28247],"./quz-pe/VideoStrings.json":[1325,82238],"./ro-ro/VideoStrings.json":[41928,65803],"./ru-ru/VideoStrings.json":[32903,14890],"./sk-sk/VideoStrings.json":[54966,4019],"./sl-si/VideoStrings.json":[44544,32659],"./sq-al/VideoStrings.json":[89238,42862],"./sr-cyrl-ba/VideoStrings.json":[92159,802],"./sr-cyrl-rs/VideoStrings.json":[25479,95107],"./sr-latn-rs/VideoStrings.json":[24862,68528],"./sv-se/VideoStrings.json":[47754,21515],"./ta-in/VideoStrings.json":[15173,97103],"./te-in/VideoStrings.json":[74463,34800],"./th-th/VideoStrings.json":[20736,26712],"./tr-tr/VideoStrings.json":[22789,64909],"./tt-ru/VideoStrings.json":[30194,636],"./ug-cn/VideoStrings.json":[75955,21507],"./uk-ua/VideoStrings.json":[1896,26169],"./ur-pk/VideoStrings.json":[97123,32012],"./uz-uz/VideoStrings.json":[66843,43817],"./vi-vn/VideoStrings.json":[73940,62079],"./zh-cn/VideoStrings.json":[87771,53347],"./zh-tw/VideoStrings.json":[74987,23362]};function i(e){if(!s.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return s.e(t[1]).then((()=>s.t(i,19)))}i.keys=()=>Object.keys(r),i.id=9475,e.exports=i}},e=>{e(e.s=82144)}]);
//# sourceMappingURL=catalogContainer.c60aaef62564dbdf3600.js.map